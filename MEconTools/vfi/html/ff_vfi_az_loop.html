
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>FF_VFI_AZ_LOOP (looped grid choice) Dynamic Savings Problem</title><meta name="generator" content="MATLAB 9.7"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2020-07-24"><meta name="DC.source" content="ff_vfi_az_loop.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>FF_VFI_AZ_LOOP (looped grid choice) Dynamic Savings Problem</h1><!--introduction--><pre>  Slow looped solution for solving the dynamic programming problem with
  fixed assets grid using value function iteration. Obtains policy and
  value functions. Shock is AR(1). This function is looped, and
  extremely slow when state-space increases in size. This function is
  useful as a working template for developing models that rely on asset
  and shocks.</pre><pre>  * MP_PARAMS controls model preference, prices, shock and asset grid
  parameters.
  * MP_SUPPORT controls convergence criterion, printing and summary
  controls</pre><pre>  mp_params = containers.Map('KeyType','char', 'ValueType','any');
  mp_params('fl_crra') = 1.5;
  mp_params('fl_beta') = 0.95;
  mp_params('fl_w') = 1.05;
  mp_params('fl_r') = 0.03;
  mp_params('fl_a_min') = 0;
  mp_params('fl_a_max') = 50;
  mp_params('it_a_n') = 25;
  mp_params('st_grid_type') = 'grid_powerspace';
  mp_params('fl_z_persist') = 0.60;
  mp_params('fl_shk_std') = 0.10;
  mp_params('it_z_n') = 5;
  mp_params('st_grid_type') = 'grid_powerspace';</pre><pre>  mp_support = containers.Map('KeyType','char', 'ValueType','any');
  mp_support('fl_lowestc') = -10e10;
  mp_support('it_maxiter_val') = 500;
  mp_support('fl_tol_val') = 10e-5;
  % printer various information
  mp_support('bl_timer') = true;
  mp_support('bl_print_params') = false;
  mp_support('bl_print_iterinfo') = false;
  % These names must match keys of mp_solu: v=value, ap=savings choice,
  c=consumption, y=income, coh=cash-on-hand (income + savings),
  savefraccoh = ap/coh.
  % what outcomes to store in the mp_solu for export
  mp_support('ls_slout') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
  % outcome for ff_container_map_display
  mp_support('ls_ffcmd') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
  % outcome for ff_summ_nd_array
  mp_support('ls_ffsna') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
  % outcome for ff_graph_grid
  mp_support('ls_ffgrh') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
  % outcome for ff_summ_nd_array
  mp_support('ffsna_opt_it_row_n_keep') = 10;
  % outcome for ff_summ_nd_array
  mp_support('ffsna_opt_it_col_n_keep') = 9;</pre><pre>  [MP_VALPOL_OUT, FLAG] = FF_VFI_AZ_LOOP() default savings and shock
  model solution.</pre><pre>  [MP_VALPOL_OUT, FLAG] = FF_VFI_AZ_LOOP(MP_PARAMS) change model
  parameters through MP_PARAMS</pre><pre>  [MP_VALPOL_OUT, FLAG] = FF_VFI_AZ_LOOP(MP_PARAMS, MP_SUPPORT) change
  various printing, storaging, graphing, convergence etc controls
  through MP_SUPPORT</pre><pre>  [MP_VALPOL_OUT, FLAG] = FF_VFI_AZ_LOOP(MP_PARAMS, MP_SUPPORT,
  MP_SUPPORT_GRAPH) also changing graphing options, see the
  FF_GRAPH_GRID function for what key value paris can be specified.</pre><pre>  see also FX_VFI_AZ_LOOP, FF_VFI_AZ_VEC, FF_VFI_AZ_BISEC_LOOP,
  FF_VFI_AZ_BISEC_VEC, FF_VFI_AZ_MZOOM_LOOP, FF_VFI_AZ_MZOOM_VEC,
  FF_GRAPH_GRID</pre><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#3">Set Default and Parse Inputs</a></li><li><a href="#4">Default Model Parameters</a></li><li><a href="#5">Parse mp_params</a></li><li><a href="#6">Generate A and Z Grids</a></li><li><a href="#7">Default Support Parameters</a></li><li><a href="#8">Whether Additional Outcomes Should be Stored</a></li><li><a href="#9">Initialize Matrix</a></li><li><a href="#10">Iterate and Dynamically Solve</a></li><li><a href="#11">Convergence Results</a></li><li><a href="#12">Results for Printing, and Graphing</a></li><li><a href="#13">Print Parameter Information</a></li><li><a href="#14">Show Value Function Convergence Information</a></li><li><a href="#15">ls_ffcmd summary</a></li><li><a href="#16">ls_ffsna summarize full</a></li><li><a href="#17">ls_ffgrh graph</a></li><li><a href="#18">Store Results for Output</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> [mp_valpol_out, flag] = ff_vfi_az_loop(varargin)
</pre><h2 id="3">Set Default and Parse Inputs</h2><pre class="codeinput"><span class="keyword">if</span> (~isempty(varargin))

    <span class="keyword">if</span> (length(varargin) == 1)
        [mp_params_ext] = varargin{:};
    <span class="keyword">elseif</span> (length(varargin) == 2)
        [mp_params_ext, mp_support_ext] = varargin{:};
    <span class="keyword">elseif</span> (length(varargin) == 3)
        [mp_params_ext, mp_support_ext, mp_support_graph_ext] = varargin{:};
    <span class="keyword">end</span>

<span class="keyword">else</span>
    close <span class="string">all</span>;
    mp_support_ext = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
    mp_support_ext(<span class="string">'bl_timer'</span>) = true;
    mp_support_ext(<span class="string">'bl_print_params'</span>) = true;
    mp_support_ext(<span class="string">'bl_print_iterinfo'</span>) = true;
    mp_support_ext(<span class="string">'ls_ffcmd'</span>) = {<span class="string">'v'</span>, <span class="string">'ap'</span>, <span class="string">'c'</span>, <span class="string">'y'</span>, <span class="string">'coh'</span>, <span class="string">'savefraccoh'</span>};
    mp_support_ext(<span class="string">'ls_ffsna'</span>) = {<span class="string">'ap'</span>};
    mp_support_ext(<span class="string">'ls_ffgrh'</span>) = {<span class="string">'v'</span>, <span class="string">'ap'</span>, <span class="string">'c'</span>, <span class="string">'y'</span>, <span class="string">'savefraccoh'</span>};
    mp_support_ext(<span class="string">'ls_store'</span>) = {<span class="string">'v'</span>, <span class="string">'ap'</span>, <span class="string">'c'</span>, <span class="string">'y'</span>, <span class="string">'coh'</span>};
    mp_support_ext(<span class="string">'ffsna_opt_it_row_n_keep'</span>) = 10;
    mp_support_ext(<span class="string">'ffsna_opt_it_col_n_keep'</span>) = 9;

<span class="keyword">end</span>
</pre><h2 id="4">Default Model Parameters</h2><p>support_map</p><pre class="codeinput">mp_params = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
mp_params(<span class="string">'fl_crra'</span>) = 1.5;
mp_params(<span class="string">'fl_beta'</span>) = 0.95;

mp_params(<span class="string">'fl_w'</span>) = 1.40;
mp_params(<span class="string">'fl_r'</span>) = 0.04;

mp_params(<span class="string">'fl_a_min'</span>) = 0;
mp_params(<span class="string">'fl_a_max'</span>) = 50;
mp_params(<span class="string">'it_a_n'</span>) = 100;
mp_params(<span class="string">'st_grid_type'</span>) = <span class="string">'grid_powerspace'</span>;

mp_params(<span class="string">'fl_z_persist'</span>) = 0.80;
mp_params(<span class="string">'fl_shk_std'</span>) = 0.20;
mp_params(<span class="string">'it_z_n'</span>) = 7;

<span class="comment">% override default support_map values</span>
<span class="keyword">if</span> (length(varargin)&gt;=1)
    mp_params = [mp_params; mp_params_ext];
<span class="keyword">end</span>
</pre><h2 id="5">Parse mp_params</h2><pre class="codeinput">params_group = values(mp_params, {<span class="string">'fl_crra'</span>, <span class="string">'fl_beta'</span>});
[fl_crra, fl_beta] = params_group{:};
params_group = values(mp_params, {<span class="string">'fl_w'</span>, <span class="string">'fl_r'</span>});
[fl_w, fl_r] = params_group{:};
params_group = values(mp_params, {<span class="string">'fl_a_min'</span>, <span class="string">'fl_a_max'</span>, <span class="string">'it_a_n'</span>, <span class="string">'st_grid_type'</span>});
[fl_a_min, fl_a_max, it_a_n, st_grid_type] = params_group{:};
params_group = values(mp_params, {<span class="string">'fl_z_persist'</span>, <span class="string">'fl_shk_std'</span>, <span class="string">'it_z_n'</span>});
[fl_z_persist, fl_shk_std, it_z_n] = params_group{:};
</pre><h2 id="6">Generate A and Z Grids</h2><p>Same min and max and grid points</p><pre class="codeinput">[ar_a] = ff_saveborr_grid(fl_a_min, fl_a_max, it_a_n, st_grid_type);
ar_a = ar_a';

<span class="comment">% shock vector and transition, normalize mean exp(shk) to 1</span>
<span class="comment">% [ar_z, mt_z_trans] = ffy_rouwenhorst(fl_z_persist, fl_shk_std, it_z_n);</span>
[ar_z, mt_z_trans] = ffy_tauchen(fl_z_persist, fl_shk_std, it_z_n);
<span class="comment">% normalize mean of exp to 1, fl_shk_std does not shift mean.</span>
ar_z_stationary = mt_z_trans^1000;
ar_z_stationary = ar_z_stationary(1,:);
fl_labor_agg = ar_z_stationary*exp(ar_z);
ar_z = exp(ar_z')/fl_labor_agg;
</pre><h2 id="7">Default Support Parameters</h2><p>support_map</p><pre class="codeinput">mp_support = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);

<span class="comment">% Model Control</span>
mp_support(<span class="string">'fl_lowestc'</span>) = -1e10;

<span class="comment">% Iteration Control</span>
mp_support(<span class="string">'it_maxiter_val'</span>) = 500;
mp_support(<span class="string">'fl_tol_val'</span>) = 1e-5;

<span class="comment">% printer various information</span>
mp_support(<span class="string">'bl_timer'</span>) = true;
mp_support(<span class="string">'bl_print_params'</span>) = false;
mp_support(<span class="string">'bl_print_iterinfo'</span>) = false;

<span class="comment">% These names must match keys of mp_solu:</span>
<span class="comment">% what outcomes to store in the mp_solu for export</span>
mp_support(<span class="string">'ls_slout'</span>) = {<span class="string">'v'</span>, <span class="string">'ap'</span>, <span class="string">'c'</span>, <span class="string">'y'</span>, <span class="string">'coh'</span>, <span class="string">'savefraccoh'</span>};
<span class="comment">% outcome for ff_container_map_display</span>
mp_support(<span class="string">'ls_ffcmd'</span>) = {<span class="string">'ap'</span>};
<span class="comment">% outcome for ff_summ_nd_array</span>
mp_support(<span class="string">'ls_ffsna'</span>) = {};
<span class="comment">% outcome for ff_graph_grid</span>
mp_support(<span class="string">'ls_ffgrh'</span>) = {};
<span class="comment">% outcome for ff_summ_nd_array</span>
mp_support(<span class="string">'ffsna_opt_it_row_n_keep'</span>) = 10;
<span class="comment">% outcome for ff_summ_nd_array</span>
mp_support(<span class="string">'ffsna_opt_it_col_n_keep'</span>) = 9;

<span class="comment">% override default support_map values</span>
<span class="keyword">if</span> (length(varargin)&gt;=2 || isempty(varargin))
    mp_support = [mp_support; mp_support_ext];
<span class="keyword">end</span>

<span class="comment">% Parse mp_support</span>
params_group = values(mp_support, {<span class="string">'fl_lowestc'</span>});
[fl_lowestc] = params_group{:};
params_group = values(mp_support, {<span class="string">'it_maxiter_val'</span>, <span class="string">'fl_tol_val'</span>});
[it_maxiter_val, fl_tol_val] = params_group{:};
params_group = values(mp_support, {<span class="string">'bl_timer'</span>, <span class="string">'bl_print_params'</span>, <span class="string">'bl_print_iterinfo'</span>});
[bl_timer, bl_print_params, bl_print_iterinfo] = params_group{:};
params_group = values(mp_support, <span class="keyword">...</span>
    {<span class="string">'ls_slout'</span>, <span class="string">'ls_ffcmd'</span>, <span class="string">'ls_ffsna'</span>, <span class="string">'ls_ffgrh'</span>,<span class="keyword">...</span>
    <span class="string">'ffsna_opt_it_row_n_keep'</span>, <span class="string">'ffsna_opt_it_col_n_keep'</span>});
[ls_slout, ls_ffcmd, ls_ffsna, ls_ffgrh,<span class="keyword">...</span>
    ffsna_opt_it_row_n_keep, ffsna_opt_it_col_n_keep] = params_group{:};
</pre><h2 id="8">Whether Additional Outcomes Should be Stored</h2><p>when state space are large, might not be a good idea to store all possible model output matrixes, but could be controlled with these if things should be outputed. If bl_store_more = true, will output store all additional possible outcomes if bl_vfi_store_all = true. Internally, which output becomes tabular or graphical controled by ls_ffcmd, ls_ffsna, and ls_ffgrh.</p><pre class="codeinput"><span class="comment">% If to store additional outcomes</span>
cl_more = {<span class="string">'c'</span>, <span class="string">'y'</span>, <span class="string">'coh'</span>, <span class="string">'savefraccoh'</span>};
ar_find_slout = cell2mat(cellfun(@(m) find(strcmp(ls_slout, m)), cl_more, <span class="string">'UniformOutput'</span>, false));
ar_find_ffcmd = cell2mat(cellfun(@(m) find(strcmp(ls_ffcmd, m)), cl_more, <span class="string">'UniformOutput'</span>, false));
ar_find_ffsna = cell2mat(cellfun(@(m) find(strcmp(ls_ffsna, m)), cl_more, <span class="string">'UniformOutput'</span>, false));
ar_find_ffgrh = cell2mat(cellfun(@(m) find(strcmp(ls_ffgrh, m)), cl_more, <span class="string">'UniformOutput'</span>, false));
<span class="keyword">if</span> (length(ar_find_slout) + length(ar_find_ffcmd) + length(ar_find_ffsna) + length(ar_find_ffgrh) &gt;1)
    bl_store_more = true;
<span class="keyword">end</span>
</pre><h2 id="9">Initialize Matrix</h2><pre class="codeinput">mt_val_lst = zeros(length(ar_a),length(ar_z));
mt_val_cur = mt_val_lst;
mt_aprime_lst = zeros(length(ar_a),length(ar_z));
mt_aprime_cur = mt_aprime_lst;
mt_aprime_idx = zeros(length(ar_a),length(ar_z));
ar_val_diff_norm = zeros([it_maxiter_val, 1]);
ar_pol_diff_norm = zeros([it_maxiter_val, 1]);
mt_pol_perc_change = zeros([it_maxiter_val, length(ar_z)]);

<span class="keyword">if</span> (bl_store_more)
    mt_c = zeros(length(ar_a),length(ar_z));
    mt_y = zeros(length(ar_a),length(ar_z));
    mt_coh = zeros(length(ar_a),length(ar_z));
<span class="keyword">end</span>
</pre><h2 id="10">Iterate and Dynamically Solve</h2><pre class="codeinput"><span class="keyword">if</span> (bl_timer)
    tic
<span class="keyword">end</span>

<span class="comment">% initialize</span>
fl_diff = 1;
it_iter = 0;

<span class="comment">% After converge, one more iteration to store results</span>
bl_continue = true;
bl_converged = false;

<span class="comment">% Loop 0, continuous VFI iteration until convergence</span>
<span class="keyword">while</span> bl_continue

    <span class="comment">% Loop 1, loop of exogenous shocks</span>
    <span class="keyword">for</span> it_z_ctr = 1:length(ar_z)
        fl_z = ar_z(it_z_ctr);

        <span class="comment">% Loop 2, loop over endogenous asset states</span>
        <span class="keyword">for</span> it_a_ctr = 1:length(ar_a)
            fl_a = ar_a(it_a_ctr);
            ar_ev = zeros(size(ar_a));

            <span class="keyword">if</span>(bl_store_more &amp;&amp; bl_converged)
                ar_c = zeros(size(ar_a));
            <span class="keyword">end</span>

            fl_y = fl_w*fl_z + (fl_r)*fl_a;

            <span class="comment">% Loop 3, loop over asset choices</span>
            <span class="keyword">for</span> it_ap_ctr = 1:length(ar_a)
                fl_aprime = ar_a(it_ap_ctr);
                fl_c = fl_y + fl_a - fl_aprime;

                <span class="keyword">if</span> fl_c &gt; 0

                    <span class="keyword">if</span> (fl_crra == 1)
                        ar_ev(it_ap_ctr) = log(fl_c);
                    <span class="keyword">else</span>
                        ar_ev(it_ap_ctr) = ((fl_c)^(1-fl_crra)-1)/(1-fl_crra);
                    <span class="keyword">end</span>

                    <span class="comment">% Loop 4, loop over future shocks</span>
                    <span class="keyword">for</span> it_zprime_ctr = 1:length(ar_z)
                        ar_ev(it_ap_ctr) = ar_ev(it_ap_ctr) <span class="keyword">...</span>
                            + fl_beta*mt_z_trans(it_z_ctr,it_zprime_ctr)*mt_val_lst(it_ap_ctr,it_zprime_ctr);
                    <span class="keyword">end</span>

                <span class="keyword">else</span>
                    fl_c = fl_lowestc;
                    ar_ev(it_ap_ctr) = fl_lowestc;
                <span class="keyword">end</span>

                <span class="keyword">if</span>(bl_store_more &amp;&amp; bl_converged)
                    ar_c(it_ap_ctr) = fl_c;
                <span class="keyword">end</span>
            <span class="keyword">end</span>

            it_opti_a_idx = find(ar_ev == max(ar_ev));
            mt_val_cur(it_a_ctr,it_z_ctr) = ar_ev(it_opti_a_idx(1));
            mt_aprime_cur(it_a_ctr,it_z_ctr) = ar_a(it_opti_a_idx(1));

            <span class="comment">% Save Additional Results</span>
            <span class="keyword">if</span> bl_converged
                mt_aprime_idx(it_a_ctr,it_z_ctr) = it_opti_a_idx(1);
                <span class="keyword">if</span> (bl_store_more)
                    mt_c(it_a_ctr,it_z_ctr) = ar_c(it_opti_a_idx(1));
                    mt_y(it_a_ctr,it_z_ctr) = fl_y;
                    mt_coh(it_a_ctr,it_z_ctr) = fl_y + fl_a;
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="comment">% Continuation Conditions:</span>
    it_iter = it_iter + 1;
    fl_diff = norm(mt_val_cur-mt_val_lst);
    diff_pol = norm(mt_aprime_cur-mt_aprime_lst);

    <span class="comment">% Difference across iterations</span>
    <span class="keyword">if</span> (bl_print_iterinfo)
        ar_val_diff_norm(it_iter) = fl_diff;
        ar_pol_diff_norm(it_iter) = diff_pol;
        mt_pol_perc_change(it_iter, :) = sum((mt_aprime_cur ~= mt_aprime_lst))/(length(ar_a));
    <span class="keyword">end</span>

    <span class="comment">% Update</span>
    mt_val_lst = mt_val_cur;
    mt_aprime_lst = mt_aprime_cur;

    <span class="comment">% Update Continue Criterion</span>
    <span class="keyword">if</span> bl_converged
        bl_continue = false;
    <span class="keyword">elseif</span>(fl_diff &lt;= fl_tol_val || it_iter &gt;= it_maxiter_val)
        bl_converged = true;
    <span class="keyword">end</span>

    <span class="comment">% Print Iteration Record</span>
    <span class="keyword">if</span>(bl_print_iterinfo)
        disp([<span class="string">'ff_vfi_az_bisec_loop, it_iter:'</span> num2str(it_iter) <span class="keyword">...</span>
            <span class="string">', fl_diff:'</span> num2str(fl_diff)]);
    <span class="keyword">end</span>

<span class="keyword">end</span>
</pre><pre class="codeoutput">ff_vfi_az_bisec_loop, it_iter:1, fl_diff:34.2979
ff_vfi_az_bisec_loop, it_iter:2, fl_diff:25.3365
ff_vfi_az_bisec_loop, it_iter:3, fl_diff:20.9401
ff_vfi_az_bisec_loop, it_iter:4, fl_diff:17.9444
ff_vfi_az_bisec_loop, it_iter:5, fl_diff:15.6932
ff_vfi_az_bisec_loop, it_iter:6, fl_diff:13.912
ff_vfi_az_bisec_loop, it_iter:7, fl_diff:12.4554
ff_vfi_az_bisec_loop, it_iter:8, fl_diff:11.2342
ff_vfi_az_bisec_loop, it_iter:9, fl_diff:10.1948
ff_vfi_az_bisec_loop, it_iter:10, fl_diff:9.295
ff_vfi_az_bisec_loop, it_iter:11, fl_diff:8.5098
ff_vfi_az_bisec_loop, it_iter:12, fl_diff:7.8187
ff_vfi_az_bisec_loop, it_iter:13, fl_diff:7.2048
ff_vfi_az_bisec_loop, it_iter:14, fl_diff:6.658
ff_vfi_az_bisec_loop, it_iter:15, fl_diff:6.1692
ff_vfi_az_bisec_loop, it_iter:16, fl_diff:5.7302
ff_vfi_az_bisec_loop, it_iter:17, fl_diff:5.3296
ff_vfi_az_bisec_loop, it_iter:18, fl_diff:4.9598
ff_vfi_az_bisec_loop, it_iter:19, fl_diff:4.6199
ff_vfi_az_bisec_loop, it_iter:20, fl_diff:4.3065
ff_vfi_az_bisec_loop, it_iter:21, fl_diff:4.0182
ff_vfi_az_bisec_loop, it_iter:22, fl_diff:3.7543
ff_vfi_az_bisec_loop, it_iter:23, fl_diff:3.5127
ff_vfi_az_bisec_loop, it_iter:24, fl_diff:3.2908
ff_vfi_az_bisec_loop, it_iter:25, fl_diff:3.0867
ff_vfi_az_bisec_loop, it_iter:26, fl_diff:2.8985
ff_vfi_az_bisec_loop, it_iter:27, fl_diff:2.7235
ff_vfi_az_bisec_loop, it_iter:28, fl_diff:2.5603
ff_vfi_az_bisec_loop, it_iter:29, fl_diff:2.4097
ff_vfi_az_bisec_loop, it_iter:30, fl_diff:2.269
ff_vfi_az_bisec_loop, it_iter:31, fl_diff:2.1368
ff_vfi_az_bisec_loop, it_iter:32, fl_diff:2.0128
ff_vfi_az_bisec_loop, it_iter:33, fl_diff:1.8969
ff_vfi_az_bisec_loop, it_iter:34, fl_diff:1.7878
ff_vfi_az_bisec_loop, it_iter:35, fl_diff:1.6851
ff_vfi_az_bisec_loop, it_iter:36, fl_diff:1.5885
ff_vfi_az_bisec_loop, it_iter:37, fl_diff:1.4977
ff_vfi_az_bisec_loop, it_iter:38, fl_diff:1.4124
ff_vfi_az_bisec_loop, it_iter:39, fl_diff:1.3324
ff_vfi_az_bisec_loop, it_iter:40, fl_diff:1.2571
ff_vfi_az_bisec_loop, it_iter:41, fl_diff:1.1865
ff_vfi_az_bisec_loop, it_iter:42, fl_diff:1.1201
ff_vfi_az_bisec_loop, it_iter:43, fl_diff:1.0577
ff_vfi_az_bisec_loop, it_iter:44, fl_diff:0.99885
ff_vfi_az_bisec_loop, it_iter:45, fl_diff:0.9434
ff_vfi_az_bisec_loop, it_iter:46, fl_diff:0.89115
ff_vfi_az_bisec_loop, it_iter:47, fl_diff:0.84185
ff_vfi_az_bisec_loop, it_iter:48, fl_diff:0.79533
ff_vfi_az_bisec_loop, it_iter:49, fl_diff:0.75143
ff_vfi_az_bisec_loop, it_iter:50, fl_diff:0.71002
ff_vfi_az_bisec_loop, it_iter:51, fl_diff:0.67096
ff_vfi_az_bisec_loop, it_iter:52, fl_diff:0.63409
ff_vfi_az_bisec_loop, it_iter:53, fl_diff:0.59928
ff_vfi_az_bisec_loop, it_iter:54, fl_diff:0.56643
ff_vfi_az_bisec_loop, it_iter:55, fl_diff:0.53544
ff_vfi_az_bisec_loop, it_iter:56, fl_diff:0.50617
ff_vfi_az_bisec_loop, it_iter:57, fl_diff:0.47855
ff_vfi_az_bisec_loop, it_iter:58, fl_diff:0.45248
ff_vfi_az_bisec_loop, it_iter:59, fl_diff:0.42787
ff_vfi_az_bisec_loop, it_iter:60, fl_diff:0.40464
ff_vfi_az_bisec_loop, it_iter:61, fl_diff:0.38271
ff_vfi_az_bisec_loop, it_iter:62, fl_diff:0.362
ff_vfi_az_bisec_loop, it_iter:63, fl_diff:0.34243
ff_vfi_az_bisec_loop, it_iter:64, fl_diff:0.32396
ff_vfi_az_bisec_loop, it_iter:65, fl_diff:0.30651
ff_vfi_az_bisec_loop, it_iter:66, fl_diff:0.29003
ff_vfi_az_bisec_loop, it_iter:67, fl_diff:0.27447
ff_vfi_az_bisec_loop, it_iter:68, fl_diff:0.25977
ff_vfi_az_bisec_loop, it_iter:69, fl_diff:0.24588
ff_vfi_az_bisec_loop, it_iter:70, fl_diff:0.23276
ff_vfi_az_bisec_loop, it_iter:71, fl_diff:0.22036
ff_vfi_az_bisec_loop, it_iter:72, fl_diff:0.20863
ff_vfi_az_bisec_loop, it_iter:73, fl_diff:0.19755
ff_vfi_az_bisec_loop, it_iter:74, fl_diff:0.18708
ff_vfi_az_bisec_loop, it_iter:75, fl_diff:0.17717
ff_vfi_az_bisec_loop, it_iter:76, fl_diff:0.16781
ff_vfi_az_bisec_loop, it_iter:77, fl_diff:0.15895
ff_vfi_az_bisec_loop, it_iter:78, fl_diff:0.15058
ff_vfi_az_bisec_loop, it_iter:79, fl_diff:0.14266
ff_vfi_az_bisec_loop, it_iter:80, fl_diff:0.13517
ff_vfi_az_bisec_loop, it_iter:81, fl_diff:0.12808
ff_vfi_az_bisec_loop, it_iter:82, fl_diff:0.12138
ff_vfi_az_bisec_loop, it_iter:83, fl_diff:0.11503
ff_vfi_az_bisec_loop, it_iter:84, fl_diff:0.10903
ff_vfi_az_bisec_loop, it_iter:85, fl_diff:0.10334
ff_vfi_az_bisec_loop, it_iter:86, fl_diff:0.097965
ff_vfi_az_bisec_loop, it_iter:87, fl_diff:0.092873
ff_vfi_az_bisec_loop, it_iter:88, fl_diff:0.088052
ff_vfi_az_bisec_loop, it_iter:89, fl_diff:0.083487
ff_vfi_az_bisec_loop, it_iter:90, fl_diff:0.079165
ff_vfi_az_bisec_loop, it_iter:91, fl_diff:0.075071
ff_vfi_az_bisec_loop, it_iter:92, fl_diff:0.071194
ff_vfi_az_bisec_loop, it_iter:93, fl_diff:0.067521
ff_vfi_az_bisec_loop, it_iter:94, fl_diff:0.064043
ff_vfi_az_bisec_loop, it_iter:95, fl_diff:0.060747
ff_vfi_az_bisec_loop, it_iter:96, fl_diff:0.057624
ff_vfi_az_bisec_loop, it_iter:97, fl_diff:0.054665
ff_vfi_az_bisec_loop, it_iter:98, fl_diff:0.051861
ff_vfi_az_bisec_loop, it_iter:99, fl_diff:0.049203
ff_vfi_az_bisec_loop, it_iter:100, fl_diff:0.046683
ff_vfi_az_bisec_loop, it_iter:101, fl_diff:0.044295
ff_vfi_az_bisec_loop, it_iter:102, fl_diff:0.042031
ff_vfi_az_bisec_loop, it_iter:103, fl_diff:0.039885
ff_vfi_az_bisec_loop, it_iter:104, fl_diff:0.03785
ff_vfi_az_bisec_loop, it_iter:105, fl_diff:0.03592
ff_vfi_az_bisec_loop, it_iter:106, fl_diff:0.034091
ff_vfi_az_bisec_loop, it_iter:107, fl_diff:0.032355
ff_vfi_az_bisec_loop, it_iter:108, fl_diff:0.030709
ff_vfi_az_bisec_loop, it_iter:109, fl_diff:0.029148
ff_vfi_az_bisec_loop, it_iter:110, fl_diff:0.027668
ff_vfi_az_bisec_loop, it_iter:111, fl_diff:0.026263
ff_vfi_az_bisec_loop, it_iter:112, fl_diff:0.024931
ff_vfi_az_bisec_loop, it_iter:113, fl_diff:0.023667
ff_vfi_az_bisec_loop, it_iter:114, fl_diff:0.022468
ff_vfi_az_bisec_loop, it_iter:115, fl_diff:0.02133
ff_vfi_az_bisec_loop, it_iter:116, fl_diff:0.02025
ff_vfi_az_bisec_loop, it_iter:117, fl_diff:0.019226
ff_vfi_az_bisec_loop, it_iter:118, fl_diff:0.018254
ff_vfi_az_bisec_loop, it_iter:119, fl_diff:0.017331
ff_vfi_az_bisec_loop, it_iter:120, fl_diff:0.016456
ff_vfi_az_bisec_loop, it_iter:121, fl_diff:0.015625
ff_vfi_az_bisec_loop, it_iter:122, fl_diff:0.014836
ff_vfi_az_bisec_loop, it_iter:123, fl_diff:0.014087
ff_vfi_az_bisec_loop, it_iter:124, fl_diff:0.013377
ff_vfi_az_bisec_loop, it_iter:125, fl_diff:0.012703
ff_vfi_az_bisec_loop, it_iter:126, fl_diff:0.012062
ff_vfi_az_bisec_loop, it_iter:127, fl_diff:0.011455
ff_vfi_az_bisec_loop, it_iter:128, fl_diff:0.010878
ff_vfi_az_bisec_loop, it_iter:129, fl_diff:0.01033
ff_vfi_az_bisec_loop, it_iter:130, fl_diff:0.0098101
ff_vfi_az_bisec_loop, it_iter:131, fl_diff:0.0093164
ff_vfi_az_bisec_loop, it_iter:132, fl_diff:0.0088478
ff_vfi_az_bisec_loop, it_iter:133, fl_diff:0.0084028
ff_vfi_az_bisec_loop, it_iter:134, fl_diff:0.0079803
ff_vfi_az_bisec_loop, it_iter:135, fl_diff:0.0075792
ff_vfi_az_bisec_loop, it_iter:136, fl_diff:0.0071983
ff_vfi_az_bisec_loop, it_iter:137, fl_diff:0.0068366
ff_vfi_az_bisec_loop, it_iter:138, fl_diff:0.0064932
ff_vfi_az_bisec_loop, it_iter:139, fl_diff:0.006167
ff_vfi_az_bisec_loop, it_iter:140, fl_diff:0.0058574
ff_vfi_az_bisec_loop, it_iter:141, fl_diff:0.0055633
ff_vfi_az_bisec_loop, it_iter:142, fl_diff:0.005284
ff_vfi_az_bisec_loop, it_iter:143, fl_diff:0.0050189
ff_vfi_az_bisec_loop, it_iter:144, fl_diff:0.004767
ff_vfi_az_bisec_loop, it_iter:145, fl_diff:0.0045278
ff_vfi_az_bisec_loop, it_iter:146, fl_diff:0.0043007
ff_vfi_az_bisec_loop, it_iter:147, fl_diff:0.004085
ff_vfi_az_bisec_loop, it_iter:148, fl_diff:0.0038801
ff_vfi_az_bisec_loop, it_iter:149, fl_diff:0.0036856
ff_vfi_az_bisec_loop, it_iter:150, fl_diff:0.0035008
ff_vfi_az_bisec_loop, it_iter:151, fl_diff:0.0033253
ff_vfi_az_bisec_loop, it_iter:152, fl_diff:0.0031586
ff_vfi_az_bisec_loop, it_iter:153, fl_diff:0.0030003
ff_vfi_az_bisec_loop, it_iter:154, fl_diff:0.00285
ff_vfi_az_bisec_loop, it_iter:155, fl_diff:0.0027072
ff_vfi_az_bisec_loop, it_iter:156, fl_diff:0.0025715
ff_vfi_az_bisec_loop, it_iter:157, fl_diff:0.0024427
ff_vfi_az_bisec_loop, it_iter:158, fl_diff:0.0023203
ff_vfi_az_bisec_loop, it_iter:159, fl_diff:0.0022041
ff_vfi_az_bisec_loop, it_iter:160, fl_diff:0.0020937
ff_vfi_az_bisec_loop, it_iter:161, fl_diff:0.0019888
ff_vfi_az_bisec_loop, it_iter:162, fl_diff:0.0018892
ff_vfi_az_bisec_loop, it_iter:163, fl_diff:0.0017946
ff_vfi_az_bisec_loop, it_iter:164, fl_diff:0.0017048
ff_vfi_az_bisec_loop, it_iter:165, fl_diff:0.0016194
ff_vfi_az_bisec_loop, it_iter:166, fl_diff:0.0015383
ff_vfi_az_bisec_loop, it_iter:167, fl_diff:0.0014613
ff_vfi_az_bisec_loop, it_iter:168, fl_diff:0.0013882
ff_vfi_az_bisec_loop, it_iter:169, fl_diff:0.0013187
ff_vfi_az_bisec_loop, it_iter:170, fl_diff:0.0012527
ff_vfi_az_bisec_loop, it_iter:171, fl_diff:0.00119
ff_vfi_az_bisec_loop, it_iter:172, fl_diff:0.0011304
ff_vfi_az_bisec_loop, it_iter:173, fl_diff:0.0010738
ff_vfi_az_bisec_loop, it_iter:174, fl_diff:0.0010201
ff_vfi_az_bisec_loop, it_iter:175, fl_diff:0.00096905
ff_vfi_az_bisec_loop, it_iter:176, fl_diff:0.00092056
ff_vfi_az_bisec_loop, it_iter:177, fl_diff:0.00087449
ff_vfi_az_bisec_loop, it_iter:178, fl_diff:0.00083073
ff_vfi_az_bisec_loop, it_iter:179, fl_diff:0.00078917
ff_vfi_az_bisec_loop, it_iter:180, fl_diff:0.00074968
ff_vfi_az_bisec_loop, it_iter:181, fl_diff:0.00071217
ff_vfi_az_bisec_loop, it_iter:182, fl_diff:0.00067654
ff_vfi_az_bisec_loop, it_iter:183, fl_diff:0.00064269
ff_vfi_az_bisec_loop, it_iter:184, fl_diff:0.00061054
ff_vfi_az_bisec_loop, it_iter:185, fl_diff:0.00058
ff_vfi_az_bisec_loop, it_iter:186, fl_diff:0.00055098
ff_vfi_az_bisec_loop, it_iter:187, fl_diff:0.00052342
ff_vfi_az_bisec_loop, it_iter:188, fl_diff:0.00049723
ff_vfi_az_bisec_loop, it_iter:189, fl_diff:0.00047236
ff_vfi_az_bisec_loop, it_iter:190, fl_diff:0.00044873
ff_vfi_az_bisec_loop, it_iter:191, fl_diff:0.00042629
ff_vfi_az_bisec_loop, it_iter:192, fl_diff:0.00040496
ff_vfi_az_bisec_loop, it_iter:193, fl_diff:0.00038471
ff_vfi_az_bisec_loop, it_iter:194, fl_diff:0.00036547
ff_vfi_az_bisec_loop, it_iter:195, fl_diff:0.00034719
ff_vfi_az_bisec_loop, it_iter:196, fl_diff:0.00032982
ff_vfi_az_bisec_loop, it_iter:197, fl_diff:0.00031332
ff_vfi_az_bisec_loop, it_iter:198, fl_diff:0.00029765
ff_vfi_az_bisec_loop, it_iter:199, fl_diff:0.00028277
ff_vfi_az_bisec_loop, it_iter:200, fl_diff:0.00026862
ff_vfi_az_bisec_loop, it_iter:201, fl_diff:0.00025519
ff_vfi_az_bisec_loop, it_iter:202, fl_diff:0.00024243
ff_vfi_az_bisec_loop, it_iter:203, fl_diff:0.0002303
ff_vfi_az_bisec_loop, it_iter:204, fl_diff:0.00021878
ff_vfi_az_bisec_loop, it_iter:205, fl_diff:0.00020784
ff_vfi_az_bisec_loop, it_iter:206, fl_diff:0.00019745
ff_vfi_az_bisec_loop, it_iter:207, fl_diff:0.00018757
ff_vfi_az_bisec_loop, it_iter:208, fl_diff:0.00017819
ff_vfi_az_bisec_loop, it_iter:209, fl_diff:0.00016928
ff_vfi_az_bisec_loop, it_iter:210, fl_diff:0.00016082
ff_vfi_az_bisec_loop, it_iter:211, fl_diff:0.00015277
ff_vfi_az_bisec_loop, it_iter:212, fl_diff:0.00014513
ff_vfi_az_bisec_loop, it_iter:213, fl_diff:0.00013788
ff_vfi_az_bisec_loop, it_iter:214, fl_diff:0.00013098
ff_vfi_az_bisec_loop, it_iter:215, fl_diff:0.00012443
ff_vfi_az_bisec_loop, it_iter:216, fl_diff:0.00011821
ff_vfi_az_bisec_loop, it_iter:217, fl_diff:0.0001123
ff_vfi_az_bisec_loop, it_iter:218, fl_diff:0.00010668
ff_vfi_az_bisec_loop, it_iter:219, fl_diff:0.00010135
ff_vfi_az_bisec_loop, it_iter:220, fl_diff:9.628e-05
ff_vfi_az_bisec_loop, it_iter:221, fl_diff:9.1465e-05
ff_vfi_az_bisec_loop, it_iter:222, fl_diff:8.6892e-05
ff_vfi_az_bisec_loop, it_iter:223, fl_diff:8.2547e-05
ff_vfi_az_bisec_loop, it_iter:224, fl_diff:7.8419e-05
ff_vfi_az_bisec_loop, it_iter:225, fl_diff:7.4498e-05
ff_vfi_az_bisec_loop, it_iter:226, fl_diff:7.0773e-05
ff_vfi_az_bisec_loop, it_iter:227, fl_diff:6.7234e-05
ff_vfi_az_bisec_loop, it_iter:228, fl_diff:6.3872e-05
ff_vfi_az_bisec_loop, it_iter:229, fl_diff:6.0678e-05
ff_vfi_az_bisec_loop, it_iter:230, fl_diff:5.7644e-05
ff_vfi_az_bisec_loop, it_iter:231, fl_diff:5.4761e-05
ff_vfi_az_bisec_loop, it_iter:232, fl_diff:5.2023e-05
ff_vfi_az_bisec_loop, it_iter:233, fl_diff:4.9422e-05
ff_vfi_az_bisec_loop, it_iter:234, fl_diff:4.6951e-05
ff_vfi_az_bisec_loop, it_iter:235, fl_diff:4.4603e-05
ff_vfi_az_bisec_loop, it_iter:236, fl_diff:4.2373e-05
ff_vfi_az_bisec_loop, it_iter:237, fl_diff:4.0254e-05
ff_vfi_az_bisec_loop, it_iter:238, fl_diff:3.8241e-05
ff_vfi_az_bisec_loop, it_iter:239, fl_diff:3.6329e-05
ff_vfi_az_bisec_loop, it_iter:240, fl_diff:3.4512e-05
ff_vfi_az_bisec_loop, it_iter:241, fl_diff:3.2787e-05
ff_vfi_az_bisec_loop, it_iter:242, fl_diff:3.1147e-05
ff_vfi_az_bisec_loop, it_iter:243, fl_diff:2.959e-05
ff_vfi_az_bisec_loop, it_iter:244, fl_diff:2.811e-05
ff_vfi_az_bisec_loop, it_iter:245, fl_diff:2.6705e-05
ff_vfi_az_bisec_loop, it_iter:246, fl_diff:2.537e-05
ff_vfi_az_bisec_loop, it_iter:247, fl_diff:2.4101e-05
ff_vfi_az_bisec_loop, it_iter:248, fl_diff:2.2896e-05
ff_vfi_az_bisec_loop, it_iter:249, fl_diff:2.1751e-05
ff_vfi_az_bisec_loop, it_iter:250, fl_diff:2.0664e-05
ff_vfi_az_bisec_loop, it_iter:251, fl_diff:1.963e-05
ff_vfi_az_bisec_loop, it_iter:252, fl_diff:1.8649e-05
ff_vfi_az_bisec_loop, it_iter:253, fl_diff:1.7716e-05
ff_vfi_az_bisec_loop, it_iter:254, fl_diff:1.683e-05
ff_vfi_az_bisec_loop, it_iter:255, fl_diff:1.5989e-05
ff_vfi_az_bisec_loop, it_iter:256, fl_diff:1.5189e-05
ff_vfi_az_bisec_loop, it_iter:257, fl_diff:1.443e-05
ff_vfi_az_bisec_loop, it_iter:258, fl_diff:1.3708e-05
ff_vfi_az_bisec_loop, it_iter:259, fl_diff:1.3023e-05
ff_vfi_az_bisec_loop, it_iter:260, fl_diff:1.2372e-05
ff_vfi_az_bisec_loop, it_iter:261, fl_diff:1.1753e-05
ff_vfi_az_bisec_loop, it_iter:262, fl_diff:1.1166e-05
ff_vfi_az_bisec_loop, it_iter:263, fl_diff:1.0607e-05
ff_vfi_az_bisec_loop, it_iter:264, fl_diff:1.0077e-05
ff_vfi_az_bisec_loop, it_iter:265, fl_diff:9.5731e-06
ff_vfi_az_bisec_loop, it_iter:266, fl_diff:9.0944e-06
</pre><h2 id="11">Convergence Results</h2><pre class="codeinput">it_iter_last = it_iter;
<span class="keyword">if</span> fl_diff &lt;= fl_tol_val || it_iter&gt;=it_maxiter_val
    <span class="keyword">if</span> (it_iter&gt;=it_maxiter_val)
        flag = 2;
    <span class="keyword">else</span>
        flag = 1;
    <span class="keyword">end</span>
<span class="keyword">else</span>
    flag = 0;
<span class="keyword">end</span>

<span class="keyword">if</span> (bl_timer)
    toc
<span class="keyword">end</span>
</pre><pre class="codeoutput">Elapsed time is 2.265778 seconds.
</pre><h2 id="12">Results for Printing, and Graphing</h2><pre class="codeinput">mp_print_graph = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
mp_print_graph(<span class="string">'v'</span>) = mt_val_cur;
mp_print_graph(<span class="string">'ap'</span>) = mt_aprime_lst;
<span class="keyword">if</span> (bl_store_more)
    mp_print_graph(<span class="string">'c'</span>) = mt_c;
    mp_print_graph(<span class="string">'y'</span>) = mt_y;
    mp_print_graph(<span class="string">'coh'</span>) = mt_coh;
    mp_print_graph(<span class="string">'savefraccoh'</span>) = mt_aprime_lst./mt_coh;
<span class="keyword">end</span>
</pre><h2 id="13">Print Parameter Information</h2><pre class="codeinput"><span class="keyword">if</span> (bl_print_params)
    ff_container_map_display(mp_params);
    ff_container_map_display(mp_support);
<span class="keyword">end</span>
</pre><pre class="codeoutput">----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params Scalars
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                    i     idx    value
                    __    ___    _____

    fl_a_max         1     1       50 
    fl_a_min         2     2        0 
    fl_beta          3     3     0.95 
    fl_crra          4     4      1.5 
    fl_r             5     5     0.04 
    fl_shk_std       6     6      0.2 
    fl_w             7     7      1.4 
    fl_z_persist     8     8      0.8 
    it_a_n           9     9      100 
    it_z_n          10    10        7 

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params String
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                     i     idx          string      
                    ___    ____    _________________

    st_grid_type    "1"    "11"    "grid_powerspace"

pos = 11 ; key = ls_ffsna
    'ap'

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_support Scalars
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                               i    idx    value 
                               _    ___    ______

    bl_print_iterinfo          1     1          1
    bl_print_params            2     2          1
    bl_timer                   3     3          1
    ffsna_opt_it_col_n_keep    4     4          9
    ffsna_opt_it_row_n_keep    5     5         10
    fl_lowestc                 6     6     -1e+10
    fl_tol_val                 7     7      1e-05
    it_maxiter_val             8     8        500

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_support String
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                 i     idx               string          
                ___    ____    __________________________

    ls_ffcmd    "1"    "9"     "v;ap;c;y;coh;savefraccoh"
    ls_ffgrh    "2"    "10"    "v;ap;c;y;savefraccoh"    
    ls_slout    "3"    "12"    "v;ap;c;y;coh;savefraccoh"
    ls_store    "4"    "13"    "v;ap;c;y;coh"            

</pre><h2 id="14">Show Value Function Convergence Information</h2><pre class="codeinput"><span class="keyword">if</span> (bl_print_iterinfo)

    it_z_select = unique(round(linspace(1,length(ar_z), 7)));
    ar_z_select = ar_z(it_z_select);
    tb_valpol_alliter = array2table([ar_val_diff_norm(1:it_iter_last)';<span class="keyword">...</span>
        ar_pol_diff_norm(1:it_iter_last)';<span class="keyword">...</span>
        mt_pol_perc_change(1:it_iter_last,it_z_select)']');
    ar_st_col_zs = matlab.lang.makeValidName(strcat(<span class="string">'z='</span>, string(ar_z_select)));
    cl_col_names = [<span class="string">'valgap'</span>, <span class="string">'polgap'</span>, ar_st_col_zs];
    cl_row_names = strcat(<span class="string">'iter='</span>, string(1:it_iter_last));
    tb_valpol_alliter.Properties.VariableNames = cl_col_names;
    tb_valpol_alliter.Properties.RowNames = cl_row_names;
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'Value Function Iteration Per Iteration Changes'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'valgap = norm(mt_val - mt_val_cur): value function difference across iterations'</span>);
    disp(<span class="string">'polgap = norm(mt_pol_a - mt_pol_a_cur): policy function difference across iterations'</span>);
    disp([<span class="string">'z1 = z1 perc change: sum((mt_pol_a ~= mt_pol_a_cur))/(it_a_n): percentage of state space'</span><span class="keyword">...</span>
        <span class="string">' points conditional on shock where the policy function is changing across iterations'</span>]);
    disp(tb_valpol_alliter);

<span class="keyword">end</span>
</pre><pre class="codeoutput">xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Value Function Iteration Per Iteration Changes
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
valgap = norm(mt_val - mt_val_cur): value function difference across iterations
polgap = norm(mt_pol_a - mt_pol_a_cur): policy function difference across iterations
z1 = z1 perc change: sum((mt_pol_a ~= mt_pol_a_cur))/(it_a_n): percentage of state space points conditional on shock where the policy function is changing across iterations
                  valgap      polgap     z_0_34387    z_0_47991    z_0_66977    z_0_93474    z_1_3045    z_1_8206    z_2_5409
                __________    _______    _________    _________    _________    _________    ________    ________    ________

    iter=1          34.298          0         0            0            0            0            0           0           0  
    iter=2          25.337     277.76      0.91         0.92         0.94            1            1           1           1  
    iter=3           20.94     92.992      0.88         0.84         0.88            1            1           1           1  
    iter=4          17.944     46.526      0.74         0.83         0.79         0.93            1           1           1  
    iter=5          15.693     27.675       0.7         0.72          0.8          0.8         0.89        0.99           1  
    iter=6          13.912     19.175      0.62         0.58         0.63         0.69         0.78        0.89        0.93  
    iter=7          12.455     13.544      0.44         0.43          0.5         0.56         0.58        0.67        0.83  
    iter=8          11.234     9.8635      0.27         0.27         0.35         0.37         0.51        0.53         0.6  
    iter=9          10.195     8.4584      0.23         0.22         0.27         0.29         0.33        0.42        0.43  
    iter=10          9.295     6.5943      0.11         0.19          0.2         0.26          0.3         0.3        0.39  
    iter=11         8.5098     6.4847      0.13         0.27         0.17         0.17         0.21        0.33        0.34  
    iter=12         7.8187     4.3097      0.03         0.12         0.08         0.14         0.16        0.21        0.22  
    iter=13         7.2048     4.7017      0.24          0.1          0.1         0.19         0.21        0.15        0.22  
    iter=14          6.658     3.6855      0.12          0.1         0.09         0.13          0.1        0.15        0.17  
    iter=15         6.1692     4.4935      0.12         0.11         0.08         0.05         0.12        0.14        0.16  
    iter=16         5.7302     4.7169      0.11         0.05            0         0.06         0.08        0.15        0.14  
    iter=17         5.3296     2.5274      0.01            0            0         0.06          0.1        0.07         0.1  
    iter=18         4.9598     3.3038      0.01            0            0         0.07         0.09        0.06        0.14  
    iter=19         4.6199     3.0509         0            0            0         0.07         0.08        0.12        0.08  
    iter=20         4.3065     2.1941         0            0            0         0.06         0.03        0.05        0.04  
    iter=21         4.0182     2.6377         0            0         0.13         0.06         0.05        0.09        0.09  
    iter=22         3.7543     2.9144         0         0.01         0.15         0.08         0.02        0.05        0.05  
    iter=23         3.5127     2.4602      0.01            0          0.1            0         0.03        0.05        0.08  
    iter=24         3.2908     2.9194         0            0         0.09            0         0.03        0.05        0.04  
    iter=25         3.0867     3.5362         0            0         0.09            0         0.04        0.05        0.04  
    iter=26         2.8985     2.2026         0            0         0.02         0.01         0.03        0.05        0.04  
    iter=27         2.7235     1.3968         0            0            0            0         0.03        0.03        0.04  
    iter=28         2.5603     3.7503         0         0.15         0.01         0.01         0.01        0.01        0.04  
    iter=29         2.4097     3.7562         0         0.13            0            0         0.02        0.02        0.02  
    iter=30          2.269     1.6988         0         0.03            0            0         0.03        0.01        0.05  
    iter=31         2.1368     1.5979         0         0.01         0.01         0.01         0.03           0        0.06  
    iter=32         2.0128     3.8081      0.11         0.02            0         0.01         0.02        0.02        0.01  
    iter=33         1.8969     2.5752      0.06         0.01            0            0         0.02        0.02        0.03  
    iter=34         1.7878      1.574      0.03         0.01            0            0         0.01           0        0.01  
    iter=35         1.6851     1.5974      0.01         0.01            0            0         0.03        0.01        0.03  
    iter=36         1.5885     1.5237      0.02            0            0            0         0.03           0           0  
    iter=37         1.4977     1.5737      0.01         0.01         0.01            0         0.02        0.03        0.01  
    iter=38         1.4124     1.6259      0.01            0            0            0         0.02           0        0.02  
    iter=39         1.3324     1.1775         0         0.01            0            0         0.01        0.01        0.01  
    iter=40         1.2571     1.7052      0.01            0            0            0         0.02           0           0  
    iter=41         1.1865     1.7587      0.01            0            0            0         0.02        0.01        0.02  
    iter=42         1.1201    0.57353         0         0.01            0            0            0           0           0  
    iter=43         1.0577    0.82425      0.01            0            0            0            0        0.01        0.02  
    iter=44        0.99885    0.20539         0            0            0         0.01            0           0           0  
    iter=45         0.9434    0.85766      0.01            0            0            0            0        0.01        0.01  
    iter=46        0.89115    0.96516         0            0            0            0            0        0.02        0.01  
    iter=47        0.84185          0         0            0            0            0            0           0           0  
    iter=48        0.79533    0.72671      0.01         0.01            0            0         0.01           0        0.01  
    iter=49        0.75143    0.86713         0            0            0            0            0        0.02           0  
    iter=50        0.71002    0.87453         0            0            0            0            0           0        0.01  
    iter=51        0.67096     0.6032         0            0            0            0            0           0        0.01  
    iter=52        0.63409          0         0            0            0            0            0           0           0  
    iter=53        0.59928          0         0            0            0            0            0           0           0  
    iter=54        0.56643    0.87453      0.01            0            0            0            0        0.01           0  
    iter=55        0.53544          0         0            0            0            0            0           0           0  
    iter=56        0.50617          0         0            0            0            0            0           0           0  
    iter=57        0.47855          0         0            0            0            0            0           0           0  
    iter=58        0.45248    0.89152         0            0            0            0            0           0        0.01  
    iter=59        0.42787    0.89152         0            0            0            0            0        0.01           0  
    iter=60        0.40464    0.47374         0            0            0            0            0           0        0.01  
    iter=61        0.38271          0         0            0            0            0            0           0           0  
    iter=62          0.362          0         0            0            0            0            0           0           0  
    iter=63        0.34243          0         0            0            0            0            0           0           0  
    iter=64        0.32396          0         0            0            0            0            0           0           0  
    iter=65        0.30651          0         0            0            0            0            0           0           0  
    iter=66        0.29003          0         0            0            0            0            0           0           0  
    iter=67        0.27447     0.9086         0            0            0            0            0        0.01           0  
    iter=68        0.25977          0         0            0            0            0            0           0           0  
    iter=69        0.24588          0         0            0            0            0            0           0           0  
    iter=70        0.23276          0         0            0            0            0            0           0           0  
    iter=71        0.22036          0         0            0            0            0            0           0           0  
    iter=72        0.20863          0         0            0            0            0            0           0           0  
    iter=73        0.19755          0         0            0            0            0            0           0           0  
    iter=74        0.18708          0         0            0            0            0            0           0           0  
    iter=75        0.17717          0         0            0            0            0            0           0           0  
    iter=76        0.16781          0         0            0            0            0            0           0           0  
    iter=77        0.15895          0         0            0            0            0            0           0           0  
    iter=78        0.15058          0         0            0            0            0            0           0           0  
    iter=79        0.14266          0         0            0            0            0            0           0           0  
    iter=80        0.13517          0         0            0            0            0            0           0           0  
    iter=81        0.12808          0         0            0            0            0            0           0           0  
    iter=82        0.12138          0         0            0            0            0            0           0           0  
    iter=83        0.11503    0.69512      0.01            0            0            0            0           0           0  
    iter=84        0.10903     0.9086         0            0            0            0            0           0        0.01  
    iter=85        0.10334          0         0            0            0            0            0           0           0  
    iter=86       0.097965          0         0            0            0            0            0           0           0  
    iter=87       0.092873          0         0            0            0            0            0           0           0  
    iter=88       0.088052          0         0            0            0            0            0           0           0  
    iter=89       0.083487          0         0            0            0            0            0           0           0  
    iter=90       0.079165          0         0            0            0            0            0           0           0  
    iter=91       0.075071          0         0            0            0            0            0           0           0  
    iter=92       0.071194          0         0            0            0            0            0           0           0  
    iter=93       0.067521     0.9258         0            0            0            0            0        0.01           0  
    iter=94       0.064043          0         0            0            0            0            0           0           0  
    iter=95       0.060747          0         0            0            0            0            0           0           0  
    iter=96       0.057624          0         0            0            0            0            0           0           0  
    iter=97       0.054665          0         0            0            0            0            0           0           0  
    iter=98       0.051861          0         0            0            0            0            0           0           0  
    iter=99       0.049203          0         0            0            0            0            0           0           0  
    iter=100      0.046683          0         0            0            0            0            0           0           0  
    iter=101      0.044295          0         0            0            0            0            0           0           0  
    iter=102      0.042031          0         0            0            0            0            0           0           0  
    iter=103      0.039885          0         0            0            0            0            0           0           0  
    iter=104       0.03785          0         0            0            0            0            0           0           0  
    iter=105       0.03592          0         0            0            0            0            0           0           0  
    iter=106      0.034091          0         0            0            0            0            0           0           0  
    iter=107      0.032355          0         0            0            0            0            0           0           0  
    iter=108      0.030709          0         0            0            0            0            0           0           0  
    iter=109      0.029148          0         0            0            0            0            0           0           0  
    iter=110      0.027668          0         0            0            0            0            0           0           0  
    iter=111      0.026263          0         0            0            0            0            0           0           0  
    iter=112      0.024931          0         0            0            0            0            0           0           0  
    iter=113      0.023667          0         0            0            0            0            0           0           0  
    iter=114      0.022468          0         0            0            0            0            0           0           0  
    iter=115       0.02133          0         0            0            0            0            0           0           0  
    iter=116       0.02025          0         0            0            0            0            0           0           0  
    iter=117      0.019226          0         0            0            0            0            0           0           0  
    iter=118      0.018254          0         0            0            0            0            0           0           0  
    iter=119      0.017331          0         0            0            0            0            0           0           0  
    iter=120      0.016456          0         0            0            0            0            0           0           0  
    iter=121      0.015625          0         0            0            0            0            0           0           0  
    iter=122      0.014836          0         0            0            0            0            0           0           0  
    iter=123      0.014087          0         0            0            0            0            0           0           0  
    iter=124      0.013377          0         0            0            0            0            0           0           0  
    iter=125      0.012703          0         0            0            0            0            0           0           0  
    iter=126      0.012062          0         0            0            0            0            0           0           0  
    iter=127      0.011455          0         0            0            0            0            0           0           0  
    iter=128      0.010878          0         0            0            0            0            0           0           0  
    iter=129       0.01033          0         0            0            0            0            0           0           0  
    iter=130     0.0098101          0         0            0            0            0            0           0           0  
    iter=131     0.0093164          0         0            0            0            0            0           0           0  
    iter=132     0.0088478          0         0            0            0            0            0           0           0  
    iter=133     0.0084028          0         0            0            0            0            0           0           0  
    iter=134     0.0079803          0         0            0            0            0            0           0           0  
    iter=135     0.0075792          0         0            0            0            0            0           0           0  
    iter=136     0.0071983          0         0            0            0            0            0           0           0  
    iter=137     0.0068366          0         0            0            0            0            0           0           0  
    iter=138     0.0064932          0         0            0            0            0            0           0           0  
    iter=139      0.006167          0         0            0            0            0            0           0           0  
    iter=140     0.0058574          0         0            0            0            0            0           0           0  
    iter=141     0.0055633          0         0            0            0            0            0           0           0  
    iter=142      0.005284          0         0            0            0            0            0           0           0  
    iter=143     0.0050189          0         0            0            0            0            0           0           0  
    iter=144      0.004767          0         0            0            0            0            0           0           0  
    iter=145     0.0045278          0         0            0            0            0            0           0           0  
    iter=146     0.0043007          0         0            0            0            0            0           0           0  
    iter=147      0.004085          0         0            0            0            0            0           0           0  
    iter=148     0.0038801          0         0            0            0            0            0           0           0  
    iter=149     0.0036856          0         0            0            0            0            0           0           0  
    iter=150     0.0035008          0         0            0            0            0            0           0           0  
    iter=151     0.0033253          0         0            0            0            0            0           0           0  
    iter=152     0.0031586          0         0            0            0            0            0           0           0  
    iter=153     0.0030003          0         0            0            0            0            0           0           0  
    iter=154       0.00285          0         0            0            0            0            0           0           0  
    iter=155     0.0027072          0         0            0            0            0            0           0           0  
    iter=156     0.0025715          0         0            0            0            0            0           0           0  
    iter=157     0.0024427          0         0            0            0            0            0           0           0  
    iter=158     0.0023203          0         0            0            0            0            0           0           0  
    iter=159     0.0022041          0         0            0            0            0            0           0           0  
    iter=160     0.0020937          0         0            0            0            0            0           0           0  
    iter=161     0.0019888          0         0            0            0            0            0           0           0  
    iter=162     0.0018892          0         0            0            0            0            0           0           0  
    iter=163     0.0017946          0         0            0            0            0            0           0           0  
    iter=164     0.0017048          0         0            0            0            0            0           0           0  
    iter=165     0.0016194          0         0            0            0            0            0           0           0  
    iter=166     0.0015383          0         0            0            0            0            0           0           0  
    iter=167     0.0014613          0         0            0            0            0            0           0           0  
    iter=168     0.0013882          0         0            0            0            0            0           0           0  
    iter=169     0.0013187          0         0            0            0            0            0           0           0  
    iter=170     0.0012527          0         0            0            0            0            0           0           0  
    iter=171       0.00119          0         0            0            0            0            0           0           0  
    iter=172     0.0011304          0         0            0            0            0            0           0           0  
    iter=173     0.0010738          0         0            0            0            0            0           0           0  
    iter=174     0.0010201          0         0            0            0            0            0           0           0  
    iter=175    0.00096905          0         0            0            0            0            0           0           0  
    iter=176    0.00092056          0         0            0            0            0            0           0           0  
    iter=177    0.00087449          0         0            0            0            0            0           0           0  
    iter=178    0.00083073          0         0            0            0            0            0           0           0  
    iter=179    0.00078917          0         0            0            0            0            0           0           0  
    iter=180    0.00074968          0         0            0            0            0            0           0           0  
    iter=181    0.00071217          0         0            0            0            0            0           0           0  
    iter=182    0.00067654          0         0            0            0            0            0           0           0  
    iter=183    0.00064269          0         0            0            0            0            0           0           0  
    iter=184    0.00061054          0         0            0            0            0            0           0           0  
    iter=185       0.00058          0         0            0            0            0            0           0           0  
    iter=186    0.00055098          0         0            0            0            0            0           0           0  
    iter=187    0.00052342          0         0            0            0            0            0           0           0  
    iter=188    0.00049723          0         0            0            0            0            0           0           0  
    iter=189    0.00047236          0         0            0            0            0            0           0           0  
    iter=190    0.00044873          0         0            0            0            0            0           0           0  
    iter=191    0.00042629          0         0            0            0            0            0           0           0  
    iter=192    0.00040496          0         0            0            0            0            0           0           0  
    iter=193    0.00038471          0         0            0            0            0            0           0           0  
    iter=194    0.00036547          0         0            0            0            0            0           0           0  
    iter=195    0.00034719          0         0            0            0            0            0           0           0  
    iter=196    0.00032982          0         0            0            0            0            0           0           0  
    iter=197    0.00031332          0         0            0            0            0            0           0           0  
    iter=198    0.00029765          0         0            0            0            0            0           0           0  
    iter=199    0.00028277          0         0            0            0            0            0           0           0  
    iter=200    0.00026862          0         0            0            0            0            0           0           0  
    iter=201    0.00025519          0         0            0            0            0            0           0           0  
    iter=202    0.00024243          0         0            0            0            0            0           0           0  
    iter=203     0.0002303          0         0            0            0            0            0           0           0  
    iter=204    0.00021878          0         0            0            0            0            0           0           0  
    iter=205    0.00020784          0         0            0            0            0            0           0           0  
    iter=206    0.00019745          0         0            0            0            0            0           0           0  
    iter=207    0.00018757          0         0            0            0            0            0           0           0  
    iter=208    0.00017819          0         0            0            0            0            0           0           0  
    iter=209    0.00016928          0         0            0            0            0            0           0           0  
    iter=210    0.00016082          0         0            0            0            0            0           0           0  
    iter=211    0.00015277          0         0            0            0            0            0           0           0  
    iter=212    0.00014513          0         0            0            0            0            0           0           0  
    iter=213    0.00013788          0         0            0            0            0            0           0           0  
    iter=214    0.00013098          0         0            0            0            0            0           0           0  
    iter=215    0.00012443          0         0            0            0            0            0           0           0  
    iter=216    0.00011821          0         0            0            0            0            0           0           0  
    iter=217     0.0001123          0         0            0            0            0            0           0           0  
    iter=218    0.00010668          0         0            0            0            0            0           0           0  
    iter=219    0.00010135          0         0            0            0            0            0           0           0  
    iter=220     9.628e-05          0         0            0            0            0            0           0           0  
    iter=221    9.1465e-05          0         0            0            0            0            0           0           0  
    iter=222    8.6892e-05          0         0            0            0            0            0           0           0  
    iter=223    8.2547e-05          0         0            0            0            0            0           0           0  
    iter=224    7.8419e-05          0         0            0            0            0            0           0           0  
    iter=225    7.4498e-05          0         0            0            0            0            0           0           0  
    iter=226    7.0773e-05          0         0            0            0            0            0           0           0  
    iter=227    6.7234e-05          0         0            0            0            0            0           0           0  
    iter=228    6.3872e-05          0         0            0            0            0            0           0           0  
    iter=229    6.0678e-05          0         0            0            0            0            0           0           0  
    iter=230    5.7644e-05          0         0            0            0            0            0           0           0  
    iter=231    5.4761e-05          0         0            0            0            0            0           0           0  
    iter=232    5.2023e-05          0         0            0            0            0            0           0           0  
    iter=233    4.9422e-05          0         0            0            0            0            0           0           0  
    iter=234    4.6951e-05          0         0            0            0            0            0           0           0  
    iter=235    4.4603e-05          0         0            0            0            0            0           0           0  
    iter=236    4.2373e-05          0         0            0            0            0            0           0           0  
    iter=237    4.0254e-05          0         0            0            0            0            0           0           0  
    iter=238    3.8241e-05          0         0            0            0            0            0           0           0  
    iter=239    3.6329e-05          0         0            0            0            0            0           0           0  
    iter=240    3.4512e-05          0         0            0            0            0            0           0           0  
    iter=241    3.2787e-05          0         0            0            0            0            0           0           0  
    iter=242    3.1147e-05          0         0            0            0            0            0           0           0  
    iter=243     2.959e-05          0         0            0            0            0            0           0           0  
    iter=244     2.811e-05          0         0            0            0            0            0           0           0  
    iter=245    2.6705e-05          0         0            0            0            0            0           0           0  
    iter=246     2.537e-05          0         0            0            0            0            0           0           0  
    iter=247    2.4101e-05          0         0            0            0            0            0           0           0  
    iter=248    2.2896e-05          0         0            0            0            0            0           0           0  
    iter=249    2.1751e-05          0         0            0            0            0            0           0           0  
    iter=250    2.0664e-05          0         0            0            0            0            0           0           0  
    iter=251     1.963e-05          0         0            0            0            0            0           0           0  
    iter=252    1.8649e-05          0         0            0            0            0            0           0           0  
    iter=253    1.7716e-05          0         0            0            0            0            0           0           0  
    iter=254     1.683e-05          0         0            0            0            0            0           0           0  
    iter=255    1.5989e-05          0         0            0            0            0            0           0           0  
    iter=256    1.5189e-05          0         0            0            0            0            0           0           0  
    iter=257     1.443e-05          0         0            0            0            0            0           0           0  
    iter=258    1.3708e-05          0         0            0            0            0            0           0           0  
    iter=259    1.3023e-05          0         0            0            0            0            0           0           0  
    iter=260    1.2372e-05          0         0            0            0            0            0           0           0  
    iter=261    1.1753e-05          0         0            0            0            0            0           0           0  
    iter=262    1.1166e-05          0         0            0            0            0            0           0           0  
    iter=263    1.0607e-05          0         0            0            0            0            0           0           0  
    iter=264    1.0077e-05          0         0            0            0            0            0           0           0  
    iter=265    9.5731e-06          0         0            0            0            0            0           0           0  
    iter=266    9.0944e-06          0         0            0            0            0            0           0           0  

</pre><h2 id="15">ls_ffcmd summary</h2><pre class="codeinput"><span class="keyword">if</span> (~isempty(ls_ffcmd))
    mp_ffcmd = containers.Map(ls_ffcmd, values(mp_print_graph, ls_ffcmd));
    ff_container_map_display(mp_ffcmd, ffsna_opt_it_row_n_keep, ffsna_opt_it_col_n_keep);
<span class="keyword">end</span>
</pre><pre class="codeoutput">----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_ffcmd ND Array (Matrix etc)
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                   i    idx    ndim    numel    rowN    colN     sum       mean        std      coefvari      min        max  
                   _    ___    ____    _____    ____    ____    ______    _______    _______    ________    _______    _______

    ap             1     1      2       700     100      7       10066      14.38     14.517     1.0095           0         50
    c              2     2      2       700     100      7      1545.9     2.2085    0.93535    0.42353     0.48142     5.5572
    coh            3     3      2       700     100      7       11612     16.589     15.398    0.92824     0.48142     55.557
    savefraccoh    4     4      2       700     100      7      484.81    0.69259    0.26557    0.38344           0    0.92891
    v              5     5      2       700     100      7      7249.6     10.357     4.6996    0.45378     0.63449     19.279
    y              6     6      2       700     100      7      1536.2     2.1946     1.1875    0.54109     0.48142     5.5572

xxx TABLE:ap xxxxxxxxxxxxxxxxxx
              c1        c2        c3         c4         c5         c6         c7  
            ______    ______    ______    ________    _______    _______    ______

    r1           0         0         0    0.092813    0.37601    0.91719    1.7673
    r2           0         0         0    0.092813    0.37601    0.91719    1.7673
    r3           0         0         0    0.092813    0.37601    0.91719    1.7673
    r4           0         0         0    0.092813    0.37601    0.91719    1.7673
    r5           0         0         0     0.12459     0.4468    0.91719    1.7673
    r96     43.924    43.924    43.924      43.924     45.102     45.102    46.298
    r97     45.102    45.102    45.102      45.102     46.298     46.298    47.513
    r98     46.298    46.298    46.298      46.298     47.513     47.513    48.747
    r99     47.513    47.513    47.513      47.513     48.747     48.747        50
    r100    48.747    48.747    48.747      48.747         50         50        50

xxx TABLE:c xxxxxxxxxxxxxxxxxx
              c1         c2         c3         c4        c5        c6        c7  
            _______    _______    _______    ______    ______    ______    ______

    r1      0.48142    0.67187    0.93768    1.2158    1.4503    1.6317    1.7899
    r2      0.48195    0.67241    0.93821    1.2164    1.4509    1.6322    1.7904
    r3      0.48444    0.67489    0.94069    1.2188    1.4533    1.6347    1.7929
    r4      0.48973    0.68019    0.94599    1.2241    1.4586      1.64    1.7982
    r5      0.49848    0.68894    0.95474    1.2011    1.3966    1.6487     1.807
    r96       3.463     3.6535     3.9193    4.2902    3.6304    4.3529     4.165
    r97      3.5296     3.7201     3.9859    4.3568    3.6783    4.4008     4.194
    r98       3.597     3.7875     4.0533    4.4243    3.7269    4.4494    4.2237
    r99      3.6653     3.8558     4.1216    4.4926    3.7762    4.4987     4.254
    r100     3.7345      3.925     4.1908    4.5617    3.8263    4.5489    5.5572

xxx TABLE:coh xxxxxxxxxxxxxxxxxx
              c1         c2         c3         c4        c5        c6        c7  
            _______    _______    _______    ______    ______    ______    ______

    r1      0.48142    0.67187    0.93768    1.3086    1.8263    2.5489    3.5572
    r2      0.48195    0.67241    0.93821    1.3092    1.8269    2.5494    3.5578
    r3      0.48444    0.67489    0.94069    1.3116    1.8294    2.5519    3.5602
    r4      0.48973    0.68019    0.94599    1.3169    1.8347    2.5572    3.5655
    r5      0.49848    0.68894    0.95474    1.3257    1.8434    2.5659    3.5743
    r96      47.387     47.577     47.843    48.214    48.732    49.454    50.463
    r97      48.631     48.822     49.087    49.458    49.976    50.699    51.707
    r98      49.895     50.085     50.351    50.722     51.24    51.962    52.971
    r99      51.178     51.369     51.634    52.005    52.523    53.246    54.254
    r100     52.481     52.672     52.938    53.309    53.826    54.549    55.557

xxx TABLE:savefraccoh xxxxxxxxxxxxxxxxxx
              c1         c2         c3          c4         c5         c6         c7   
            _______    _______    _______    ________    _______    _______    _______

    r1            0          0          0    0.070923    0.20588    0.35984    0.49682
    r2            0          0          0    0.070894    0.20582    0.35977    0.49675
    r3            0          0          0     0.07076    0.20554    0.35941     0.4964
    r4            0          0          0    0.070476    0.20495    0.35867    0.49567
    r5            0          0          0    0.093982    0.24238    0.35745    0.49445
    r96     0.92692    0.92321    0.91808     0.91102     0.9255    0.91198    0.91746
    r97     0.92742     0.9238     0.9188     0.91191     0.9264     0.9132    0.91889
    r98     0.92791    0.92438     0.9195     0.91277    0.92727    0.91437    0.92026
    r99     0.92838    0.92494    0.92018     0.91361     0.9281    0.91551    0.92159
    r100    0.92884    0.92548    0.92084     0.91443    0.92891    0.91661    0.89997

xxx TABLE:v xxxxxxxxxxxxxxxxxx
              c1         c2        c3        c4        c5        c6        c7  
            _______    ______    ______    ______    ______    ______    ______

    r1      0.63449    2.1602    3.6193    4.9814    6.3049    7.6393    8.9693
    r2      0.63608    2.1611    3.6198    4.9818    6.3052    7.6396    8.9696
    r3      0.64348    2.1656    3.6226    4.9836    6.3066    7.6408    8.9706
    r4      0.65905    2.1751    3.6283    4.9875    6.3096    7.6433    8.9728
    r5      0.68425    2.1906    3.6378    4.9942    6.3149    7.6474    8.9764
    r96      17.141    17.307    17.507     17.74     18.03    18.365    18.742
    r97      17.322    17.484    17.679    17.907     18.19    18.518    18.885
    r98      17.501     17.66     17.85    18.072    18.349    18.669    19.025
    r99      17.679    17.833    18.019    18.236    18.506    18.819    19.158
    r100     17.855    18.006    18.187    18.399    18.662    18.966    19.279

xxx TABLE:y xxxxxxxxxxxxxxxxxx
              c1         c2         c3         c4        c5        c6        c7  
            _______    _______    _______    ______    ______    ______    ______

    r1      0.48142    0.67187    0.93768    1.3086    1.8263    2.5489    3.5572
    r2      0.48144    0.67189     0.9377    1.3087    1.8264    2.5489    3.5573
    r3      0.48153    0.67199    0.93779    1.3087    1.8265     2.549    3.5573
    r4      0.48174    0.67219      0.938     1.309    1.8267    2.5492    3.5576
    r5      0.48208    0.67253    0.93833    1.3093     1.827    2.5495    3.5579
    r96      2.2855     2.4759     2.7417    3.1127    3.6304    4.3529    5.3613
    r97      2.3333     2.5238     2.7896    3.1605    3.6783    4.4008    5.4091
    r98      2.3819     2.5724     2.8382    3.2091    3.7269    4.4494    5.4577
    r99      2.4313     2.6218     2.8876    3.2585    3.7762    4.4987    5.5071
    r100     2.4814     2.6719     2.9377    3.3086    3.8263    4.5489    5.5572

</pre><h2 id="16">ls_ffsna summarize full</h2><pre class="codeinput"><span class="keyword">if</span> (~isempty(ls_ffsna))

    <span class="comment">% container map subseting</span>
    mp_ffsna = containers.Map(ls_ffsna, values(mp_print_graph, ls_ffsna));

    <span class="comment">% ff_summ_nd_array parameters</span>
    it_aggd = 0;
    bl_row = 1;
    ar_permute = [2,1];
    ar_st_stats = [<span class="string">"mean"</span>];
    bl_print_table = true;
    cl_mp_datasetdesc = {};
    cl_mp_datasetdesc{1} = containers.Map({<span class="string">'name'</span>, <span class="string">'labval'</span>}, {<span class="string">'a'</span>, ar_a});
    cl_mp_datasetdesc{2} = containers.Map({<span class="string">'name'</span>, <span class="string">'labval'</span>}, {<span class="string">'z'</span>, ar_z});

    <span class="comment">% summarize</span>
    param_map_keys = keys(mp_ffsna);
    param_map_vals = values(mp_ffsna);
    <span class="keyword">for</span> i = 1:length(mp_ffsna)
        st_mt_name = param_map_keys{i};
        mt_cur = param_map_vals{i};
        st_title = [<span class="string">'ff_vfi_az_vec, outcome='</span> st_mt_name];
        ff_summ_nd_array(st_title, mt_cur, <span class="keyword">...</span>
            bl_print_table, ar_st_stats, it_aggd, bl_row, <span class="keyword">...</span>
            cl_mp_datasetdesc, ar_permute);
    <span class="keyword">end</span>

<span class="keyword">end</span>
</pre><pre class="codeoutput">xxx  ff_vfi_az_vec, outcome=ap  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group        a         mean_z_0_34387    mean_z_0_47991    mean_z_0_66977    mean_z_0_93474    mean_z_1_3045    mean_z_1_8206    mean_z_2_5409
    _____    __________    ______________    ______________    ______________    ______________    _____________    _____________    _____________

       1              0              0                 0                 0          0.092813          0.37601          0.91719          1.7673    
       2     0.00051272              0                 0                 0          0.092813          0.37601          0.91719          1.7673    
       3      0.0029004              0                 0                 0          0.092813          0.37601          0.91719          1.7673    
       4      0.0079925              0                 0                 0          0.092813          0.37601          0.91719          1.7673    
       5       0.016407              0                 0                 0           0.12459           0.4468          0.91719          1.7673    
       6       0.028662              0                 0         0.0029004           0.12459           0.4468          0.91719          1.7673    
       7       0.045213              0                 0          0.016407           0.12459           0.4468          0.91719          1.7673    
       8        0.06647              0                 0          0.028662           0.16214           0.4468          0.91719          1.7673    
       9       0.092813              0         0.0079925          0.045213           0.16214           0.4468           1.0362          1.7673    
      10        0.12459       0.016407          0.028662           0.06647           0.20576          0.52503           1.0362          1.7673    
      11        0.16214       0.028662          0.045213          0.092813           0.25576          0.52503           1.0362          1.9422    
      12        0.20576       0.045213           0.06647           0.12459           0.25576          0.61095            1.164          1.9422    
      13        0.25576       0.092813          0.092813           0.16214           0.31242          0.61095            1.164          1.9422    
      14        0.31242        0.12459           0.12459           0.20576           0.37601           0.7048            1.164          1.9422    
      15        0.37601        0.16214           0.20576           0.25576            0.4468           0.7048           1.3008           2.127    
      16         0.4468        0.20576           0.25576           0.31242           0.52503           0.8068           1.3008           2.127    
      17        0.52503        0.25576           0.31242           0.37601           0.52503          0.91719           1.4468          2.3221    
      18        0.61095        0.31242           0.37601            0.4468           0.61095          0.91719           1.4468          2.3221    
      19         0.7048        0.37601            0.4468           0.52503            0.7048           1.0362           1.6023          2.3221    
      20         0.8068         0.4468           0.52503           0.61095            0.8068            1.164           1.6023          2.5275    
      21        0.91719        0.52503           0.61095            0.7048           0.91719           1.3008           1.7673          2.5275    
      22         1.0362         0.7048            0.7048            0.8068            1.0362           1.3008           1.9422          2.7434    
      23          1.164         0.8068            0.8068           0.91719             1.164           1.4468            2.127            2.97    
      24         1.3008        0.91719           0.91719            1.0362            1.3008           1.6023            2.127            2.97    
      25         1.4468         1.0362            1.0362             1.164            1.4468           1.7673           2.3221          3.2075    
      26         1.6023          1.164             1.164            1.3008            1.6023           1.9422           2.5275          3.2075    
      27         1.7673         1.3008            1.3008            1.4468            1.7673            2.127           2.5275           3.456    
      28         1.9422         1.4468            1.4468            1.6023            1.9422           2.3221           2.7434          3.7158    
      29          2.127         1.6023            1.6023            1.7673             2.127           2.3221             2.97          3.7158    
      30         2.3221         1.7673            1.9422            1.9422            2.3221           2.5275           3.2075          3.9869    
      31         2.5275         1.9422             2.127             2.127            2.5275           2.7434            3.456          4.2696    
      32         2.7434          2.127            2.3221            2.3221            2.5275             2.97            3.456          4.2696    
      33           2.97         2.3221            2.5275            2.5275            2.7434           3.2075           3.7158           4.564    
      34         3.2075         2.5275            2.7434            2.7434              2.97            3.456           3.9869          4.8702    
      35          3.456         2.7434              2.97              2.97            3.2075           3.7158           4.2696          5.1884    
      36         3.7158           2.97            3.2075            3.2075             3.456           3.9869            4.564          5.5188    
      37         3.9869         3.2075             3.456             3.456            3.7158           4.2696           4.8702          5.5188    
      38         4.2696          3.456            3.7158            3.7158            3.9869            4.564           5.1884          5.8615    
      39          4.564         3.9869            3.9869            3.9869            4.2696           4.8702           5.1884          6.2166    
      40         4.8702         4.2696            4.2696             4.564             4.564           5.1884           5.5188          6.5844    
      41         5.1884          4.564             4.564            4.8702            4.8702           5.5188           5.8615          6.9649    
      42         5.5188         4.8702            4.8702            5.1884            5.1884           5.8615           6.2166          6.9649    
      43         5.8615         5.1884            5.1884            5.5188            5.5188           6.2166           6.5844          7.3583    
      44         6.2166         5.5188            5.5188            5.8615            5.8615           6.2166           6.9649          7.7647    
      45         6.5844         5.8615            5.8615            6.2166            6.2166           6.5844           7.3583          8.1844    
      46         6.9649         6.2166            6.2166            6.5844            6.5844           6.9649           7.7647          8.6173    
      47         7.3583         6.5844            6.5844            6.9649            6.9649           7.3583           8.1844          9.0637    
      48         7.7647         6.9649            6.9649            7.3583            7.3583           7.7647           8.6173          9.5237    
      49         8.1844         7.3583            7.3583            7.7647            7.7647           8.1844           9.0637          9.9975    
      50         8.6173         7.7647            7.7647            8.1844            8.1844           8.6173           9.5237          9.9975    
      51         9.0637         8.1844            8.1844            8.6173            8.6173           9.0637           9.9975          10.485    
      52         9.5237         8.6173            8.6173            9.0637            9.0637           9.5237           9.9975          10.987    
      53         9.9975         9.0637            9.0637            9.5237            9.5237           9.9975           10.485          11.502    
      54         10.485         9.5237            9.5237            9.9975            9.9975           10.485           10.987          12.032    
      55         10.987         9.9975            9.9975            10.485            10.485           10.987           11.502          12.577    
      56         11.502         10.485            10.485            10.987            10.987           11.502           12.032          13.136    
      57         12.032         10.987            10.987            11.502            11.502           12.032           12.577          13.709    
      58         12.577         11.502            11.502            12.032            12.032           12.577           13.136          14.298    
      59         13.136         12.032            12.032            12.577            12.577           13.136           13.709          14.901    
      60         13.709         12.577            13.136            13.136            13.136           13.709           14.298          14.901    
      61         14.298         13.136            13.709            13.709            13.709           14.298           14.901          15.519    
      62         14.901         13.709            14.298            14.298            14.298           14.901           15.519          16.152    
      63         15.519         14.298            14.901            14.901            14.901           15.519           16.152          16.801    
      64         16.152         14.901            15.519            15.519            15.519           16.152           16.801          17.465    
      65         16.801         15.519            16.152            16.152            16.152           16.801           17.465          18.144    
      66         17.465         16.152            16.801            16.801            16.801           17.465           18.144          18.839    
      67         18.144         16.801            17.465            17.465            17.465           18.144           18.839           19.55    
      68         18.839         17.465            18.144            18.144            18.144           18.839            19.55          20.277    
      69          19.55         18.839            18.839            18.839            18.839            19.55           20.277           21.02    
      70         20.277          19.55             19.55             19.55             19.55           20.277            21.02          21.778    
      71          21.02         20.277            20.277            20.277            20.277            21.02           21.778          22.553    
      72         21.778          21.02             21.02             21.02             21.02           21.778           22.553          23.345    
      73         22.553         21.778            21.778            21.778            21.778           22.553           23.345          24.152    
      74         23.345         22.553            22.553            22.553            22.553           23.345           24.152          24.977    
      75         24.152         23.345            23.345            23.345            23.345           24.152           24.977          25.818    
      76         24.977         24.152            24.152            24.152            24.152           24.977           25.818          26.675    
      77         25.818         24.977            24.977            24.977            24.977           25.818           26.675           27.55    
      78         26.675         25.818            25.818            25.818            25.818           26.675            27.55          28.441    
      79          27.55         26.675            26.675            26.675            26.675            27.55           28.441           29.35    
      80         28.441          27.55             27.55             27.55             27.55           28.441            29.35           29.35    
      81          29.35         28.441            28.441            28.441            28.441            29.35           30.276          30.276    
      82         30.276          29.35             29.35             29.35             29.35           30.276           30.276          31.219    
      83         31.219         30.276            30.276            30.276            30.276           31.219           31.219          32.179    
      84         32.179         31.219            31.219            31.219            31.219           32.179           32.179          33.157    
      85         33.157         32.179            32.179            32.179            32.179           33.157           33.157          34.153    
      86         34.153         33.157            33.157            33.157            33.157           34.153           34.153          35.166    
      87         35.166         34.153            34.153            34.153            34.153           35.166           35.166          36.198    
      88         36.198         35.166            35.166            35.166            35.166           36.198           36.198          37.247    
      89         37.247         36.198            36.198            36.198            36.198           37.247           37.247          38.314    
      90         38.314         37.247            37.247            37.247            37.247           38.314           38.314          39.399    
      91         39.399         38.314            38.314            38.314            38.314           39.399           39.399          40.503    
      92         40.503         39.399            39.399            39.399            39.399           40.503           40.503          41.625    
      93         41.625         40.503            40.503            40.503            40.503           41.625           41.625          42.765    
      94         42.765         41.625            41.625            41.625            41.625           42.765           42.765          43.924    
      95         43.924         42.765            42.765            42.765            42.765           43.924           43.924          45.102    
      96         45.102         43.924            43.924            43.924            43.924           45.102           45.102          46.298    
      97         46.298         45.102            45.102            45.102            45.102           46.298           46.298          47.513    
      98         47.513         46.298            46.298            46.298            46.298           47.513           47.513          48.747    
      99         48.747         47.513            47.513            47.513            47.513           48.747           48.747              50    
     100             50         48.747            48.747            48.747            48.747               50               50              50    

</pre><h2 id="17">ls_ffgrh graph</h2><pre class="codeinput"><span class="keyword">if</span> (~isempty(ls_ffgrh))

    <span class="comment">% container map subseting</span>
    mp_ffgrh = containers.Map(ls_ffgrh, values(mp_print_graph, ls_ffgrh));

    <span class="comment">% container map settings</span>
    mp_support_graph = containers.Map(<span class="string">'KeyType'</span>, <span class="string">'char'</span>, <span class="string">'ValueType'</span>, <span class="string">'any'</span>);
    mp_support_graph(<span class="string">'cl_st_xtitle'</span>) = {<span class="string">'savings states, a'</span>};
    mp_support_graph(<span class="string">'st_legend_loc'</span>) = <span class="string">'best'</span>;
    mp_support_graph(<span class="string">'bl_graph_logy'</span>) = true; <span class="comment">% do not log</span>
    mp_support_graph(<span class="string">'st_rowvar_name'</span>) = <span class="string">'shock='</span>;
    mp_support_graph(<span class="string">'it_legend_select'</span>) = 5; <span class="comment">% how many shock legends to show</span>
    mp_support_graph(<span class="string">'st_rounding'</span>) = <span class="string">'6.2f'</span>; <span class="comment">% format shock legend</span>
    mp_support_graph(<span class="string">'cl_colors'</span>) = <span class="string">'jet'</span>; <span class="comment">% any predefined matlab colormap</span>

    <span class="comment">% Overide graph options here with external parameters</span>
    <span class="keyword">if</span> (length(varargin)&gt;=3)
        mp_support_graph = [mp_support_graph; mp_support_graph_ext];
    <span class="keyword">end</span>

    <span class="comment">% summarize</span>
    param_map_keys = keys(mp_ffgrh);
    param_map_vals = values(mp_ffgrh);
    <span class="keyword">for</span> i = 1:length(mp_ffgrh)
        <span class="comment">% Get matrix and key</span>
        st_mt_name = param_map_keys{i};
        mt_cur = param_map_vals{i};

        <span class="comment">% Update Title and Y label</span>
        mp_support_graph(<span class="string">'cl_st_graph_title'</span>) = {[st_mt_name <span class="string">'(a,z), savings state =x, shock state = color'</span>]};
        mp_support_graph(<span class="string">'cl_st_ytitle'</span>) = {[st_mt_name <span class="string">'(a,z)'</span>]};

        <span class="comment">% Call function</span>
        ff_graph_grid(mt_cur', ar_z, ar_a, mp_support_graph);
    <span class="keyword">end</span>

<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="ff_vfi_az_loop_01.png" alt=""> <img vspace="5" hspace="5" src="ff_vfi_az_loop_02.png" alt=""> <img vspace="5" hspace="5" src="ff_vfi_az_loop_03.png" alt=""> <img vspace="5" hspace="5" src="ff_vfi_az_loop_04.png" alt=""> <img vspace="5" hspace="5" src="ff_vfi_az_loop_05.png" alt=""> <img vspace="5" hspace="5" src="ff_vfi_az_loop_06.png" alt=""> <img vspace="5" hspace="5" src="ff_vfi_az_loop_07.png" alt=""> <img vspace="5" hspace="5" src="ff_vfi_az_loop_08.png" alt=""> <img vspace="5" hspace="5" src="ff_vfi_az_loop_09.png" alt=""> <img vspace="5" hspace="5" src="ff_vfi_az_loop_10.png" alt=""> <h2 id="18">Store Results for Output</h2><pre class="codeinput">mp_valpol_out = containers.Map(ls_slout, values(mp_print_graph, ls_slout));
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% FF_VFI_AZ_LOOP (looped grid choice) Dynamic Savings Problem
%    Slow looped solution for solving the dynamic programming problem with
%    fixed assets grid using value function iteration. Obtains policy and
%    value functions. Shock is AR(1). This function is looped, and
%    extremely slow when state-space increases in size. This function is
%    useful as a working template for developing models that rely on asset
%    and shocks.
%
%    * MP_PARAMS controls model preference, prices, shock and asset grid
%    parameters.
%    * MP_SUPPORT controls convergence criterion, printing and summary
%    controls
%
%    mp_params = containers.Map('KeyType','char', 'ValueType','any');
%    mp_params('fl_crra') = 1.5;
%    mp_params('fl_beta') = 0.95;
%    mp_params('fl_w') = 1.05;
%    mp_params('fl_r') = 0.03;
%    mp_params('fl_a_min') = 0;
%    mp_params('fl_a_max') = 50;
%    mp_params('it_a_n') = 25;
%    mp_params('st_grid_type') = 'grid_powerspace';
%    mp_params('fl_z_persist') = 0.60;
%    mp_params('fl_shk_std') = 0.10;
%    mp_params('it_z_n') = 5;
%    mp_params('st_grid_type') = 'grid_powerspace';
%
%    mp_support = containers.Map('KeyType','char', 'ValueType','any');
%    mp_support('fl_lowestc') = -10e10;
%    mp_support('it_maxiter_val') = 500;
%    mp_support('fl_tol_val') = 10e-5;
%    % printer various information
%    mp_support('bl_timer') = true;
%    mp_support('bl_print_params') = false;
%    mp_support('bl_print_iterinfo') = false;
%    % These names must match keys of mp_solu: v=value, ap=savings choice,
%    c=consumption, y=income, coh=cash-on-hand (income + savings),
%    savefraccoh = ap/coh.
%    % what outcomes to store in the mp_solu for export
%    mp_support('ls_slout') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
%    % outcome for ff_container_map_display
%    mp_support('ls_ffcmd') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
%    % outcome for ff_summ_nd_array
%    mp_support('ls_ffsna') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
%    % outcome for ff_graph_grid
%    mp_support('ls_ffgrh') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
%    % outcome for ff_summ_nd_array
%    mp_support('ffsna_opt_it_row_n_keep') = 10;
%    % outcome for ff_summ_nd_array
%    mp_support('ffsna_opt_it_col_n_keep') = 9;
%
%    [MP_VALPOL_OUT, FLAG] = FF_VFI_AZ_LOOP() default savings and shock
%    model solution.
%
%    [MP_VALPOL_OUT, FLAG] = FF_VFI_AZ_LOOP(MP_PARAMS) change model
%    parameters through MP_PARAMS
%
%    [MP_VALPOL_OUT, FLAG] = FF_VFI_AZ_LOOP(MP_PARAMS, MP_SUPPORT) change
%    various printing, storaging, graphing, convergence etc controls
%    through MP_SUPPORT
%
%    [MP_VALPOL_OUT, FLAG] = FF_VFI_AZ_LOOP(MP_PARAMS, MP_SUPPORT,
%    MP_SUPPORT_GRAPH) also changing graphing options, see the
%    FF_GRAPH_GRID function for what key value paris can be specified.
%
%    see also FX_VFI_AZ_LOOP, FF_VFI_AZ_VEC, FF_VFI_AZ_BISEC_LOOP,
%    FF_VFI_AZ_BISEC_VEC, FF_VFI_AZ_MZOOM_LOOP, FF_VFI_AZ_MZOOM_VEC,
%    FF_GRAPH_GRID
%

%%
function [mp_valpol_out, flag] = ff_vfi_az_loop(varargin)

%% Set Default and Parse Inputs
if (~isempty(varargin))
    
    if (length(varargin) == 1)
        [mp_params_ext] = varargin{:};
    elseif (length(varargin) == 2)
        [mp_params_ext, mp_support_ext] = varargin{:};
    elseif (length(varargin) == 3)
        [mp_params_ext, mp_support_ext, mp_support_graph_ext] = varargin{:};
    end
    
else
    close all;
    mp_support_ext = containers.Map('KeyType','char', 'ValueType','any');
    mp_support_ext('bl_timer') = true;
    mp_support_ext('bl_print_params') = true;
    mp_support_ext('bl_print_iterinfo') = true;
    mp_support_ext('ls_ffcmd') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
    mp_support_ext('ls_ffsna') = {'ap'};
    mp_support_ext('ls_ffgrh') = {'v', 'ap', 'c', 'y', 'savefraccoh'};
    mp_support_ext('ls_store') = {'v', 'ap', 'c', 'y', 'coh'};
    mp_support_ext('ffsna_opt_it_row_n_keep') = 10;
    mp_support_ext('ffsna_opt_it_col_n_keep') = 9;
    
end

%% Default Model Parameters
% support_map
mp_params = containers.Map('KeyType','char', 'ValueType','any');
mp_params('fl_crra') = 1.5;
mp_params('fl_beta') = 0.95;

mp_params('fl_w') = 1.40;
mp_params('fl_r') = 0.04;

mp_params('fl_a_min') = 0;
mp_params('fl_a_max') = 50;
mp_params('it_a_n') = 100;
mp_params('st_grid_type') = 'grid_powerspace';

mp_params('fl_z_persist') = 0.80;
mp_params('fl_shk_std') = 0.20;
mp_params('it_z_n') = 7;

% override default support_map values
if (length(varargin)>=1)
    mp_params = [mp_params; mp_params_ext];
end

%% Parse mp_params
params_group = values(mp_params, {'fl_crra', 'fl_beta'});
[fl_crra, fl_beta] = params_group{:};
params_group = values(mp_params, {'fl_w', 'fl_r'});
[fl_w, fl_r] = params_group{:};
params_group = values(mp_params, {'fl_a_min', 'fl_a_max', 'it_a_n', 'st_grid_type'});
[fl_a_min, fl_a_max, it_a_n, st_grid_type] = params_group{:};
params_group = values(mp_params, {'fl_z_persist', 'fl_shk_std', 'it_z_n'});
[fl_z_persist, fl_shk_std, it_z_n] = params_group{:};

%% Generate A and Z Grids
% Same min and max and grid points
[ar_a] = ff_saveborr_grid(fl_a_min, fl_a_max, it_a_n, st_grid_type);
ar_a = ar_a';

% shock vector and transition, normalize mean exp(shk) to 1
% [ar_z, mt_z_trans] = ffy_rouwenhorst(fl_z_persist, fl_shk_std, it_z_n);
[ar_z, mt_z_trans] = ffy_tauchen(fl_z_persist, fl_shk_std, it_z_n);
% normalize mean of exp to 1, fl_shk_std does not shift mean.
ar_z_stationary = mt_z_trans^1000;
ar_z_stationary = ar_z_stationary(1,:);
fl_labor_agg = ar_z_stationary*exp(ar_z);
ar_z = exp(ar_z')/fl_labor_agg;

%% Default Support Parameters
% support_map
mp_support = containers.Map('KeyType','char', 'ValueType','any');

% Model Control
mp_support('fl_lowestc') = -1e10;

% Iteration Control
mp_support('it_maxiter_val') = 500;
mp_support('fl_tol_val') = 1e-5;

% printer various information
mp_support('bl_timer') = true;
mp_support('bl_print_params') = false;
mp_support('bl_print_iterinfo') = false;

% These names must match keys of mp_solu:
% what outcomes to store in the mp_solu for export
mp_support('ls_slout') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
% outcome for ff_container_map_display
mp_support('ls_ffcmd') = {'ap'};
% outcome for ff_summ_nd_array
mp_support('ls_ffsna') = {};
% outcome for ff_graph_grid
mp_support('ls_ffgrh') = {};
% outcome for ff_summ_nd_array
mp_support('ffsna_opt_it_row_n_keep') = 10;
% outcome for ff_summ_nd_array
mp_support('ffsna_opt_it_col_n_keep') = 9;

% override default support_map values
if (length(varargin)>=2 || isempty(varargin))
    mp_support = [mp_support; mp_support_ext];
end

% Parse mp_support
params_group = values(mp_support, {'fl_lowestc'});
[fl_lowestc] = params_group{:};
params_group = values(mp_support, {'it_maxiter_val', 'fl_tol_val'});
[it_maxiter_val, fl_tol_val] = params_group{:};
params_group = values(mp_support, {'bl_timer', 'bl_print_params', 'bl_print_iterinfo'});
[bl_timer, bl_print_params, bl_print_iterinfo] = params_group{:};
params_group = values(mp_support, ...
    {'ls_slout', 'ls_ffcmd', 'ls_ffsna', 'ls_ffgrh',...
    'ffsna_opt_it_row_n_keep', 'ffsna_opt_it_col_n_keep'});
[ls_slout, ls_ffcmd, ls_ffsna, ls_ffgrh,...
    ffsna_opt_it_row_n_keep, ffsna_opt_it_col_n_keep] = params_group{:};

%% Whether Additional Outcomes Should be Stored
% when state space are large, might not be a good idea to store all
% possible model output matrixes, but could be controlled with these if
% things should be outputed. If bl_store_more = true, will output store all
% additional possible outcomes if bl_vfi_store_all = true. Internally,
% which output becomes tabular or graphical controled by ls_ffcmd,
% ls_ffsna, and ls_ffgrh.

% If to store additional outcomes
cl_more = {'c', 'y', 'coh', 'savefraccoh'};
ar_find_slout = cell2mat(cellfun(@(m) find(strcmp(ls_slout, m)), cl_more, 'UniformOutput', false));
ar_find_ffcmd = cell2mat(cellfun(@(m) find(strcmp(ls_ffcmd, m)), cl_more, 'UniformOutput', false));
ar_find_ffsna = cell2mat(cellfun(@(m) find(strcmp(ls_ffsna, m)), cl_more, 'UniformOutput', false));
ar_find_ffgrh = cell2mat(cellfun(@(m) find(strcmp(ls_ffgrh, m)), cl_more, 'UniformOutput', false));
if (length(ar_find_slout) + length(ar_find_ffcmd) + length(ar_find_ffsna) + length(ar_find_ffgrh) >1)
    bl_store_more = true;
end

%% Initialize Matrix
mt_val_lst = zeros(length(ar_a),length(ar_z));
mt_val_cur = mt_val_lst;
mt_aprime_lst = zeros(length(ar_a),length(ar_z));
mt_aprime_cur = mt_aprime_lst;
mt_aprime_idx = zeros(length(ar_a),length(ar_z));
ar_val_diff_norm = zeros([it_maxiter_val, 1]);
ar_pol_diff_norm = zeros([it_maxiter_val, 1]);
mt_pol_perc_change = zeros([it_maxiter_val, length(ar_z)]);

if (bl_store_more)
    mt_c = zeros(length(ar_a),length(ar_z));
    mt_y = zeros(length(ar_a),length(ar_z));
    mt_coh = zeros(length(ar_a),length(ar_z));
end

%% Iterate and Dynamically Solve
if (bl_timer)
    tic
end

% initialize
fl_diff = 1;
it_iter = 0;

% After converge, one more iteration to store results
bl_continue = true;
bl_converged = false;

% Loop 0, continuous VFI iteration until convergence
while bl_continue
    
    % Loop 1, loop of exogenous shocks
    for it_z_ctr = 1:length(ar_z)
        fl_z = ar_z(it_z_ctr);
        
        % Loop 2, loop over endogenous asset states
        for it_a_ctr = 1:length(ar_a)
            fl_a = ar_a(it_a_ctr);
            ar_ev = zeros(size(ar_a));
            
            if(bl_store_more && bl_converged)
                ar_c = zeros(size(ar_a));
            end
            
            fl_y = fl_w*fl_z + (fl_r)*fl_a;
            
            % Loop 3, loop over asset choices
            for it_ap_ctr = 1:length(ar_a)
                fl_aprime = ar_a(it_ap_ctr);
                fl_c = fl_y + fl_a - fl_aprime;
                
                if fl_c > 0
                    
                    if (fl_crra == 1)
                        ar_ev(it_ap_ctr) = log(fl_c);
                    else
                        ar_ev(it_ap_ctr) = ((fl_c)^(1-fl_crra)-1)/(1-fl_crra);
                    end
                    
                    % Loop 4, loop over future shocks
                    for it_zprime_ctr = 1:length(ar_z)
                        ar_ev(it_ap_ctr) = ar_ev(it_ap_ctr) ...
                            + fl_beta*mt_z_trans(it_z_ctr,it_zprime_ctr)*mt_val_lst(it_ap_ctr,it_zprime_ctr);
                    end
                    
                else
                    fl_c = fl_lowestc;
                    ar_ev(it_ap_ctr) = fl_lowestc;
                end
                
                if(bl_store_more && bl_converged)
                    ar_c(it_ap_ctr) = fl_c;
                end
            end
            
            it_opti_a_idx = find(ar_ev == max(ar_ev));
            mt_val_cur(it_a_ctr,it_z_ctr) = ar_ev(it_opti_a_idx(1));
            mt_aprime_cur(it_a_ctr,it_z_ctr) = ar_a(it_opti_a_idx(1));
            
            % Save Additional Results
            if bl_converged
                mt_aprime_idx(it_a_ctr,it_z_ctr) = it_opti_a_idx(1);
                if (bl_store_more)
                    mt_c(it_a_ctr,it_z_ctr) = ar_c(it_opti_a_idx(1));
                    mt_y(it_a_ctr,it_z_ctr) = fl_y;
                    mt_coh(it_a_ctr,it_z_ctr) = fl_y + fl_a;
                end
            end
        end
    end
    
    % Continuation Conditions:
    it_iter = it_iter + 1;
    fl_diff = norm(mt_val_cur-mt_val_lst);
    diff_pol = norm(mt_aprime_cur-mt_aprime_lst);
    
    % Difference across iterations
    if (bl_print_iterinfo)
        ar_val_diff_norm(it_iter) = fl_diff;
        ar_pol_diff_norm(it_iter) = diff_pol;
        mt_pol_perc_change(it_iter, :) = sum((mt_aprime_cur ~= mt_aprime_lst))/(length(ar_a));
    end
    
    % Update
    mt_val_lst = mt_val_cur;
    mt_aprime_lst = mt_aprime_cur;
    
    % Update Continue Criterion
    if bl_converged
        bl_continue = false;
    elseif(fl_diff <= fl_tol_val || it_iter >= it_maxiter_val)
        bl_converged = true;
    end
    
    % Print Iteration Record
    if(bl_print_iterinfo)
        disp(['ff_vfi_az_bisec_loop, it_iter:' num2str(it_iter) ...
            ', fl_diff:' num2str(fl_diff)]);
    end
    
end

%% Convergence Results
it_iter_last = it_iter;
if fl_diff <= fl_tol_val || it_iter>=it_maxiter_val
    if (it_iter>=it_maxiter_val)
        flag = 2;
    else
        flag = 1;
    end
else
    flag = 0;
end

if (bl_timer)
    toc
end

%% Results for Printing, and Graphing
mp_print_graph = containers.Map('KeyType','char', 'ValueType','any');
mp_print_graph('v') = mt_val_cur;
mp_print_graph('ap') = mt_aprime_lst;
if (bl_store_more)
    mp_print_graph('c') = mt_c;
    mp_print_graph('y') = mt_y;
    mp_print_graph('coh') = mt_coh;
    mp_print_graph('savefraccoh') = mt_aprime_lst./mt_coh;
end

%% Print Parameter Information
if (bl_print_params)
    ff_container_map_display(mp_params);
    ff_container_map_display(mp_support);
end

%% Show Value Function Convergence Information
if (bl_print_iterinfo)
    
    it_z_select = unique(round(linspace(1,length(ar_z), 7)));
    ar_z_select = ar_z(it_z_select);
    tb_valpol_alliter = array2table([ar_val_diff_norm(1:it_iter_last)';...
        ar_pol_diff_norm(1:it_iter_last)';...
        mt_pol_perc_change(1:it_iter_last,it_z_select)']');
    ar_st_col_zs = matlab.lang.makeValidName(strcat('z=', string(ar_z_select)));
    cl_col_names = ['valgap', 'polgap', ar_st_col_zs];
    cl_row_names = strcat('iter=', string(1:it_iter_last));
    tb_valpol_alliter.Properties.VariableNames = cl_col_names;
    tb_valpol_alliter.Properties.RowNames = cl_row_names;
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('Value Function Iteration Per Iteration Changes');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('valgap = norm(mt_val - mt_val_cur): value function difference across iterations');
    disp('polgap = norm(mt_pol_a - mt_pol_a_cur): policy function difference across iterations');
    disp(['z1 = z1 perc change: sum((mt_pol_a ~= mt_pol_a_cur))/(it_a_n): percentage of state space'...
        ' points conditional on shock where the policy function is changing across iterations']);
    disp(tb_valpol_alliter);
    
end

%% ls_ffcmd summary
if (~isempty(ls_ffcmd))
    mp_ffcmd = containers.Map(ls_ffcmd, values(mp_print_graph, ls_ffcmd));
    ff_container_map_display(mp_ffcmd, ffsna_opt_it_row_n_keep, ffsna_opt_it_col_n_keep);
end

%% ls_ffsna summarize full
if (~isempty(ls_ffsna))
    
    % container map subseting
    mp_ffsna = containers.Map(ls_ffsna, values(mp_print_graph, ls_ffsna));
    
    % ff_summ_nd_array parameters
    it_aggd = 0;
    bl_row = 1;
    ar_permute = [2,1];
    ar_st_stats = ["mean"];
    bl_print_table = true;
    cl_mp_datasetdesc = {};
    cl_mp_datasetdesc{1} = containers.Map({'name', 'labval'}, {'a', ar_a});
    cl_mp_datasetdesc{2} = containers.Map({'name', 'labval'}, {'z', ar_z});
    
    % summarize
    param_map_keys = keys(mp_ffsna);
    param_map_vals = values(mp_ffsna);
    for i = 1:length(mp_ffsna)
        st_mt_name = param_map_keys{i};
        mt_cur = param_map_vals{i};
        st_title = ['ff_vfi_az_vec, outcome=' st_mt_name];
        ff_summ_nd_array(st_title, mt_cur, ...
            bl_print_table, ar_st_stats, it_aggd, bl_row, ...
            cl_mp_datasetdesc, ar_permute);
    end
    
end

%% ls_ffgrh graph
if (~isempty(ls_ffgrh))
    
    % container map subseting
    mp_ffgrh = containers.Map(ls_ffgrh, values(mp_print_graph, ls_ffgrh));
    
    % container map settings
    mp_support_graph = containers.Map('KeyType', 'char', 'ValueType', 'any');
    mp_support_graph('cl_st_xtitle') = {'savings states, a'};
    mp_support_graph('st_legend_loc') = 'best';
    mp_support_graph('bl_graph_logy') = true; % do not log
    mp_support_graph('st_rowvar_name') = 'shock=';
    mp_support_graph('it_legend_select') = 5; % how many shock legends to show
    mp_support_graph('st_rounding') = '6.2f'; % format shock legend
    mp_support_graph('cl_colors') = 'jet'; % any predefined matlab colormap
    
    % Overide graph options here with external parameters
    if (length(varargin)>=3)
        mp_support_graph = [mp_support_graph; mp_support_graph_ext];
    end
    
    % summarize
    param_map_keys = keys(mp_ffgrh);
    param_map_vals = values(mp_ffgrh);
    for i = 1:length(mp_ffgrh)
        % Get matrix and key
        st_mt_name = param_map_keys{i};
        mt_cur = param_map_vals{i};
        
        % Update Title and Y label
        mp_support_graph('cl_st_graph_title') = {[st_mt_name '(a,z), savings state =x, shock state = color']};
        mp_support_graph('cl_st_ytitle') = {[st_mt_name '(a,z)']};
        
        % Call function
        ff_graph_grid(mt_cur', ar_z, ar_a, mp_support_graph);
    end
    
end

%% Store Results for Output
mp_valpol_out = containers.Map(ls_slout, values(mp_print_graph, ls_slout));

end

##### SOURCE END #####
--></body></html>