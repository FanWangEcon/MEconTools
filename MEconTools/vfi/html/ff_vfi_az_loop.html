
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>FF_VFI_AZ_LOOP (looped grid choice) Dynamic Savings Problem</title><meta name="generator" content="MATLAB 9.7"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2020-07-08"><meta name="DC.source" content="ff_vfi_az_loop.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>FF_VFI_AZ_LOOP (looped grid choice) Dynamic Savings Problem</h1><!--introduction--><pre>  Slow looped solution for solving the dynamic programming problem with
  fixed assets grid using value function iteration. Obtains policy and
  value functions. Shock is AR(1). This function is looped, and
  extremely slow when state-space increases in size. This function is
  useful as a working template for developing models that rely on asset
  and shocks.</pre><pre>  * MP_PARAMS controls model preference, prices, shock and asset grid
  parameters.
  * MP_SUPPORT controls convergence criterion, printing and summary
  controls</pre><pre>  mp_params = containers.Map('KeyType','char', 'ValueType','any');
  mp_params('fl_crra') = 1.5;
  mp_params('fl_beta') = 0.95;
  mp_params('fl_w') = 1.05;
  mp_params('fl_r') = 0.03;
  mp_params('fl_a_min') = 0;
  mp_params('fl_a_max') = 50;
  mp_params('it_a_n') = 25;
  mp_params('st_grid_type') = 'grid_powerspace';
  mp_params('fl_z_persist') = 0.60;
  mp_params('fl_shk_std') = 0.10;
  mp_params('it_z_n') = 5;
  mp_params('st_grid_type') = 'grid_powerspace';</pre><pre>  mp_support = containers.Map('KeyType','char', 'ValueType','any');
  mp_support('fl_lowestc') = -10e10;
  mp_support('it_maxiter_val') = 500;
  mp_support('fl_tol_val') = 10e-5;
  % printer various information
  mp_support('bl_timer') = true;
  mp_support('bl_print_params') = false;
  mp_support('bl_print_iterinfo') = false;
  % These names must match keys of mp_solu: v=value, ap=savings choice,
  c=consumption, y=income, coh=cash-on-hand (income + savings),
  savefraccoh = ap/coh.
  % what outcomes to store in the mp_solu for export
  mp_support('ls_slout') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
  % outcome for ff_container_map_display
  mp_support('ls_ffcmd') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
  % outcome for ff_summ_nd_array
  mp_support('ls_ffsna') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
  % outcome for ff_graph_grid
  mp_support('ls_ffgrh') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
  % outcome for ff_summ_nd_array
  mp_support('ffsna_opt_it_row_n_keep') = 10;
  % outcome for ff_summ_nd_array
  mp_support('ffsna_opt_it_col_n_keep') = 9;</pre><pre>  [MP_VALPOL_OUT, FLAG] = FF_VFI_AZ_LOOP() default savings and shock
  model simulation</pre><pre>  [MP_VALPOL_OUT, FLAG] = FF_VFI_AZ_LOOP(MP_PARAMS) change model
  parameters through MP_PARAMS</pre><pre>  [MP_VALPOL_OUT, FLAG] = FF_VFI_AZ_LOOP(MP_PARAMS, MP_SUPPORT) change
  various printing, storaging, graphing, convergence etc controls
  through MP_SUPPORT</pre><pre>  [MP_VALPOL_OUT, FLAG] = FF_VFI_AZ_LOOP(MP_PARAMS, MP_SUPPORT,
  MP_SUPPORT_GRAPH) also changing graphing options, see the
  FF_GRAPH_GRID function for what key value paris can be specified.</pre><pre>  see also FX_VFI_AZ_LOOP, FF_VFI_AZ_VEC, FF_GRAPH_GRID,
  FF_VFI_AZ_BISEC_LOOP, FF_VFI_AZ_BISEC_VEC</pre><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#3">Set Default and Parse Inputs</a></li><li><a href="#4">Default Model Parameters</a></li><li><a href="#5">Parse mp_params</a></li><li><a href="#6">Generate A and Z Grids</a></li><li><a href="#7">Default Support Parameters</a></li><li><a href="#8">Whether Additional Outcomes Should be Stored</a></li><li><a href="#9">Initialize Matrix</a></li><li><a href="#10">Iterate and Dynamically Solve</a></li><li><a href="#11">Convergence Results</a></li><li><a href="#12">Results for Printing, and Graphing</a></li><li><a href="#13">Print Parameter Information</a></li><li><a href="#14">Show Value Function Convergence Information</a></li><li><a href="#15">ls_ffcmd summary</a></li><li><a href="#16">ls_ffsna summarize full</a></li><li><a href="#17">ls_ffgrh graph</a></li><li><a href="#18">Store Results for Output</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> [mp_valpol_out, flag] = ff_vfi_az_loop(varargin)
</pre><h2 id="3">Set Default and Parse Inputs</h2><pre class="codeinput"><span class="keyword">if</span> (~isempty(varargin))

    <span class="keyword">if</span> (length(varargin) == 1)
        [mp_params_ext] = varargin{:};
    <span class="keyword">elseif</span> (length(varargin) == 2)
        [mp_params_ext, mp_support_ext] = varargin{:};
    <span class="keyword">end</span>

<span class="keyword">else</span>
    close <span class="string">all</span>;
    mp_support_ext = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
    mp_support_ext(<span class="string">'bl_timer'</span>) = true;
    mp_support_ext(<span class="string">'bl_print_params'</span>) = true;
    mp_support_ext(<span class="string">'bl_print_iterinfo'</span>) = true;
    mp_support_ext(<span class="string">'ls_ffcmd'</span>) = {<span class="string">'v'</span>, <span class="string">'ap'</span>, <span class="string">'c'</span>, <span class="string">'y'</span>, <span class="string">'coh'</span>, <span class="string">'savefraccoh'</span>};
    mp_support_ext(<span class="string">'ls_ffsna'</span>) = {<span class="string">'ap'</span>};
    mp_support_ext(<span class="string">'ls_ffgrh'</span>) = {<span class="string">'v'</span>, <span class="string">'ap'</span>, <span class="string">'c'</span>, <span class="string">'y'</span>, <span class="string">'savefraccoh'</span>};
    mp_support_ext(<span class="string">'ls_store'</span>) = {<span class="string">'v'</span>, <span class="string">'ap'</span>, <span class="string">'c'</span>, <span class="string">'y'</span>, <span class="string">'coh'</span>};
    mp_support_ext(<span class="string">'ffsna_opt_it_row_n_keep'</span>) = 10;
    mp_support_ext(<span class="string">'ffsna_opt_it_col_n_keep'</span>) = 9;

<span class="keyword">end</span>
</pre><h2 id="4">Default Model Parameters</h2><p>support_map</p><pre class="codeinput">mp_params = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
mp_params(<span class="string">'fl_crra'</span>) = 1.5;
mp_params(<span class="string">'fl_beta'</span>) = 0.94;

mp_params(<span class="string">'fl_w'</span>) = 1.28;
mp_params(<span class="string">'fl_r'</span>) = 0.025;

mp_params(<span class="string">'fl_a_min'</span>) = 0;
mp_params(<span class="string">'fl_a_max'</span>) = 50;
mp_params(<span class="string">'it_a_n'</span>) = 100;
mp_params(<span class="string">'st_grid_type'</span>) = <span class="string">'grid_linspace'</span>;

mp_params(<span class="string">'fl_z_persist'</span>) = 0.80;
mp_params(<span class="string">'fl_shk_std'</span>) = 0.20;
mp_params(<span class="string">'it_z_n'</span>) = 7;

<span class="comment">% override default support_map values</span>
<span class="keyword">if</span> (length(varargin)&gt;=1)
    mp_params = [mp_params; mp_params_ext];
<span class="keyword">end</span>
</pre><h2 id="5">Parse mp_params</h2><pre class="codeinput">params_group = values(mp_params, {<span class="string">'fl_crra'</span>, <span class="string">'fl_beta'</span>});
[fl_crra, fl_beta] = params_group{:};
params_group = values(mp_params, {<span class="string">'fl_w'</span>, <span class="string">'fl_r'</span>});
[fl_w, fl_r] = params_group{:};
params_group = values(mp_params, {<span class="string">'fl_a_min'</span>, <span class="string">'fl_a_max'</span>, <span class="string">'it_a_n'</span>, <span class="string">'st_grid_type'</span>});
[fl_a_min, fl_a_max, it_a_n, st_grid_type] = params_group{:};
params_group = values(mp_params, {<span class="string">'fl_z_persist'</span>, <span class="string">'fl_shk_std'</span>, <span class="string">'it_z_n'</span>});
[fl_z_persist, fl_shk_std, it_z_n] = params_group{:};
</pre><h2 id="6">Generate A and Z Grids</h2><p>Same min and max and grid points</p><pre class="codeinput">[ar_a] = ff_saveborr_grid(fl_a_min, fl_a_max, it_a_n, st_grid_type);
ar_a = ar_a';

<span class="comment">% shock vector and transition, normalize mean exp(shk) to 1</span>
[ar_z, mt_z_trans] = ffy_rouwenhorst(fl_z_persist, fl_shk_std, it_z_n);
ar_z = exp(ar_z');
<span class="comment">% normalize mean of exp to 1, fl_shk_std does not shift mean.</span>
ar_z_stationary = mt_z_trans^1000;
ar_z_stationary = ar_z_stationary(1,:);
fl_labor_agg = ar_z_stationary*exp(ar_z');
ar_z = exp(ar_z)/fl_labor_agg;
</pre><h2 id="7">Default Support Parameters</h2><p>support_map</p><pre class="codeinput">mp_support = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);

<span class="comment">% Model Control</span>
mp_support(<span class="string">'fl_lowestc'</span>) = -10e10;

<span class="comment">% Iteration Control</span>
mp_support(<span class="string">'it_maxiter_val'</span>) = 500;
mp_support(<span class="string">'fl_tol_val'</span>) = 10e-5;

<span class="comment">% printer various information</span>
mp_support(<span class="string">'bl_timer'</span>) = true;
mp_support(<span class="string">'bl_print_params'</span>) = false;
mp_support(<span class="string">'bl_print_iterinfo'</span>) = false;

<span class="comment">% These names must match keys of mp_solu:</span>
<span class="comment">% what outcomes to store in the mp_solu for export</span>
mp_support(<span class="string">'ls_slout'</span>) = {<span class="string">'v'</span>, <span class="string">'ap'</span>, <span class="string">'c'</span>, <span class="string">'y'</span>, <span class="string">'coh'</span>, <span class="string">'savefraccoh'</span>};
<span class="comment">% outcome for ff_container_map_display</span>
mp_support(<span class="string">'ls_ffcmd'</span>) = {<span class="string">'ap'</span>};
<span class="comment">% outcome for ff_summ_nd_array</span>
mp_support(<span class="string">'ls_ffsna'</span>) = {};
<span class="comment">% outcome for ff_graph_grid</span>
mp_support(<span class="string">'ls_ffgrh'</span>) = {};
<span class="comment">% outcome for ff_summ_nd_array</span>
mp_support(<span class="string">'ffsna_opt_it_row_n_keep'</span>) = 10;
<span class="comment">% outcome for ff_summ_nd_array</span>
mp_support(<span class="string">'ffsna_opt_it_col_n_keep'</span>) = 9;

<span class="comment">% override default support_map values</span>
<span class="keyword">if</span> (length(varargin)&gt;=2 || isempty(varargin))
    mp_support = [mp_support; mp_support_ext];
<span class="keyword">end</span>

<span class="comment">% Parse mp_support</span>
params_group = values(mp_support, {<span class="string">'fl_lowestc'</span>});
[fl_lowestc] = params_group{:};
params_group = values(mp_support, {<span class="string">'it_maxiter_val'</span>, <span class="string">'fl_tol_val'</span>});
[it_maxiter_val, fl_tol_val] = params_group{:};
params_group = values(mp_support, {<span class="string">'bl_timer'</span>, <span class="string">'bl_print_params'</span>, <span class="string">'bl_print_iterinfo'</span>});
[bl_timer, bl_print_params, bl_print_iterinfo] = params_group{:};
params_group = values(mp_support, <span class="keyword">...</span>
    {<span class="string">'ls_slout'</span>, <span class="string">'ls_ffcmd'</span>, <span class="string">'ls_ffsna'</span>, <span class="string">'ls_ffgrh'</span>,<span class="keyword">...</span>
    <span class="string">'ffsna_opt_it_row_n_keep'</span>, <span class="string">'ffsna_opt_it_col_n_keep'</span>});
[ls_slout, ls_ffcmd, ls_ffsna, ls_ffgrh,<span class="keyword">...</span>
    ffsna_opt_it_row_n_keep, ffsna_opt_it_col_n_keep] = params_group{:};
</pre><h2 id="8">Whether Additional Outcomes Should be Stored</h2><p>when state space are large, might not be a good idea to store all possible model output matrixes, but could be controlled with these if things should be outputed. If bl_store_more = true, will output store all additional possible outcomes if bl_vfi_store_all = true. Internally, which output becomes tabular or graphical controled by ls_ffcmd, ls_ffsna, and ls_ffgrh.</p><pre class="codeinput"><span class="comment">% If to store additional outcomes</span>
cl_more = {<span class="string">'c'</span>, <span class="string">'y'</span>};
ar_find_slout = cell2mat(cellfun(@(m) find(strcmp(ls_slout, m)), cl_more, <span class="string">'UniformOutput'</span>, false));
ar_find_ffcmd = cell2mat(cellfun(@(m) find(strcmp(ls_ffcmd, m)), cl_more, <span class="string">'UniformOutput'</span>, false));
ar_find_ffsna = cell2mat(cellfun(@(m) find(strcmp(ls_ffsna, m)), cl_more, <span class="string">'UniformOutput'</span>, false));
ar_find_ffgrh = cell2mat(cellfun(@(m) find(strcmp(ls_ffgrh, m)), cl_more, <span class="string">'UniformOutput'</span>, false));
<span class="keyword">if</span> (length(ar_find_slout) + length(ar_find_ffcmd) + length(ar_find_ffsna) + length(ar_find_ffgrh) &gt;1)
    bl_store_more = true;
<span class="keyword">end</span>
</pre><h2 id="9">Initialize Matrix</h2><pre class="codeinput">mt_val_lst = zeros(length(ar_a),length(ar_z));
mt_val_cur = mt_val_lst;
mt_aprime_lst = zeros(length(ar_a),length(ar_z));
mt_aprime_cur = mt_aprime_lst;
mt_aprime_idx = zeros(length(ar_a),length(ar_z));
ar_val_diff_norm = zeros([it_maxiter_val, 1]);
ar_pol_diff_norm = zeros([it_maxiter_val, 1]);
mt_pol_perc_change = zeros([it_maxiter_val, length(ar_z)]);

<span class="keyword">if</span> (bl_store_more)
    mt_c = zeros(length(ar_a),length(ar_z));
    mt_y = zeros(length(ar_a),length(ar_z));
    mt_coh = zeros(length(ar_a),length(ar_z));
<span class="keyword">end</span>
</pre><h2 id="10">Iterate and Dynamically Solve</h2><pre class="codeinput"><span class="keyword">if</span> (bl_timer)
    tic
<span class="keyword">end</span>

<span class="comment">% initialize</span>
fl_diff = 1;
it_iter = 0;

<span class="comment">% After converge, one more iteration to store results</span>
bl_continue = true;
bl_converged = false;

<span class="comment">% Loop 0, continuous VFI iteration until convergence</span>
<span class="keyword">while</span> bl_continue

    <span class="comment">% Loop 1, loop of exogenous shocks</span>
    <span class="keyword">for</span> it_z_ctr = 1:length(ar_z)
        fl_z = ar_z(it_z_ctr);

        <span class="comment">% Loop 2, loop over endogenous asset states</span>
        <span class="keyword">for</span> it_a_ctr = 1:length(ar_a)
            fl_a = ar_a(it_a_ctr);
            ar_ev = zeros(size(ar_a));

            <span class="keyword">if</span>(bl_store_more &amp;&amp; bl_converged)
                ar_c = zeros(size(ar_a));
            <span class="keyword">end</span>

            fl_y = fl_w*fl_z + (fl_r)*fl_a;

            <span class="comment">% Loop 3, loop over asset choices</span>
            <span class="keyword">for</span> it_ap_ctr = 1:length(ar_a)
                fl_aprime = ar_a(it_ap_ctr);
                fl_c = fl_y + fl_a - fl_aprime;

                <span class="keyword">if</span> fl_c &gt; 0

                    <span class="keyword">if</span> (fl_crra == 1)
                        ar_ev(it_ap_ctr) = log(fl_c);
                    <span class="keyword">else</span>
                        ar_ev(it_ap_ctr) = ((fl_c)^(1-fl_crra)-1)/(1-fl_crra);
                    <span class="keyword">end</span>

                    <span class="comment">% Loop 4, loop over future shocks</span>
                    <span class="keyword">for</span> it_zprime_ctr = 1:length(ar_z)
                        ar_ev(it_ap_ctr) = ar_ev(it_ap_ctr) <span class="keyword">...</span>
                            + fl_beta*mt_z_trans(it_z_ctr,it_zprime_ctr)*mt_val_lst(it_ap_ctr,it_zprime_ctr);
                    <span class="keyword">end</span>

                <span class="keyword">else</span>
                    fl_c = fl_lowestc;
                    ar_ev(it_ap_ctr) = fl_lowestc;
                <span class="keyword">end</span>

                <span class="keyword">if</span>(bl_store_more &amp;&amp; bl_converged)
                    ar_c(it_ap_ctr) = fl_c;
                <span class="keyword">end</span>
            <span class="keyword">end</span>

            it_opti_a_idx = find(ar_ev == max(ar_ev));
            mt_val_cur(it_a_ctr,it_z_ctr) = ar_ev(it_opti_a_idx(1));
            mt_aprime_cur(it_a_ctr,it_z_ctr) = ar_a(it_opti_a_idx(1));

            <span class="comment">% Save Additional Results</span>
            <span class="keyword">if</span> bl_converged
                mt_aprime_idx(it_a_ctr,it_z_ctr) = it_opti_a_idx(1);
                <span class="keyword">if</span> (bl_store_more)
                    mt_c(it_a_ctr,it_z_ctr) = ar_c(it_opti_a_idx(1));
                    mt_y(it_a_ctr,it_z_ctr) = fl_y;
                    mt_coh(it_a_ctr,it_z_ctr) = fl_y + fl_a;
                <span class="keyword">end</span>
            <span class="keyword">end</span>
        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="comment">% Continuation Conditions:</span>
    it_iter = it_iter + 1;
    fl_diff = norm(mt_val_cur-mt_val_lst);
    diff_pol = norm(mt_aprime_cur-mt_aprime_lst);

    <span class="comment">% Difference across iterations</span>
    <span class="keyword">if</span> (bl_print_iterinfo)
        ar_val_diff_norm(it_iter) = fl_diff;
        ar_pol_diff_norm(it_iter) = diff_pol;
        mt_pol_perc_change(it_iter, :) = sum((mt_aprime_cur ~= mt_aprime_lst))/(length(ar_a));
    <span class="keyword">end</span>

    <span class="comment">% Update</span>
    mt_val_lst = mt_val_cur;
    mt_aprime_lst = mt_aprime_cur;

    <span class="comment">% Update Continue Criterion</span>
    <span class="keyword">if</span> bl_converged
        bl_continue = false;
    <span class="keyword">elseif</span>(fl_diff &lt;= fl_tol_val || it_iter &gt;= it_maxiter_val)
        bl_converged = true;
    <span class="keyword">end</span>

    <span class="comment">% Print Iteration Record</span>
    <span class="keyword">if</span>(bl_print_iterinfo)
        disp([<span class="string">'ff_vfi_az_bisec_loop, it_iter:'</span> num2str(it_iter) <span class="keyword">...</span>
            <span class="string">', fl_diff:'</span> num2str(fl_diff)]);
    <span class="keyword">end</span>

<span class="keyword">end</span>
</pre><pre class="codeoutput">ff_vfi_az_bisec_loop, it_iter:1, fl_diff:40.8357
ff_vfi_az_bisec_loop, it_iter:2, fl_diff:31.0705
ff_vfi_az_bisec_loop, it_iter:3, fl_diff:25.5303
ff_vfi_az_bisec_loop, it_iter:4, fl_diff:21.5376
ff_vfi_az_bisec_loop, it_iter:5, fl_diff:18.4465
ff_vfi_az_bisec_loop, it_iter:6, fl_diff:15.9614
ff_vfi_az_bisec_loop, it_iter:7, fl_diff:13.9145
ff_vfi_az_bisec_loop, it_iter:8, fl_diff:12.2
ff_vfi_az_bisec_loop, it_iter:9, fl_diff:10.7464
ff_vfi_az_bisec_loop, it_iter:10, fl_diff:9.5018
ff_vfi_az_bisec_loop, it_iter:11, fl_diff:8.4278
ff_vfi_az_bisec_loop, it_iter:12, fl_diff:7.4949
ff_vfi_az_bisec_loop, it_iter:13, fl_diff:6.6805
ff_vfi_az_bisec_loop, it_iter:14, fl_diff:5.9662
ff_vfi_az_bisec_loop, it_iter:15, fl_diff:5.337
ff_vfi_az_bisec_loop, it_iter:16, fl_diff:4.7819
ff_vfi_az_bisec_loop, it_iter:17, fl_diff:4.29
ff_vfi_az_bisec_loop, it_iter:18, fl_diff:3.8532
ff_vfi_az_bisec_loop, it_iter:19, fl_diff:3.4653
ff_vfi_az_bisec_loop, it_iter:20, fl_diff:3.1195
ff_vfi_az_bisec_loop, it_iter:21, fl_diff:2.8106
ff_vfi_az_bisec_loop, it_iter:22, fl_diff:2.5347
ff_vfi_az_bisec_loop, it_iter:23, fl_diff:2.2881
ff_vfi_az_bisec_loop, it_iter:24, fl_diff:2.0672
ff_vfi_az_bisec_loop, it_iter:25, fl_diff:1.8694
ff_vfi_az_bisec_loop, it_iter:26, fl_diff:1.6922
ff_vfi_az_bisec_loop, it_iter:27, fl_diff:1.5329
ff_vfi_az_bisec_loop, it_iter:28, fl_diff:1.3897
ff_vfi_az_bisec_loop, it_iter:29, fl_diff:1.261
ff_vfi_az_bisec_loop, it_iter:30, fl_diff:1.1453
ff_vfi_az_bisec_loop, it_iter:31, fl_diff:1.0414
ff_vfi_az_bisec_loop, it_iter:32, fl_diff:0.94814
ff_vfi_az_bisec_loop, it_iter:33, fl_diff:0.86421
ff_vfi_az_bisec_loop, it_iter:34, fl_diff:0.78869
ff_vfi_az_bisec_loop, it_iter:35, fl_diff:0.72065
ff_vfi_az_bisec_loop, it_iter:36, fl_diff:0.65931
ff_vfi_az_bisec_loop, it_iter:37, fl_diff:0.60401
ff_vfi_az_bisec_loop, it_iter:38, fl_diff:0.55416
ff_vfi_az_bisec_loop, it_iter:39, fl_diff:0.50918
ff_vfi_az_bisec_loop, it_iter:40, fl_diff:0.46858
ff_vfi_az_bisec_loop, it_iter:41, fl_diff:0.43187
ff_vfi_az_bisec_loop, it_iter:42, fl_diff:0.39867
ff_vfi_az_bisec_loop, it_iter:43, fl_diff:0.36857
ff_vfi_az_bisec_loop, it_iter:44, fl_diff:0.34125
ff_vfi_az_bisec_loop, it_iter:45, fl_diff:0.31638
ff_vfi_az_bisec_loop, it_iter:46, fl_diff:0.2937
ff_vfi_az_bisec_loop, it_iter:47, fl_diff:0.27297
ff_vfi_az_bisec_loop, it_iter:48, fl_diff:0.25399
ff_vfi_az_bisec_loop, it_iter:49, fl_diff:0.23656
ff_vfi_az_bisec_loop, it_iter:50, fl_diff:0.22054
ff_vfi_az_bisec_loop, it_iter:51, fl_diff:0.20577
ff_vfi_az_bisec_loop, it_iter:52, fl_diff:0.19213
ff_vfi_az_bisec_loop, it_iter:53, fl_diff:0.17952
ff_vfi_az_bisec_loop, it_iter:54, fl_diff:0.16784
ff_vfi_az_bisec_loop, it_iter:55, fl_diff:0.15701
ff_vfi_az_bisec_loop, it_iter:56, fl_diff:0.14695
ff_vfi_az_bisec_loop, it_iter:57, fl_diff:0.13759
ff_vfi_az_bisec_loop, it_iter:58, fl_diff:0.12888
ff_vfi_az_bisec_loop, it_iter:59, fl_diff:0.12077
ff_vfi_az_bisec_loop, it_iter:60, fl_diff:0.11321
ff_vfi_az_bisec_loop, it_iter:61, fl_diff:0.10614
ff_vfi_az_bisec_loop, it_iter:62, fl_diff:0.09955
ff_vfi_az_bisec_loop, it_iter:63, fl_diff:0.093387
ff_vfi_az_bisec_loop, it_iter:64, fl_diff:0.087624
ff_vfi_az_bisec_loop, it_iter:65, fl_diff:0.082231
ff_vfi_az_bisec_loop, it_iter:66, fl_diff:0.077184
ff_vfi_az_bisec_loop, it_iter:67, fl_diff:0.072457
ff_vfi_az_bisec_loop, it_iter:68, fl_diff:0.068029
ff_vfi_az_bisec_loop, it_iter:69, fl_diff:0.063879
ff_vfi_az_bisec_loop, it_iter:70, fl_diff:0.059989
ff_vfi_az_bisec_loop, it_iter:71, fl_diff:0.056342
ff_vfi_az_bisec_loop, it_iter:72, fl_diff:0.05292
ff_vfi_az_bisec_loop, it_iter:73, fl_diff:0.049711
ff_vfi_az_bisec_loop, it_iter:74, fl_diff:0.046699
ff_vfi_az_bisec_loop, it_iter:75, fl_diff:0.043873
ff_vfi_az_bisec_loop, it_iter:76, fl_diff:0.04122
ff_vfi_az_bisec_loop, it_iter:77, fl_diff:0.038729
ff_vfi_az_bisec_loop, it_iter:78, fl_diff:0.036391
ff_vfi_az_bisec_loop, it_iter:79, fl_diff:0.034195
ff_vfi_az_bisec_loop, it_iter:80, fl_diff:0.032133
ff_vfi_az_bisec_loop, it_iter:81, fl_diff:0.030196
ff_vfi_az_bisec_loop, it_iter:82, fl_diff:0.028377
ff_vfi_az_bisec_loop, it_iter:83, fl_diff:0.026668
ff_vfi_az_bisec_loop, it_iter:84, fl_diff:0.025063
ff_vfi_az_bisec_loop, it_iter:85, fl_diff:0.023555
ff_vfi_az_bisec_loop, it_iter:86, fl_diff:0.022138
ff_vfi_az_bisec_loop, it_iter:87, fl_diff:0.020806
ff_vfi_az_bisec_loop, it_iter:88, fl_diff:0.019555
ff_vfi_az_bisec_loop, it_iter:89, fl_diff:0.01838
ff_vfi_az_bisec_loop, it_iter:90, fl_diff:0.017275
ff_vfi_az_bisec_loop, it_iter:91, fl_diff:0.016237
ff_vfi_az_bisec_loop, it_iter:92, fl_diff:0.015261
ff_vfi_az_bisec_loop, it_iter:93, fl_diff:0.014344
ff_vfi_az_bisec_loop, it_iter:94, fl_diff:0.013483
ff_vfi_az_bisec_loop, it_iter:95, fl_diff:0.012673
ff_vfi_az_bisec_loop, it_iter:96, fl_diff:0.011912
ff_vfi_az_bisec_loop, it_iter:97, fl_diff:0.011197
ff_vfi_az_bisec_loop, it_iter:98, fl_diff:0.010524
ff_vfi_az_bisec_loop, it_iter:99, fl_diff:0.0098924
ff_vfi_az_bisec_loop, it_iter:100, fl_diff:0.0092986
ff_vfi_az_bisec_loop, it_iter:101, fl_diff:0.0087403
ff_vfi_az_bisec_loop, it_iter:102, fl_diff:0.0082157
ff_vfi_az_bisec_loop, it_iter:103, fl_diff:0.0077225
ff_vfi_az_bisec_loop, it_iter:104, fl_diff:0.007259
ff_vfi_az_bisec_loop, it_iter:105, fl_diff:0.0068233
ff_vfi_az_bisec_loop, it_iter:106, fl_diff:0.0064138
ff_vfi_az_bisec_loop, it_iter:107, fl_diff:0.0060289
ff_vfi_az_bisec_loop, it_iter:108, fl_diff:0.005667
ff_vfi_az_bisec_loop, it_iter:109, fl_diff:0.0053269
ff_vfi_az_bisec_loop, it_iter:110, fl_diff:0.0050073
ff_vfi_az_bisec_loop, it_iter:111, fl_diff:0.0047068
ff_vfi_az_bisec_loop, it_iter:112, fl_diff:0.0044243
ff_vfi_az_bisec_loop, it_iter:113, fl_diff:0.0041588
ff_vfi_az_bisec_loop, it_iter:114, fl_diff:0.0039093
ff_vfi_az_bisec_loop, it_iter:115, fl_diff:0.0036747
ff_vfi_az_bisec_loop, it_iter:116, fl_diff:0.0034542
ff_vfi_az_bisec_loop, it_iter:117, fl_diff:0.0032469
ff_vfi_az_bisec_loop, it_iter:118, fl_diff:0.0030521
ff_vfi_az_bisec_loop, it_iter:119, fl_diff:0.0028689
ff_vfi_az_bisec_loop, it_iter:120, fl_diff:0.0026968
ff_vfi_az_bisec_loop, it_iter:121, fl_diff:0.002535
ff_vfi_az_bisec_loop, it_iter:122, fl_diff:0.0023829
ff_vfi_az_bisec_loop, it_iter:123, fl_diff:0.0022399
ff_vfi_az_bisec_loop, it_iter:124, fl_diff:0.0021055
ff_vfi_az_bisec_loop, it_iter:125, fl_diff:0.0019792
ff_vfi_az_bisec_loop, it_iter:126, fl_diff:0.0018604
ff_vfi_az_bisec_loop, it_iter:127, fl_diff:0.0017488
ff_vfi_az_bisec_loop, it_iter:128, fl_diff:0.0016438
ff_vfi_az_bisec_loop, it_iter:129, fl_diff:0.0015452
ff_vfi_az_bisec_loop, it_iter:130, fl_diff:0.0014525
ff_vfi_az_bisec_loop, it_iter:131, fl_diff:0.0013653
ff_vfi_az_bisec_loop, it_iter:132, fl_diff:0.0012834
ff_vfi_az_bisec_loop, it_iter:133, fl_diff:0.0012064
ff_vfi_az_bisec_loop, it_iter:134, fl_diff:0.001134
ff_vfi_az_bisec_loop, it_iter:135, fl_diff:0.001066
ff_vfi_az_bisec_loop, it_iter:136, fl_diff:0.001002
ff_vfi_az_bisec_loop, it_iter:137, fl_diff:0.0009419
ff_vfi_az_bisec_loop, it_iter:138, fl_diff:0.00088539
ff_vfi_az_bisec_loop, it_iter:139, fl_diff:0.00083227
ff_vfi_az_bisec_loop, it_iter:140, fl_diff:0.00078233
ff_vfi_az_bisec_loop, it_iter:141, fl_diff:0.00073539
ff_vfi_az_bisec_loop, it_iter:142, fl_diff:0.00069127
ff_vfi_az_bisec_loop, it_iter:143, fl_diff:0.00064979
ff_vfi_az_bisec_loop, it_iter:144, fl_diff:0.0006108
ff_vfi_az_bisec_loop, it_iter:145, fl_diff:0.00057415
ff_vfi_az_bisec_loop, it_iter:146, fl_diff:0.0005397
ff_vfi_az_bisec_loop, it_iter:147, fl_diff:0.00050732
ff_vfi_az_bisec_loop, it_iter:148, fl_diff:0.00047688
ff_vfi_az_bisec_loop, it_iter:149, fl_diff:0.00044827
ff_vfi_az_bisec_loop, it_iter:150, fl_diff:0.00042137
ff_vfi_az_bisec_loop, it_iter:151, fl_diff:0.00039609
ff_vfi_az_bisec_loop, it_iter:152, fl_diff:0.00037233
ff_vfi_az_bisec_loop, it_iter:153, fl_diff:0.00034999
ff_vfi_az_bisec_loop, it_iter:154, fl_diff:0.00032899
ff_vfi_az_bisec_loop, it_iter:155, fl_diff:0.00030925
ff_vfi_az_bisec_loop, it_iter:156, fl_diff:0.00029069
ff_vfi_az_bisec_loop, it_iter:157, fl_diff:0.00027325
ff_vfi_az_bisec_loop, it_iter:158, fl_diff:0.00025686
ff_vfi_az_bisec_loop, it_iter:159, fl_diff:0.00024144
ff_vfi_az_bisec_loop, it_iter:160, fl_diff:0.00022696
ff_vfi_az_bisec_loop, it_iter:161, fl_diff:0.00021334
ff_vfi_az_bisec_loop, it_iter:162, fl_diff:0.00020054
ff_vfi_az_bisec_loop, it_iter:163, fl_diff:0.00018851
ff_vfi_az_bisec_loop, it_iter:164, fl_diff:0.0001772
ff_vfi_az_bisec_loop, it_iter:165, fl_diff:0.00016657
ff_vfi_az_bisec_loop, it_iter:166, fl_diff:0.00015657
ff_vfi_az_bisec_loop, it_iter:167, fl_diff:0.00014718
ff_vfi_az_bisec_loop, it_iter:168, fl_diff:0.00013835
ff_vfi_az_bisec_loop, it_iter:169, fl_diff:0.00013005
ff_vfi_az_bisec_loop, it_iter:170, fl_diff:0.00012224
ff_vfi_az_bisec_loop, it_iter:171, fl_diff:0.00011491
ff_vfi_az_bisec_loop, it_iter:172, fl_diff:0.00010801
ff_vfi_az_bisec_loop, it_iter:173, fl_diff:0.00010153
ff_vfi_az_bisec_loop, it_iter:174, fl_diff:9.5441e-05
ff_vfi_az_bisec_loop, it_iter:175, fl_diff:8.9715e-05
</pre><h2 id="11">Convergence Results</h2><pre class="codeinput">it_iter_last = it_iter;
<span class="keyword">if</span> fl_diff &lt;= fl_tol_val || it_iter&gt;=it_maxiter_val
    mt_val_cur = mt_val_lst;
    mt_aprime = mt_aprime_lst;
    <span class="keyword">if</span> (it_iter&gt;=it_maxiter_val)
        flag = 2;
    <span class="keyword">else</span>
        flag = 1;
    <span class="keyword">end</span>
<span class="keyword">else</span>
    mt_val = zeros(size(mt_val_lst));
    mt_aprime = zeros(size(mt_val_lst));
    flag = 0;
<span class="keyword">end</span>

<span class="keyword">if</span> (bl_timer)
    toc
<span class="keyword">end</span>
</pre><pre class="codeoutput">Elapsed time is 1.510136 seconds.
</pre><h2 id="12">Results for Printing, and Graphing</h2><pre class="codeinput">mp_print_graph = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
mp_print_graph(<span class="string">'v'</span>) = mt_val_cur;
mp_print_graph(<span class="string">'ap'</span>) = mt_aprime;
<span class="keyword">if</span> (bl_store_more)
    mp_print_graph(<span class="string">'c'</span>) = mt_c;
    mp_print_graph(<span class="string">'y'</span>) = mt_y;
    mp_print_graph(<span class="string">'coh'</span>) = mt_coh;
    mp_print_graph(<span class="string">'savefraccoh'</span>) = mt_aprime./mt_coh;
<span class="keyword">end</span>
</pre><h2 id="13">Print Parameter Information</h2><pre class="codeinput"><span class="keyword">if</span> (bl_print_params)
    ff_container_map_display(mp_params);
    ff_container_map_display(mp_support);
<span class="keyword">end</span>
</pre><pre class="codeoutput">----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params Scalars
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                    i     idx    value
                    __    ___    _____

    fl_a_max         1     1        50
    fl_a_min         2     2         0
    fl_beta          3     3      0.94
    fl_crra          4     4       1.5
    fl_r             5     5     0.025
    fl_shk_std       6     6       0.2
    fl_w             7     7      1.28
    fl_z_persist     8     8       0.8
    it_a_n           9     9       100
    it_z_n          10    10         7

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_params String
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                     i     idx         string     
                    ___    ____    _______________

    st_grid_type    "1"    "11"    "grid_linspace"

pos = 11 ; key = ls_ffsna
    'ap'

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_support Scalars
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                               i    idx    value 
                               _    ___    ______

    bl_print_iterinfo          1     1          1
    bl_print_params            2     2          1
    bl_timer                   3     3          1
    ffsna_opt_it_col_n_keep    4     4          9
    ffsna_opt_it_row_n_keep    5     5         10
    fl_lowestc                 6     6     -1e+11
    fl_tol_val                 7     7     0.0001
    it_maxiter_val             8     8        500

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_support String
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                 i     idx               string          
                ___    ____    __________________________

    ls_ffcmd    "1"    "9"     "v;ap;c;y;coh;savefraccoh"
    ls_ffgrh    "2"    "10"    "v;ap;c;y;savefraccoh"    
    ls_slout    "3"    "12"    "v;ap;c;y;coh;savefraccoh"
    ls_store    "4"    "13"    "v;ap;c;y;coh"            

</pre><h2 id="14">Show Value Function Convergence Information</h2><pre class="codeinput"><span class="keyword">if</span> (bl_print_iterinfo)

    it_z_select = unique(round(linspace(1,length(ar_z), 7)));
    ar_z_select = ar_z(it_z_select);
    tb_valpol_alliter = array2table([ar_val_diff_norm(1:it_iter_last)';<span class="keyword">...</span>
        ar_pol_diff_norm(1:it_iter_last)';<span class="keyword">...</span>
        mt_pol_perc_change(1:it_iter_last,it_z_select)']');
    ar_st_col_zs = matlab.lang.makeValidName(strcat(<span class="string">'z='</span>, string(ar_z_select)));
    cl_col_names = [<span class="string">'valgap'</span>, <span class="string">'polgap'</span>, ar_st_col_zs];
    cl_row_names = strcat(<span class="string">'iter='</span>, string(1:it_iter_last));
    tb_valpol_alliter.Properties.VariableNames = cl_col_names;
    tb_valpol_alliter.Properties.RowNames = cl_row_names;
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'Value Function Iteration Per Iteration Changes'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'valgap = norm(mt_val - mt_val_cur): value function difference across iterations'</span>);
    disp(<span class="string">'polgap = norm(mt_pol_a - mt_pol_a_cur): policy function difference across iterations'</span>);
    disp([<span class="string">'z1 = z1 perc change: sum((mt_pol_a ~= mt_pol_a_cur))/(it_a_n): percentage of state space'</span><span class="keyword">...</span>
        <span class="string">' points conditional on shock where the policy function is changing across iterations'</span>]);
    disp(tb_valpol_alliter);

<span class="keyword">end</span>
</pre><pre class="codeoutput">xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Value Function Iteration Per Iteration Changes
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
valgap = norm(mt_val - mt_val_cur): value function difference across iterations
polgap = norm(mt_pol_a - mt_pol_a_cur): policy function difference across iterations
z1 = z1 perc change: sum((mt_pol_a ~= mt_pol_a_cur))/(it_a_n): percentage of state space points conditional on shock where the policy function is changing across iterations
                  valgap      polgap     z_0_50352    z_0_57817    z_0_69323    z_0_87975    z_1_2028    z_1_8136    z_3_1094
                __________    _______    _________    _________    _________    _________    ________    ________    ________

    iter=1          40.836          0         0            0            0            0            0           0           0  
    iter=2          31.071     382.51      0.98         0.98         0.98         0.98         0.99        0.99           1  
    iter=3           25.53     128.62      0.96         0.96         0.96         0.96         0.97        0.99        0.99  
    iter=4          21.538     64.485      0.93         0.93         0.93         0.93         0.94        0.96        0.99  
    iter=5          18.447     38.839      0.89         0.89         0.89         0.89          0.9        0.93        0.96  
    iter=6          15.961     26.406      0.84         0.84         0.84         0.85         0.84        0.88        0.92  
    iter=7          13.914      18.57      0.78         0.78         0.78         0.78         0.77        0.82        0.86  
    iter=8            12.2     13.722      0.66         0.67         0.69         0.71         0.71        0.76        0.79  
    iter=9          10.746     10.574      0.57         0.57         0.58         0.63         0.62        0.68         0.7  
    iter=10         9.5018     8.4949      0.48         0.49         0.49         0.52         0.52        0.57        0.63  
    iter=11         8.4278     7.1199      0.39         0.39         0.39         0.41         0.42        0.45        0.54  
    iter=12         7.4949     6.3316      0.32         0.32         0.33         0.34         0.35         0.4        0.45  
    iter=13         6.6805     5.4631      0.27         0.27         0.29          0.3          0.3        0.31        0.38  
    iter=14         5.9662       4.62      0.23         0.21         0.22         0.21         0.26        0.27         0.3  
    iter=15          5.337     3.9983      0.17         0.19         0.19         0.22         0.19        0.21        0.29  
    iter=16         4.7819     3.7602      0.15         0.17         0.17         0.17          0.2        0.22        0.21  
    iter=17           4.29     2.9737      0.13         0.13         0.12         0.14         0.14        0.14         0.2  
    iter=18         3.8532     2.7753      0.11         0.11         0.12         0.15         0.14        0.13        0.19  
    iter=19         3.4653     2.8201       0.1         0.12         0.13         0.08         0.12        0.16        0.13  
    iter=20         3.1195     2.6094      0.11          0.1         0.07         0.09         0.13        0.09        0.13  
    iter=21         2.8106     1.9879      0.07         0.06         0.08          0.1         0.08        0.08        0.14  
    iter=22         2.5347     1.9456      0.04         0.07         0.07         0.08         0.06        0.08         0.1  
    iter=23         2.2881     1.8373      0.07         0.05         0.06         0.07         0.08        0.08        0.08  
    iter=24         2.0672      1.639      0.05         0.05         0.06         0.05         0.05        0.07        0.09  
    iter=25         1.8694     1.7912      0.03         0.06         0.06         0.04         0.07        0.08        0.06  
    iter=26         1.6922     1.5028      0.04         0.04         0.05         0.04         0.05        0.04        0.07  
    iter=27         1.5329     1.6826      0.05         0.05         0.02         0.03         0.05        0.04        0.07  
    iter=28         1.3897     1.2917      0.03         0.02         0.04         0.04         0.04        0.02        0.04  
    iter=29          1.261     1.2612      0.03         0.02         0.02         0.03         0.02        0.03        0.05  
    iter=30         1.1453     1.0611      0.01         0.02         0.02         0.02         0.03        0.04        0.04  
    iter=31         1.0414    0.87477      0.02         0.01         0.02         0.03         0.02        0.02        0.02  
    iter=32        0.94814     1.1557      0.01         0.02         0.02         0.03         0.02        0.03        0.04  
    iter=33        0.86421    0.71425      0.01         0.01         0.01         0.01         0.02        0.02        0.02  
    iter=34        0.78869    0.93321      0.02         0.01         0.02         0.02         0.01        0.03        0.03  
    iter=35        0.72065    0.87477         0         0.01         0.01         0.03         0.02        0.02        0.02  
    iter=36        0.65931    0.81719      0.01         0.02         0.02         0.02         0.01        0.01        0.02  
    iter=37        0.60401    0.81719      0.01         0.01            0         0.02         0.01        0.02        0.02  
    iter=38        0.55416    0.81719         0            0         0.02         0.01         0.02        0.01        0.01  
    iter=39        0.50918    0.71425      0.01         0.02         0.01         0.01            0        0.02        0.02  
    iter=40        0.46858    0.50505         0            0            0            0         0.01        0.01        0.01  
    iter=41        0.43187    0.71425      0.01            0         0.02            0         0.01        0.02           0  
    iter=42        0.39867    0.71425      0.01         0.01            0            0         0.01           0        0.02  
    iter=43        0.36857    0.71425         0         0.01         0.01         0.01         0.01        0.01        0.02  
    iter=44        0.34125    0.71425         0            0            0            0            0        0.02           0  
    iter=45        0.31638    0.50505         0         0.01            0            0            0           0        0.01  
    iter=46         0.2937    0.50505      0.01            0         0.01            0         0.01        0.01           0  
    iter=47        0.27297    0.71425         0            0            0            0            0           0        0.02  
    iter=48        0.25399          0         0            0            0            0            0           0           0  
    iter=49        0.23656          0         0            0            0            0            0           0           0  
    iter=50        0.22054    0.50505         0            0            0            0         0.01           0        0.01  
    iter=51        0.20577          0         0            0            0            0            0           0           0  
    iter=52        0.19213    0.50505         0            0         0.01            0            0           0           0  
    iter=53        0.17952          0         0            0            0            0            0           0           0  
    iter=54        0.16784          0         0            0            0            0            0           0           0  
    iter=55        0.15701    0.50505      0.01         0.01            0            0            0           0           0  
    iter=56        0.14695    0.50505         0            0            0            0            0           0        0.01  
    iter=57        0.13759          0         0            0            0            0            0           0           0  
    iter=58        0.12888          0         0            0            0            0            0           0           0  
    iter=59        0.12077    0.50505         0            0            0         0.01            0           0           0  
    iter=60        0.11321          0         0            0            0            0            0           0           0  
    iter=61        0.10614          0         0            0            0            0            0           0           0  
    iter=62        0.09955          0         0            0            0            0            0           0           0  
    iter=63       0.093387          0         0            0            0            0            0           0           0  
    iter=64       0.087624          0         0            0            0            0            0           0           0  
    iter=65       0.082231          0         0            0            0            0            0           0           0  
    iter=66       0.077184          0         0            0            0            0            0           0           0  
    iter=67       0.072457    0.50505         0            0            0            0         0.01           0           0  
    iter=68       0.068029          0         0            0            0            0            0           0           0  
    iter=69       0.063879          0         0            0            0            0            0           0           0  
    iter=70       0.059989          0         0            0            0            0            0           0           0  
    iter=71       0.056342          0         0            0            0            0            0           0           0  
    iter=72        0.05292          0         0            0            0            0            0           0           0  
    iter=73       0.049711          0         0            0            0            0            0           0           0  
    iter=74       0.046699          0         0            0            0            0            0           0           0  
    iter=75       0.043873          0         0            0            0            0            0           0           0  
    iter=76        0.04122          0         0            0            0            0            0           0           0  
    iter=77       0.038729          0         0            0            0            0            0           0           0  
    iter=78       0.036391          0         0            0            0            0            0           0           0  
    iter=79       0.034195          0         0            0            0            0            0           0           0  
    iter=80       0.032133          0         0            0            0            0            0           0           0  
    iter=81       0.030196          0         0            0            0            0            0           0           0  
    iter=82       0.028377          0         0            0            0            0            0           0           0  
    iter=83       0.026668          0         0            0            0            0            0           0           0  
    iter=84       0.025063          0         0            0            0            0            0           0           0  
    iter=85       0.023555          0         0            0            0            0            0           0           0  
    iter=86       0.022138          0         0            0            0            0            0           0           0  
    iter=87       0.020806          0         0            0            0            0            0           0           0  
    iter=88       0.019555          0         0            0            0            0            0           0           0  
    iter=89        0.01838          0         0            0            0            0            0           0           0  
    iter=90       0.017275          0         0            0            0            0            0           0           0  
    iter=91       0.016237          0         0            0            0            0            0           0           0  
    iter=92       0.015261          0         0            0            0            0            0           0           0  
    iter=93       0.014344          0         0            0            0            0            0           0           0  
    iter=94       0.013483          0         0            0            0            0            0           0           0  
    iter=95       0.012673          0         0            0            0            0            0           0           0  
    iter=96       0.011912          0         0            0            0            0            0           0           0  
    iter=97       0.011197          0         0            0            0            0            0           0           0  
    iter=98       0.010524          0         0            0            0            0            0           0           0  
    iter=99      0.0098924          0         0            0            0            0            0           0           0  
    iter=100     0.0092986          0         0            0            0            0            0           0           0  
    iter=101     0.0087403          0         0            0            0            0            0           0           0  
    iter=102     0.0082157          0         0            0            0            0            0           0           0  
    iter=103     0.0077225          0         0            0            0            0            0           0           0  
    iter=104      0.007259          0         0            0            0            0            0           0           0  
    iter=105     0.0068233          0         0            0            0            0            0           0           0  
    iter=106     0.0064138          0         0            0            0            0            0           0           0  
    iter=107     0.0060289          0         0            0            0            0            0           0           0  
    iter=108      0.005667          0         0            0            0            0            0           0           0  
    iter=109     0.0053269          0         0            0            0            0            0           0           0  
    iter=110     0.0050073          0         0            0            0            0            0           0           0  
    iter=111     0.0047068          0         0            0            0            0            0           0           0  
    iter=112     0.0044243          0         0            0            0            0            0           0           0  
    iter=113     0.0041588          0         0            0            0            0            0           0           0  
    iter=114     0.0039093          0         0            0            0            0            0           0           0  
    iter=115     0.0036747          0         0            0            0            0            0           0           0  
    iter=116     0.0034542          0         0            0            0            0            0           0           0  
    iter=117     0.0032469          0         0            0            0            0            0           0           0  
    iter=118     0.0030521          0         0            0            0            0            0           0           0  
    iter=119     0.0028689          0         0            0            0            0            0           0           0  
    iter=120     0.0026968          0         0            0            0            0            0           0           0  
    iter=121      0.002535          0         0            0            0            0            0           0           0  
    iter=122     0.0023829          0         0            0            0            0            0           0           0  
    iter=123     0.0022399          0         0            0            0            0            0           0           0  
    iter=124     0.0021055          0         0            0            0            0            0           0           0  
    iter=125     0.0019792          0         0            0            0            0            0           0           0  
    iter=126     0.0018604          0         0            0            0            0            0           0           0  
    iter=127     0.0017488          0         0            0            0            0            0           0           0  
    iter=128     0.0016438          0         0            0            0            0            0           0           0  
    iter=129     0.0015452          0         0            0            0            0            0           0           0  
    iter=130     0.0014525          0         0            0            0            0            0           0           0  
    iter=131     0.0013653          0         0            0            0            0            0           0           0  
    iter=132     0.0012834          0         0            0            0            0            0           0           0  
    iter=133     0.0012064          0         0            0            0            0            0           0           0  
    iter=134      0.001134          0         0            0            0            0            0           0           0  
    iter=135      0.001066          0         0            0            0            0            0           0           0  
    iter=136      0.001002          0         0            0            0            0            0           0           0  
    iter=137     0.0009419          0         0            0            0            0            0           0           0  
    iter=138    0.00088539          0         0            0            0            0            0           0           0  
    iter=139    0.00083227          0         0            0            0            0            0           0           0  
    iter=140    0.00078233          0         0            0            0            0            0           0           0  
    iter=141    0.00073539          0         0            0            0            0            0           0           0  
    iter=142    0.00069127          0         0            0            0            0            0           0           0  
    iter=143    0.00064979          0         0            0            0            0            0           0           0  
    iter=144     0.0006108          0         0            0            0            0            0           0           0  
    iter=145    0.00057415          0         0            0            0            0            0           0           0  
    iter=146     0.0005397          0         0            0            0            0            0           0           0  
    iter=147    0.00050732          0         0            0            0            0            0           0           0  
    iter=148    0.00047688          0         0            0            0            0            0           0           0  
    iter=149    0.00044827          0         0            0            0            0            0           0           0  
    iter=150    0.00042137          0         0            0            0            0            0           0           0  
    iter=151    0.00039609          0         0            0            0            0            0           0           0  
    iter=152    0.00037233          0         0            0            0            0            0           0           0  
    iter=153    0.00034999          0         0            0            0            0            0           0           0  
    iter=154    0.00032899          0         0            0            0            0            0           0           0  
    iter=155    0.00030925          0         0            0            0            0            0           0           0  
    iter=156    0.00029069          0         0            0            0            0            0           0           0  
    iter=157    0.00027325          0         0            0            0            0            0           0           0  
    iter=158    0.00025686          0         0            0            0            0            0           0           0  
    iter=159    0.00024144          0         0            0            0            0            0           0           0  
    iter=160    0.00022696          0         0            0            0            0            0           0           0  
    iter=161    0.00021334          0         0            0            0            0            0           0           0  
    iter=162    0.00020054          0         0            0            0            0            0           0           0  
    iter=163    0.00018851          0         0            0            0            0            0           0           0  
    iter=164     0.0001772          0         0            0            0            0            0           0           0  
    iter=165    0.00016657          0         0            0            0            0            0           0           0  
    iter=166    0.00015657          0         0            0            0            0            0           0           0  
    iter=167    0.00014718          0         0            0            0            0            0           0           0  
    iter=168    0.00013835          0         0            0            0            0            0           0           0  
    iter=169    0.00013005          0         0            0            0            0            0           0           0  
    iter=170    0.00012224          0         0            0            0            0            0           0           0  
    iter=171    0.00011491          0         0            0            0            0            0           0           0  
    iter=172    0.00010801          0         0            0            0            0            0           0           0  
    iter=173    0.00010153          0         0            0            0            0            0           0           0  
    iter=174    9.5441e-05          0         0            0            0            0            0           0           0  
    iter=175    8.9715e-05          0         0            0            0            0            0           0           0  

</pre><h2 id="15">ls_ffcmd summary</h2><pre class="codeinput"><span class="keyword">if</span> (~isempty(ls_ffcmd))
    mp_ffcmd = containers.Map(ls_ffcmd, values(mp_print_graph, ls_ffcmd));
    ff_container_map_display(mp_ffcmd, ffsna_opt_it_row_n_keep, ffsna_opt_it_col_n_keep);
<span class="keyword">end</span>
</pre><pre class="codeoutput">----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CONTAINER NAME: mp_ffcmd ND Array (Matrix etc)
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                   i    idx    ndim    numel    rowN    colN     sum       mean        std      coefvari      min         max  
                   _    ___    ____    _____    ____    ____    ______    _______    _______    ________    ________    _______

    ap             1     1      2       700     100      7       16864     24.091      14.08    0.58446            0         50
    c              2     2      2       700     100      7      2197.8     3.1397     0.9468    0.30156       0.6445     5.2301
    coh            3     3      2       700     100      7       19061     27.231     14.995    0.55066       0.6445      55.23
    savefraccoh    4     4      2       700     100      7      584.41    0.83488    0.13791    0.16519            0    0.91797
    v              5     5      2       700     100      7      7169.7     10.242     3.2404    0.31637     -0.30178     15.112
    y              6     6      2       700     100      7      1561.4     2.2306      1.166    0.52274       0.6445     5.2301

xxx TABLE:ap xxxxxxxxxxxxxxxxxx
              c1         c2         c3         c4         c5         c6         c7  
            _______    _______    _______    _______    _______    _______    ______

    r1            0          0          0          0          0    0.50505    2.0202
    r2            0          0          0    0.50505    0.50505     1.0101    2.5253
    r3      0.50505    0.50505    0.50505    0.50505     1.0101     1.5152    3.0303
    r4       1.0101     1.0101     1.0101     1.0101     1.5152     2.0202    3.5354
    r5       1.5152     1.5152     1.5152     1.5152     2.0202     2.5253    4.0404
    r96      45.455     45.455      45.96      45.96      45.96      46.97    48.485
    r97       45.96      45.96      45.96     46.465     46.465     47.475     48.99
    r98      46.465     46.465     46.465      46.97      46.97      47.98     48.99
    r99       46.97      46.97      46.97     47.475     47.475     48.485    49.495
    r100     47.475     47.475     47.475      47.98      47.98      48.99        50

xxx TABLE:c xxxxxxxxxxxxxxxxxx
              c1        c2         c3         c4        c5        c6        c7  
            ______    _______    _______    ______    ______    ______    ______

    r1      0.6445    0.74006    0.88734    1.1261    1.5396    1.8164    1.9599
    r2      1.1622     1.2577      1.405    1.1387    1.5523     1.829    1.9725
    r3      1.1748     1.2704     1.4176    1.6564    1.5649    1.8417    1.9851
    r4      1.1874      1.283     1.4303     1.669    1.5775    1.8543    1.9978
    r5      1.2001     1.2956     1.4429    1.6816    1.5901    1.8669    2.0104
    r96     4.3692     4.4648      4.107    4.3458    4.7593    4.5311    4.6745
    r97     4.3819     4.4774     4.6247    4.3584     4.772    4.5437    4.6872
    r98     4.3945     4.4901     4.6373     4.371    4.7846    4.5563    5.2048
    r99     4.4071     4.5027       4.65    4.3837    4.7972    4.5689    5.2175
    r100    4.4198     4.5153     4.6626    4.3963    4.8098    4.5816    5.2301

xxx TABLE:coh xxxxxxxxxxxxxxxxxx
              c1        c2         c3         c4        c5        c6        c7  
            ______    _______    _______    ______    ______    ______    ______

    r1      0.6445    0.74006    0.88734    1.1261    1.5396    2.3215    3.9801
    r2      1.1622     1.2577      1.405    1.6438    2.0573    2.8391    4.4978
    r3      1.6799     1.7754     1.9227    2.1614     2.575    3.3568    5.0154
    r4      2.1975     2.2931     2.4404    2.6791    3.0927    3.8745    5.5331
    r5      2.7152     2.8108      2.958    3.1968    3.6103    4.3922    6.0508
    r96     49.824     49.919     50.067    50.305    50.719    51.501    53.159
    r97     50.341     50.437     50.584    50.823    51.237    52.018    53.677
    r98     50.859     50.955     51.102    51.341    51.754    52.536    54.195
    r99     51.377     51.472      51.62    51.858    52.272    53.054    54.712
    r100    51.895      51.99     52.137    52.376     52.79    53.571     55.23

xxx TABLE:savefraccoh xxxxxxxxxxxxxxxxxx
              c1         c2         c3         c4         c5         c6         c7   
            _______    _______    _______    _______    _______    _______    _______

    r1            0          0          0          0          0    0.21756    0.50758
    r2            0          0          0    0.30725    0.24549    0.35578    0.56145
    r3      0.30065    0.28447    0.26268    0.23366    0.39227    0.45137     0.6042
    r4      0.45965     0.4405    0.41391    0.37703    0.48992    0.52141    0.63894
    r5      0.55802    0.53905    0.51221    0.47396    0.55956    0.57494    0.66775
    r96     0.91231    0.91056    0.91797    0.91361    0.90616    0.91202    0.91207
    r97     0.91296    0.91123    0.90857    0.91424    0.90686    0.91265    0.91268
    r98     0.91359    0.91188    0.90925    0.91486    0.90755    0.91327    0.90396
    r99     0.91422    0.91252    0.90992    0.91547    0.90823    0.91388    0.90464
    r100    0.91483    0.91315    0.91057    0.91606    0.90889    0.91448     0.9053

xxx TABLE:v xxxxxxxxxxxxxxxxxx
               c1         c2         c3        c4        c5        c6        c7  
            ________    _______    ______    ______    ______    ______    ______

    r1      -0.30178    0.51348    1.4224    2.4317     3.553    4.8978    6.6446
    r2       0.33426      1.055    1.8583    2.7718    3.8436    5.1353    6.8229
    r3       0.88767     1.5337    2.2607     3.092    4.1185    5.3648    6.9953
    r4        1.3753     1.9635    2.6318    3.4067    4.3851    5.5852    7.1622
    r5        1.8107     2.3542     2.978    3.7101    4.6411    5.7965    7.3247
    r96       13.635     13.731    13.849    14.001    14.202    14.487    14.924
    r97       13.694     13.789    13.906    14.057    14.255    14.539    14.971
    r98       13.752     13.846    13.962    14.112    14.309    14.589    15.018
    r99        13.81     13.903    14.018    14.166    14.361    14.639    15.065
    r100      13.867      13.96    14.074     14.22    14.414    14.689    15.112

xxx TABLE:y xxxxxxxxxxxxxxxxxx
              c1         c2         c3         c4        c5        c6        c7  
            _______    _______    _______    ______    ______    ______    ______

    r1       0.6445    0.74006    0.88734    1.1261    1.5396    2.3215    3.9801
    r2      0.65713    0.75268    0.89997    1.1387    1.5523    2.3341    3.9927
    r3      0.66975    0.76531    0.91259    1.1513    1.5649    2.3467    4.0053
    r4      0.68238    0.77794    0.92522     1.164    1.5775    2.3593     4.018
    r5      0.69501    0.79056    0.93784    1.1766    1.5901     2.372    4.0306
    r96       1.844     1.9396     2.0868    2.3256    2.7391     3.521    5.1796
    r97      1.8566     1.9522     2.0995    2.3382    2.7518    3.5336    5.1922
    r98      1.8692     1.9648     2.1121    2.3508    2.7644    3.5462    5.2048
    r99      1.8819     1.9774     2.1247    2.3635     2.777    3.5588    5.2175
    r100     1.8945     1.9901     2.1373    2.3761    2.7896    3.5715    5.2301

</pre><h2 id="16">ls_ffsna summarize full</h2><pre class="codeinput"><span class="keyword">if</span> (~isempty(ls_ffsna))

    <span class="comment">% container map subseting</span>
    mp_ffsna = containers.Map(ls_ffsna, values(mp_print_graph, ls_ffsna));

    <span class="comment">% ff_summ_nd_array parameters</span>
    it_aggd = 0;
    bl_row = 1;
    ar_permute = [2,1];
    ar_st_stats = [<span class="string">"mean"</span>];
    bl_print_table = true;
    cl_mp_datasetdesc = {};
    cl_mp_datasetdesc{1} = containers.Map({<span class="string">'name'</span>, <span class="string">'labval'</span>}, {<span class="string">'a'</span>, ar_a});
    cl_mp_datasetdesc{2} = containers.Map({<span class="string">'name'</span>, <span class="string">'labval'</span>}, {<span class="string">'z'</span>, ar_z});

    <span class="comment">% summarize</span>
    param_map_keys = keys(mp_ffsna);
    param_map_vals = values(mp_ffsna);
    <span class="keyword">for</span> i = 1:length(mp_ffsna)
        st_mt_name = param_map_keys{i};
        mt_cur = param_map_vals{i};
        st_title = [<span class="string">'ff_vfi_az_vec, outcome='</span> st_mt_name];
        ff_summ_nd_array(st_title, mt_cur, <span class="keyword">...</span>
            bl_print_table, ar_st_stats, it_aggd, bl_row, <span class="keyword">...</span>
            cl_mp_datasetdesc, ar_permute);
    <span class="keyword">end</span>

<span class="keyword">end</span>
</pre><pre class="codeoutput">xxx  ff_vfi_az_vec, outcome=ap  xxxxxxxxxxxxxxxxxxxxxxxxxxx
    group       a       mean_z_0_50352    mean_z_0_57817    mean_z_0_69323    mean_z_0_87975    mean_z_1_2028    mean_z_1_8136    mean_z_3_1094
    _____    _______    ______________    ______________    ______________    ______________    _____________    _____________    _____________

       1           0             0                 0                 0                 0                 0          0.50505          2.0202    
       2     0.50505             0                 0                 0           0.50505           0.50505           1.0101          2.5253    
       3      1.0101       0.50505           0.50505           0.50505           0.50505            1.0101           1.5152          3.0303    
       4      1.5152        1.0101            1.0101            1.0101            1.0101            1.5152           2.0202          3.5354    
       5      2.0202        1.5152            1.5152            1.5152            1.5152            2.0202           2.5253          4.0404    
       6      2.5253        2.0202            2.0202            2.0202            2.0202            2.5253           3.0303          4.5455    
       7      3.0303        2.5253            2.5253            2.5253            2.5253            3.0303           3.5354          5.0505    
       8      3.5354        3.0303            3.0303            3.0303            3.0303            3.5354           4.0404          5.5556    
       9      4.0404        3.5354            3.5354            3.5354            3.5354            4.0404           4.5455          5.5556    
      10      4.5455        4.0404            4.0404            4.0404            4.0404            4.5455           5.0505          6.0606    
      11      5.0505        4.0404            4.5455            4.5455            4.5455            4.5455           5.5556          6.5657    
      12      5.5556        4.5455            4.5455            5.0505            5.0505            5.0505           6.0606          7.0707    
      13      6.0606        5.0505            5.0505            5.5556            5.5556            5.5556           6.5657          7.5758    
      14      6.5657        5.5556            5.5556            5.5556            6.0606            6.0606           7.0707          8.0808    
      15      7.0707        6.0606            6.0606            6.0606            6.5657            6.5657           7.5758          8.5859    
      16      7.5758        6.5657            6.5657            6.5657            7.0707            7.0707           7.5758          9.0909    
      17      8.0808        7.0707            7.0707            7.0707            7.5758            7.5758           8.0808           9.596    
      18      8.5859        7.5758            7.5758            7.5758            8.0808            8.0808           8.5859          10.101    
      19      9.0909        8.0808            8.0808            8.0808            8.5859            8.5859           9.0909          10.606    
      20       9.596        8.5859            8.5859            8.5859            8.5859            9.0909            9.596          11.111    
      21      10.101        9.0909            9.0909            9.0909            9.0909             9.596           10.101          11.616    
      22      10.606         9.596             9.596             9.596             9.596            10.101           10.606          12.121    
      23      11.111        10.101            10.101            10.101            10.101            10.606           11.111          12.626    
      24      11.616        10.606            10.606            10.606            10.606            11.111           11.616          13.131    
      25      12.121        11.111            11.111            11.111            11.111            11.616           12.121          13.636    
      26      12.626        11.616            11.616            11.616            11.616            12.121           12.626          14.141    
      27      13.131        12.121            12.121            12.121            12.121            12.626           13.131          14.646    
      28      13.636        12.626            12.626            12.626            12.626            13.131           13.636          15.152    
      29      14.141        13.131            13.131            13.131            13.131            13.636           14.141          15.657    
      30      14.646        13.131            13.636            13.636            13.636            14.141           14.646          16.162    
      31      15.152        13.636            14.141            14.141            14.141            14.646           15.152          16.667    
      32      15.657        14.141            14.141            14.646            14.646            15.152           15.657          17.172    
      33      16.162        14.646            14.646            15.152            15.152            15.152           16.162          17.677    
      34      16.667        15.152            15.152            15.657            15.657            15.657           16.667          17.677    
      35      17.172        15.657            15.657            16.162            16.162            16.162           17.172          18.182    
      36      17.677        16.162            16.162            16.162            16.667            16.667           17.677          18.687    
      37      18.182        16.667            16.667            16.667            17.172            17.172           18.182          19.192    
      38      18.687        17.172            17.172            17.172            17.677            17.677           18.687          19.697    
      39      19.192        17.677            17.677            17.677            18.182            18.182           19.192          20.202    
      40      19.697        18.182            18.182            18.182            18.687            18.687           19.192          20.707    
      41      20.202        18.687            18.687            18.687            19.192            19.192           19.697          21.212    
      42      20.707        19.192            19.192            19.192            19.697            19.697           20.202          21.717    
      43      21.212        19.697            19.697            19.697            20.202            20.202           20.707          22.222    
      44      21.717        20.202            20.202            20.202            20.202            20.707           21.212          22.727    
      45      22.222        20.707            20.707            20.707            20.707            21.212           21.717          23.232    
      46      22.727        21.212            21.212            21.212            21.212            21.717           22.222          23.737    
      47      23.232        21.717            21.717            21.717            21.717            22.222           22.727          24.242    
      48      23.737        22.222            22.222            22.222            22.222            22.727           23.232          24.747    
      49      24.242        22.727            22.727            22.727            22.727            23.232           23.737          25.253    
      50      24.747        23.232            23.232            23.232            23.232            23.737           24.242          25.758    
      51      25.253        23.737            23.737            23.737            23.737            24.242           24.747          26.263    
      52      25.758        24.242            24.242            24.242            24.242            24.747           25.253          26.768    
      53      26.263        24.747            24.747            24.747            24.747            25.253           25.758          27.273    
      54      26.768        25.253            25.253            25.253            25.253            25.758           26.263          27.778    
      55      27.273        25.758            25.758            25.758            25.758            26.263           26.768          28.283    
      56      27.778        25.758            26.263            26.263            26.263            26.768           27.273          28.788    
      57      28.283        26.263            26.768            26.768            26.768            27.273           27.778          29.293    
      58      28.788        26.768            27.273            27.273            27.273            27.778           28.283          29.798    
      59      29.293        27.273            27.273            27.778            27.778            28.283           28.788          30.303    
      60      29.798        27.778            27.778            28.283            28.283            28.788           29.293          30.808    
      61      30.303        28.283            28.283            28.788            28.788            29.293           29.798          31.313    
      62      30.808        28.788            28.788            29.293            29.293            29.798           30.303          31.818    
      63      31.313        29.293            29.293            29.798            29.798            29.798           30.808          32.323    
      64      31.818        29.798            29.798            29.798            30.303            30.303           31.313          32.323    
      65      32.323        30.303            30.303            30.303            30.808            30.808           31.818          32.828    
      66      32.828        30.808            30.808            30.808            31.313            31.313           32.323          33.333    
      67      33.333        31.313            31.313            31.313            31.818            31.818           32.828          33.838    
      68      33.838        31.818            31.818            31.818            32.323            32.323           33.333          34.343    
      69      34.343        32.323            32.323            32.323            32.828            32.828           33.838          34.848    
      70      34.848        32.828            32.828            32.828            33.333            33.333           33.838          35.354    
      71      35.354        33.333            33.333            33.333            33.838            33.838           34.343          35.859    
      72      35.859        33.838            33.838            33.838            34.343            34.343           34.848          36.364    
      73      36.364        34.343            34.343            34.343            34.848            34.848           35.354          36.869    
      74      36.869        34.848            34.848            34.848            35.354            35.354           35.859          37.374    
      75      37.374        35.354            35.354            35.354            35.354            35.859           36.364          37.879    
      76      37.879        35.859            35.859            35.859            35.859            36.364           36.869          38.384    
      77      38.384        36.364            36.364            36.364            36.364            36.869           37.374          38.889    
      78      38.889        36.869            36.869            36.869            36.869            37.374           37.879          39.394    
      79      39.394        37.374            37.374            37.374            37.374            37.879           38.384          39.899    
      80      39.899        37.879            37.879            37.879            37.879            38.384           38.889          40.404    
      81      40.404        38.384            38.384            38.384            38.384            38.889           39.394          40.909    
      82      40.909        38.889            38.889            38.889            38.889            39.394           39.899          41.414    
      83      41.414        39.394            39.394            39.394            39.394            39.899           40.404          41.919    
      84      41.919        39.899            39.899            39.899            39.899            40.404           40.909          42.424    
      85      42.424        40.404            40.404            40.404            40.404            40.909           41.414          42.929    
      86      42.929        40.909            40.909            40.909            40.909            41.414           41.919          43.434    
      87      43.434        40.909            41.414            41.414            41.414            41.919           42.424          43.939    
      88      43.939        41.414            41.919            41.919            41.919            42.424           42.929          44.444    
      89      44.444        41.919            42.424            42.424            42.424            42.929           43.434          44.949    
      90      44.949        42.424            42.929            42.929            42.929            43.434           43.939          45.455    
      91      45.455        42.929            42.929            43.434            43.434            43.939           44.444           45.96    
      92       45.96        43.434            43.434            43.939            43.939            44.444           44.949          46.465    
      93      46.465        43.939            43.939            44.444            44.444            44.949           45.455           46.97    
      94       46.97        44.444            44.444            44.949            44.949            45.455            45.96          47.475    
      95      47.475        44.949            44.949            45.455            45.455            45.455           46.465           47.98    
      96       47.98        45.455            45.455             45.96             45.96             45.96            46.97          48.485    
      97      48.485         45.96             45.96             45.96            46.465            46.465           47.475           48.99    
      98       48.99        46.465            46.465            46.465             46.97             46.97            47.98           48.99    
      99      49.495         46.97             46.97             46.97            47.475            47.475           48.485          49.495    
     100          50        47.475            47.475            47.475             47.98             47.98            48.99              50    

</pre><h2 id="17">ls_ffgrh graph</h2><pre class="codeinput"><span class="keyword">if</span> (~isempty(ls_ffgrh))

    <span class="comment">% container map subseting</span>
    mp_ffgrh = containers.Map(ls_ffgrh, values(mp_print_graph, ls_ffgrh));

    <span class="comment">% container map settings</span>
    mp_support_graph = containers.Map(<span class="string">'KeyType'</span>, <span class="string">'char'</span>, <span class="string">'ValueType'</span>, <span class="string">'any'</span>);
    mp_support_graph(<span class="string">'cl_st_xtitle'</span>) = {<span class="string">'savings states, a'</span>};
    mp_support_graph(<span class="string">'st_legend_loc'</span>) = <span class="string">'best'</span>;
    mp_support_graph(<span class="string">'bl_graph_logy'</span>) = true; <span class="comment">% do not log</span>
    mp_support_graph(<span class="string">'st_rowvar_name'</span>) = <span class="string">'shock='</span>;
    mp_support_graph(<span class="string">'it_legend_select'</span>) = 5; <span class="comment">% how many shock legends to show</span>
    mp_support_graph(<span class="string">'st_rounding'</span>) = <span class="string">'6.2f'</span>; <span class="comment">% format shock legend</span>
    mp_support_graph(<span class="string">'cl_colors'</span>) = <span class="string">'jet'</span>; <span class="comment">% any predefined matlab colormap</span>

    <span class="comment">% Overide graph options here with external parameters</span>
    <span class="keyword">if</span> (length(varargin)&gt;=3)
        mp_support_graph = [mp_support_graph; mp_support_graph_ext];
    <span class="keyword">end</span>

    <span class="comment">% summarize</span>
    param_map_keys = keys(mp_ffgrh);
    param_map_vals = values(mp_ffgrh);
    <span class="keyword">for</span> i = 1:length(mp_ffgrh)
        <span class="comment">% Get matrix and key</span>
        st_mt_name = param_map_keys{i};
        mt_cur = param_map_vals{i};

        <span class="comment">% Update Title and Y label</span>
        mp_support_graph(<span class="string">'cl_st_graph_title'</span>) = {[st_mt_name <span class="string">'(a,z), savings state =x, shock state = color'</span>]};
        mp_support_graph(<span class="string">'cl_st_ytitle'</span>) = {[st_mt_name <span class="string">'(a,z)'</span>]};

        <span class="comment">% Call function</span>
        ff_graph_grid(mt_cur', ar_z, ar_a, mp_support_graph);
    <span class="keyword">end</span>

<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="ff_vfi_az_loop_01.png" alt=""> <img vspace="5" hspace="5" src="ff_vfi_az_loop_02.png" alt=""> <img vspace="5" hspace="5" src="ff_vfi_az_loop_03.png" alt=""> <img vspace="5" hspace="5" src="ff_vfi_az_loop_04.png" alt=""> <img vspace="5" hspace="5" src="ff_vfi_az_loop_05.png" alt=""> <img vspace="5" hspace="5" src="ff_vfi_az_loop_06.png" alt=""> <img vspace="5" hspace="5" src="ff_vfi_az_loop_07.png" alt=""> <img vspace="5" hspace="5" src="ff_vfi_az_loop_08.png" alt=""> <img vspace="5" hspace="5" src="ff_vfi_az_loop_09.png" alt=""> <img vspace="5" hspace="5" src="ff_vfi_az_loop_10.png" alt=""> <h2 id="18">Store Results for Output</h2><pre class="codeinput">mp_valpol_out = containers.Map(ls_slout, values(mp_print_graph, ls_slout));
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% FF_VFI_AZ_LOOP (looped grid choice) Dynamic Savings Problem
%    Slow looped solution for solving the dynamic programming problem with
%    fixed assets grid using value function iteration. Obtains policy and
%    value functions. Shock is AR(1). This function is looped, and
%    extremely slow when state-space increases in size. This function is
%    useful as a working template for developing models that rely on asset
%    and shocks.
%
%    * MP_PARAMS controls model preference, prices, shock and asset grid
%    parameters.
%    * MP_SUPPORT controls convergence criterion, printing and summary
%    controls
%
%    mp_params = containers.Map('KeyType','char', 'ValueType','any');
%    mp_params('fl_crra') = 1.5;
%    mp_params('fl_beta') = 0.95;
%    mp_params('fl_w') = 1.05;
%    mp_params('fl_r') = 0.03;
%    mp_params('fl_a_min') = 0;
%    mp_params('fl_a_max') = 50;
%    mp_params('it_a_n') = 25;
%    mp_params('st_grid_type') = 'grid_powerspace';
%    mp_params('fl_z_persist') = 0.60;
%    mp_params('fl_shk_std') = 0.10;
%    mp_params('it_z_n') = 5;
%    mp_params('st_grid_type') = 'grid_powerspace';
%
%    mp_support = containers.Map('KeyType','char', 'ValueType','any');
%    mp_support('fl_lowestc') = -10e10;
%    mp_support('it_maxiter_val') = 500;
%    mp_support('fl_tol_val') = 10e-5;
%    % printer various information
%    mp_support('bl_timer') = true;
%    mp_support('bl_print_params') = false;
%    mp_support('bl_print_iterinfo') = false;
%    % These names must match keys of mp_solu: v=value, ap=savings choice,
%    c=consumption, y=income, coh=cash-on-hand (income + savings),
%    savefraccoh = ap/coh.
%    % what outcomes to store in the mp_solu for export
%    mp_support('ls_slout') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
%    % outcome for ff_container_map_display
%    mp_support('ls_ffcmd') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
%    % outcome for ff_summ_nd_array
%    mp_support('ls_ffsna') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
%    % outcome for ff_graph_grid
%    mp_support('ls_ffgrh') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
%    % outcome for ff_summ_nd_array
%    mp_support('ffsna_opt_it_row_n_keep') = 10;
%    % outcome for ff_summ_nd_array
%    mp_support('ffsna_opt_it_col_n_keep') = 9;
%
%    [MP_VALPOL_OUT, FLAG] = FF_VFI_AZ_LOOP() default savings and shock
%    model simulation
%
%    [MP_VALPOL_OUT, FLAG] = FF_VFI_AZ_LOOP(MP_PARAMS) change model
%    parameters through MP_PARAMS
%
%    [MP_VALPOL_OUT, FLAG] = FF_VFI_AZ_LOOP(MP_PARAMS, MP_SUPPORT) change
%    various printing, storaging, graphing, convergence etc controls
%    through MP_SUPPORT
%
%    [MP_VALPOL_OUT, FLAG] = FF_VFI_AZ_LOOP(MP_PARAMS, MP_SUPPORT,
%    MP_SUPPORT_GRAPH) also changing graphing options, see the
%    FF_GRAPH_GRID function for what key value paris can be specified.
%
%    see also FX_VFI_AZ_LOOP, FF_VFI_AZ_VEC, FF_GRAPH_GRID,
%    FF_VFI_AZ_BISEC_LOOP, FF_VFI_AZ_BISEC_VEC
%

%%
function [mp_valpol_out, flag] = ff_vfi_az_loop(varargin)

%% Set Default and Parse Inputs
if (~isempty(varargin))
    
    if (length(varargin) == 1)
        [mp_params_ext] = varargin{:};
    elseif (length(varargin) == 2)
        [mp_params_ext, mp_support_ext] = varargin{:};
    end
    
else
    close all;
    mp_support_ext = containers.Map('KeyType','char', 'ValueType','any');
    mp_support_ext('bl_timer') = true;
    mp_support_ext('bl_print_params') = true;
    mp_support_ext('bl_print_iterinfo') = true;
    mp_support_ext('ls_ffcmd') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
    mp_support_ext('ls_ffsna') = {'ap'};
    mp_support_ext('ls_ffgrh') = {'v', 'ap', 'c', 'y', 'savefraccoh'};
    mp_support_ext('ls_store') = {'v', 'ap', 'c', 'y', 'coh'};
    mp_support_ext('ffsna_opt_it_row_n_keep') = 10;
    mp_support_ext('ffsna_opt_it_col_n_keep') = 9;
    
end

%% Default Model Parameters
% support_map
mp_params = containers.Map('KeyType','char', 'ValueType','any');
mp_params('fl_crra') = 1.5;
mp_params('fl_beta') = 0.94;

mp_params('fl_w') = 1.28;
mp_params('fl_r') = 0.025;

mp_params('fl_a_min') = 0;
mp_params('fl_a_max') = 50;
mp_params('it_a_n') = 100;
mp_params('st_grid_type') = 'grid_linspace';

mp_params('fl_z_persist') = 0.80;
mp_params('fl_shk_std') = 0.20;
mp_params('it_z_n') = 7;

% override default support_map values
if (length(varargin)>=1)
    mp_params = [mp_params; mp_params_ext];
end

%% Parse mp_params
params_group = values(mp_params, {'fl_crra', 'fl_beta'});
[fl_crra, fl_beta] = params_group{:};
params_group = values(mp_params, {'fl_w', 'fl_r'});
[fl_w, fl_r] = params_group{:};
params_group = values(mp_params, {'fl_a_min', 'fl_a_max', 'it_a_n', 'st_grid_type'});
[fl_a_min, fl_a_max, it_a_n, st_grid_type] = params_group{:};
params_group = values(mp_params, {'fl_z_persist', 'fl_shk_std', 'it_z_n'});
[fl_z_persist, fl_shk_std, it_z_n] = params_group{:};

%% Generate A and Z Grids
% Same min and max and grid points
[ar_a] = ff_saveborr_grid(fl_a_min, fl_a_max, it_a_n, st_grid_type);
ar_a = ar_a';

% shock vector and transition, normalize mean exp(shk) to 1
[ar_z, mt_z_trans] = ffy_rouwenhorst(fl_z_persist, fl_shk_std, it_z_n);
ar_z = exp(ar_z');
% normalize mean of exp to 1, fl_shk_std does not shift mean.
ar_z_stationary = mt_z_trans^1000;
ar_z_stationary = ar_z_stationary(1,:);
fl_labor_agg = ar_z_stationary*exp(ar_z');
ar_z = exp(ar_z)/fl_labor_agg;

%% Default Support Parameters
% support_map
mp_support = containers.Map('KeyType','char', 'ValueType','any');

% Model Control
mp_support('fl_lowestc') = -10e10;

% Iteration Control
mp_support('it_maxiter_val') = 500;
mp_support('fl_tol_val') = 10e-5;

% printer various information
mp_support('bl_timer') = true;
mp_support('bl_print_params') = false;
mp_support('bl_print_iterinfo') = false;

% These names must match keys of mp_solu:
% what outcomes to store in the mp_solu for export
mp_support('ls_slout') = {'v', 'ap', 'c', 'y', 'coh', 'savefraccoh'};
% outcome for ff_container_map_display
mp_support('ls_ffcmd') = {'ap'};
% outcome for ff_summ_nd_array
mp_support('ls_ffsna') = {};
% outcome for ff_graph_grid
mp_support('ls_ffgrh') = {};
% outcome for ff_summ_nd_array
mp_support('ffsna_opt_it_row_n_keep') = 10;
% outcome for ff_summ_nd_array
mp_support('ffsna_opt_it_col_n_keep') = 9;

% override default support_map values
if (length(varargin)>=2 || isempty(varargin))
    mp_support = [mp_support; mp_support_ext];
end

% Parse mp_support
params_group = values(mp_support, {'fl_lowestc'});
[fl_lowestc] = params_group{:};
params_group = values(mp_support, {'it_maxiter_val', 'fl_tol_val'});
[it_maxiter_val, fl_tol_val] = params_group{:};
params_group = values(mp_support, {'bl_timer', 'bl_print_params', 'bl_print_iterinfo'});
[bl_timer, bl_print_params, bl_print_iterinfo] = params_group{:};
params_group = values(mp_support, ...
    {'ls_slout', 'ls_ffcmd', 'ls_ffsna', 'ls_ffgrh',...
    'ffsna_opt_it_row_n_keep', 'ffsna_opt_it_col_n_keep'});
[ls_slout, ls_ffcmd, ls_ffsna, ls_ffgrh,...
    ffsna_opt_it_row_n_keep, ffsna_opt_it_col_n_keep] = params_group{:};

%% Whether Additional Outcomes Should be Stored
% when state space are large, might not be a good idea to store all
% possible model output matrixes, but could be controlled with these if
% things should be outputed. If bl_store_more = true, will output store all
% additional possible outcomes if bl_vfi_store_all = true. Internally,
% which output becomes tabular or graphical controled by ls_ffcmd,
% ls_ffsna, and ls_ffgrh.

% If to store additional outcomes
cl_more = {'c', 'y'};
ar_find_slout = cell2mat(cellfun(@(m) find(strcmp(ls_slout, m)), cl_more, 'UniformOutput', false));
ar_find_ffcmd = cell2mat(cellfun(@(m) find(strcmp(ls_ffcmd, m)), cl_more, 'UniformOutput', false));
ar_find_ffsna = cell2mat(cellfun(@(m) find(strcmp(ls_ffsna, m)), cl_more, 'UniformOutput', false));
ar_find_ffgrh = cell2mat(cellfun(@(m) find(strcmp(ls_ffgrh, m)), cl_more, 'UniformOutput', false));
if (length(ar_find_slout) + length(ar_find_ffcmd) + length(ar_find_ffsna) + length(ar_find_ffgrh) >1)
    bl_store_more = true;
end

%% Initialize Matrix
mt_val_lst = zeros(length(ar_a),length(ar_z));
mt_val_cur = mt_val_lst;
mt_aprime_lst = zeros(length(ar_a),length(ar_z));
mt_aprime_cur = mt_aprime_lst;
mt_aprime_idx = zeros(length(ar_a),length(ar_z));
ar_val_diff_norm = zeros([it_maxiter_val, 1]);
ar_pol_diff_norm = zeros([it_maxiter_val, 1]);
mt_pol_perc_change = zeros([it_maxiter_val, length(ar_z)]);

if (bl_store_more)
    mt_c = zeros(length(ar_a),length(ar_z));
    mt_y = zeros(length(ar_a),length(ar_z));
    mt_coh = zeros(length(ar_a),length(ar_z));
end

%% Iterate and Dynamically Solve
if (bl_timer)
    tic
end

% initialize
fl_diff = 1;
it_iter = 0;

% After converge, one more iteration to store results
bl_continue = true;
bl_converged = false;

% Loop 0, continuous VFI iteration until convergence
while bl_continue
    
    % Loop 1, loop of exogenous shocks
    for it_z_ctr = 1:length(ar_z)
        fl_z = ar_z(it_z_ctr);
        
        % Loop 2, loop over endogenous asset states
        for it_a_ctr = 1:length(ar_a)
            fl_a = ar_a(it_a_ctr);
            ar_ev = zeros(size(ar_a));
            
            if(bl_store_more && bl_converged)
                ar_c = zeros(size(ar_a));
            end
            
            fl_y = fl_w*fl_z + (fl_r)*fl_a;
            
            % Loop 3, loop over asset choices
            for it_ap_ctr = 1:length(ar_a)
                fl_aprime = ar_a(it_ap_ctr);
                fl_c = fl_y + fl_a - fl_aprime;
                
                if fl_c > 0
                    
                    if (fl_crra == 1)
                        ar_ev(it_ap_ctr) = log(fl_c);
                    else
                        ar_ev(it_ap_ctr) = ((fl_c)^(1-fl_crra)-1)/(1-fl_crra);
                    end
                    
                    % Loop 4, loop over future shocks
                    for it_zprime_ctr = 1:length(ar_z)
                        ar_ev(it_ap_ctr) = ar_ev(it_ap_ctr) ...
                            + fl_beta*mt_z_trans(it_z_ctr,it_zprime_ctr)*mt_val_lst(it_ap_ctr,it_zprime_ctr);
                    end
                    
                else
                    fl_c = fl_lowestc;
                    ar_ev(it_ap_ctr) = fl_lowestc;
                end
                
                if(bl_store_more && bl_converged)
                    ar_c(it_ap_ctr) = fl_c;
                end
            end
            
            it_opti_a_idx = find(ar_ev == max(ar_ev));
            mt_val_cur(it_a_ctr,it_z_ctr) = ar_ev(it_opti_a_idx(1));
            mt_aprime_cur(it_a_ctr,it_z_ctr) = ar_a(it_opti_a_idx(1));
            
            % Save Additional Results
            if bl_converged
                mt_aprime_idx(it_a_ctr,it_z_ctr) = it_opti_a_idx(1);
                if (bl_store_more)
                    mt_c(it_a_ctr,it_z_ctr) = ar_c(it_opti_a_idx(1));
                    mt_y(it_a_ctr,it_z_ctr) = fl_y;
                    mt_coh(it_a_ctr,it_z_ctr) = fl_y + fl_a;
                end
            end
        end
    end
    
    % Continuation Conditions:
    it_iter = it_iter + 1;
    fl_diff = norm(mt_val_cur-mt_val_lst);
    diff_pol = norm(mt_aprime_cur-mt_aprime_lst);
    
    % Difference across iterations
    if (bl_print_iterinfo)
        ar_val_diff_norm(it_iter) = fl_diff;
        ar_pol_diff_norm(it_iter) = diff_pol;
        mt_pol_perc_change(it_iter, :) = sum((mt_aprime_cur ~= mt_aprime_lst))/(length(ar_a));
    end
    
    % Update
    mt_val_lst = mt_val_cur;
    mt_aprime_lst = mt_aprime_cur;
    
    % Update Continue Criterion
    if bl_converged
        bl_continue = false;
    elseif(fl_diff <= fl_tol_val || it_iter >= it_maxiter_val)
        bl_converged = true;
    end
    
    % Print Iteration Record
    if(bl_print_iterinfo)
        disp(['ff_vfi_az_bisec_loop, it_iter:' num2str(it_iter) ...
            ', fl_diff:' num2str(fl_diff)]);
    end
    
end

%% Convergence Results
it_iter_last = it_iter;
if fl_diff <= fl_tol_val || it_iter>=it_maxiter_val
    mt_val_cur = mt_val_lst;
    mt_aprime = mt_aprime_lst;
    if (it_iter>=it_maxiter_val)
        flag = 2;
    else
        flag = 1;
    end
else
    mt_val = zeros(size(mt_val_lst));
    mt_aprime = zeros(size(mt_val_lst));
    flag = 0;
end

if (bl_timer)
    toc
end

%% Results for Printing, and Graphing
mp_print_graph = containers.Map('KeyType','char', 'ValueType','any');
mp_print_graph('v') = mt_val_cur;
mp_print_graph('ap') = mt_aprime;
if (bl_store_more)
    mp_print_graph('c') = mt_c;
    mp_print_graph('y') = mt_y;
    mp_print_graph('coh') = mt_coh;
    mp_print_graph('savefraccoh') = mt_aprime./mt_coh;
end

%% Print Parameter Information
if (bl_print_params)
    ff_container_map_display(mp_params);
    ff_container_map_display(mp_support);
end

%% Show Value Function Convergence Information
if (bl_print_iterinfo)
    
    it_z_select = unique(round(linspace(1,length(ar_z), 7)));
    ar_z_select = ar_z(it_z_select);
    tb_valpol_alliter = array2table([ar_val_diff_norm(1:it_iter_last)';...
        ar_pol_diff_norm(1:it_iter_last)';...
        mt_pol_perc_change(1:it_iter_last,it_z_select)']');
    ar_st_col_zs = matlab.lang.makeValidName(strcat('z=', string(ar_z_select)));
    cl_col_names = ['valgap', 'polgap', ar_st_col_zs];
    cl_row_names = strcat('iter=', string(1:it_iter_last));
    tb_valpol_alliter.Properties.VariableNames = cl_col_names;
    tb_valpol_alliter.Properties.RowNames = cl_row_names;
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('Value Function Iteration Per Iteration Changes');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('valgap = norm(mt_val - mt_val_cur): value function difference across iterations');
    disp('polgap = norm(mt_pol_a - mt_pol_a_cur): policy function difference across iterations');
    disp(['z1 = z1 perc change: sum((mt_pol_a ~= mt_pol_a_cur))/(it_a_n): percentage of state space'...
        ' points conditional on shock where the policy function is changing across iterations']);
    disp(tb_valpol_alliter);
    
end

%% ls_ffcmd summary
if (~isempty(ls_ffcmd))
    mp_ffcmd = containers.Map(ls_ffcmd, values(mp_print_graph, ls_ffcmd));
    ff_container_map_display(mp_ffcmd, ffsna_opt_it_row_n_keep, ffsna_opt_it_col_n_keep);
end

%% ls_ffsna summarize full
if (~isempty(ls_ffsna))
    
    % container map subseting
    mp_ffsna = containers.Map(ls_ffsna, values(mp_print_graph, ls_ffsna));
    
    % ff_summ_nd_array parameters
    it_aggd = 0;
    bl_row = 1;
    ar_permute = [2,1];
    ar_st_stats = ["mean"];
    bl_print_table = true;
    cl_mp_datasetdesc = {};
    cl_mp_datasetdesc{1} = containers.Map({'name', 'labval'}, {'a', ar_a});
    cl_mp_datasetdesc{2} = containers.Map({'name', 'labval'}, {'z', ar_z});
    
    % summarize
    param_map_keys = keys(mp_ffsna);
    param_map_vals = values(mp_ffsna);
    for i = 1:length(mp_ffsna)
        st_mt_name = param_map_keys{i};
        mt_cur = param_map_vals{i};
        st_title = ['ff_vfi_az_vec, outcome=' st_mt_name];
        ff_summ_nd_array(st_title, mt_cur, ...
            bl_print_table, ar_st_stats, it_aggd, bl_row, ...
            cl_mp_datasetdesc, ar_permute);
    end
    
end

%% ls_ffgrh graph
if (~isempty(ls_ffgrh))
    
    % container map subseting
    mp_ffgrh = containers.Map(ls_ffgrh, values(mp_print_graph, ls_ffgrh));
    
    % container map settings
    mp_support_graph = containers.Map('KeyType', 'char', 'ValueType', 'any');
    mp_support_graph('cl_st_xtitle') = {'savings states, a'};
    mp_support_graph('st_legend_loc') = 'best';
    mp_support_graph('bl_graph_logy') = true; % do not log
    mp_support_graph('st_rowvar_name') = 'shock=';
    mp_support_graph('it_legend_select') = 5; % how many shock legends to show
    mp_support_graph('st_rounding') = '6.2f'; % format shock legend
    mp_support_graph('cl_colors') = 'jet'; % any predefined matlab colormap
    
    % Overide graph options here with external parameters
    if (length(varargin)>=3)
        mp_support_graph = [mp_support_graph; mp_support_graph_ext];
    end
    
    % summarize
    param_map_keys = keys(mp_ffgrh);
    param_map_vals = values(mp_ffgrh);
    for i = 1:length(mp_ffgrh)
        % Get matrix and key
        st_mt_name = param_map_keys{i};
        mt_cur = param_map_vals{i};
        
        % Update Title and Y label
        mp_support_graph('cl_st_graph_title') = {[st_mt_name '(a,z), savings state =x, shock state = color']};
        mp_support_graph('cl_st_ytitle') = {[st_mt_name '(a,z)']};
        
        % Call function
        ff_graph_grid(mt_cur', ar_z, ar_a, mp_support_graph);
    end
    
end

%% Store Results for Output
mp_valpol_out = containers.Map(ls_slout, values(mp_print_graph, ls_slout));

end

##### SOURCE END #####
--></body></html>